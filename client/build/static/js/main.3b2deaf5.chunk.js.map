{"version":3,"sources":["pages/Home/styles_Home.js","pages/Home/Introduction/main_Introduction.js","pages/Home/Tutorial/main_Tutorial.js","pages/Home/annotateComponents/ImageCanvas/useMouse.js","pages/Home/annotateComponents/ImageCanvas/useProjectBox.js","pages/Home/annotateComponents/ImageCanvas/regionTools.js","pages/Home/annotateComponents/RegionLabel/styles_RegionLabel.js","pages/Home/annotateComponents/RegionLabel/main_RegionLabel.js","pages/Home/annotateComponents/RegionTags/main_RegionTags.js","pages/Home/annotateComponents/TransformBoxes/main_TransformBoxes.js","pages/Home/annotateComponents/ImageCanvas/background.js","pages/Home/annotateComponents/ShortcutsManager/main_ShortcutsManager.js","pages/Home/annotateComponents/RegionShapes/main_RegionShapes.js","pages/Home/annotateComponents/ImageCanvas/main_ImageCanvas.js","pages/Home/annotateComponents/ImageCanvas/styles_ImageCanvas.js","pages/Home/annotateComponents/MainLayout/styles_MainLayout.js","pages/Home/annotateComponents/reducers/getActiveImage.js","pages/Home/annotateComponents/MainLayout/iconDictionary.js","pages/Home/annotateComponents/MainLayout/main_MainLayout.js","pages/Home/annotateComponents/reducers/historyHandler.js","pages/Home/annotateComponents/ImageCanvas/colors.js","pages/Home/annotateComponents/reducers/generalReducer.js","pages/Home/annotateComponents/reducers/imageReducer.js","pages/Home/annotateComponents/main_Annotate.js","pages/Home/annotateComponents/reducers/combineReducers.js","pages/Home/SubmitHIT/main_SubmitHIT.js","pages/Home/main_Home.js","pages/ShowResult/main_ShowResult.js","route.js","pages/Home/SubmitHIT/serviceWorker.js","index.js"],"names":["homeContainer","margin","width","fontFamily","introTutorial","backgroundColor","paddingBottom","introContainer","color","textAlign","paddingTop","jumbotron","introContent","padding","fontSize","introTitle","fontWeight","bold","buttonTitle","card","tutorialTitles","imageContainer","display","maxWidth","media","height","avatar","red","steps","paddingLeft","annotateContainer","marginTop","myStyle","makeStyles","styles","Introduction","props","classes","React","useState","opened","setOpened","title","setTitle","className","Jumbotron","intro","Button","variant","size","onClick","e","class","children","Tutorial","data","dense","root","Card","Box","boxShadow","CardHeader","subheader","CardMedia","image","tutorial","imgUrl","CardContent","List","console","log","map","step","ListItem","ListItemText","primary","canvasEl","changeMat","changeDragging","zoomStart","changeZoomStart","zoomEnd","changeZoomEnd","layoutParams","zoomWithPrimary","dragWithPrimary","mat","onMouseMove","onMouseUp","onMouseDown","dragging","mousePosition","useRef","x","y","prevMousePosition","zoomIn","direction","point","mx","my","scale","to","a","translate","scaleU","clone","mouseEvents","current","getBoundingClientRect","left","top","clientX","clientY","projMouse","applyToPoint","iw","ih","preventDefault","specialEvent","button","type","Math","abs","min","newMat","Matrix","from","onWheel","deltaY","onContextMenu","useEventCallback","r","bbox","region","rectangle","points","w","h","max","xr","yr","Error","getEnclosingBox","cbox","inverse","d","regionInfo","cursor","transition","opacity","grey","flexDirection","alignItems","marginRight","borderRadius","textDecoration","commentBox","memo","editing","allowedTags","onDelete","onChange","onClose","onOpen","allowComments","commentInputRef","Paper","classnames","highlighted","style","paddingRight","textShadow","flexGrow","IconButton","tabIndex","length","newTags","tags","t","value","placeholder","c","label","isMulti","options","asMutable","TextField","InputProps","fullWidth","multiline","rows","ref","_","commentInput","focus","comment","event","target","cls","key","prevProps","nextProps","RegionTags","regions","projectRegionBox","regionTagList","onBeginRegionEdit","onChangeRegion","onCloseRegionEdit","onDeleteRegion","imageSrc","RegionEditLabel","onRegionClassAdded","RegionLabel","DefaultRegionLabel","filter","visible","undefined","pbox","labelBoxHeight","editingLabels","locked","displayOnTop","coords","id","position","zIndex","bottom","pointerEvents","onMouseEnter","obj","newObj","args","arg","copyWithout","TransformMyStyles","styled","border","boxCursorMap","RegionSelectAndTransformBox","createWithPrimary","onBeginMovePoint","onSelectRegion","onBeginBoxTransform","onBeginMovePolygonPoint","onBeginMovePolygon1Point","onAddPolygonPoint","onBeginMoveKeypoint","onAddPolygon1Point","onBeginCircleTransform","i","px","py","sqrt","pow","proj","open","p1","p2","pa","prev","next","RegionSelectAndTransformBoxes","n","p","StyledImage","right","whiteSpace","imagePosition","onLoad","useCrossOrigin","imageRef","error","setError","onImageLoaded","imageElm","currentTarget","naturalWidth","naturalHeight","onImageError","stylePosition","useMemo","bottomRight","topLeft","imageRendering","isNaN","src","onError","crossOrigin","RegionComponents","transform","strokeWidth","stroke","fill","colorAlpha","circle","rx","ry","cx","cy","polygon1","Component","fullSegmentationMode","join","polygon","pixel","WrappedRegionList","keypointDefinitions","regionId","RegionShapes","canvas","zoomIndicator","getCanvasDimension","allowedArea","dimension","ImageCanvas","onLoaded","zoomOnAllowedArea","nBeginCircleTransform","useRafState","useMouse","useProjectRegionBox","imageDimensions","changeImageDimensions","imageLoaded","Boolean","ImageLoaded","dims","clientWidth","clientHeight","fitScale","canvasWidth","canvasHeight","useEffect","useLayoutEffect","context","getContext","save","toArray","globalAlpha","outer","inner","moveTo","forEach","lineTo","closePath","reverse","restore","zoomBox","maxHeight","overflow","toFixed","container","headerTitle","state","pathToActiveImage","activeImage","currentImageIndex","annotationType","selectedImage","getIn","defaultKeyMap","description","binding","useDispatchHotkeyHandlers","dispatch","zoom_tool","selectedTool","create_point","create_rectangle","pan_tool","create_polygon","create_polygon1","create_circle","save_and_previous_sample","buttonName","save_and_next_sample","save_and_exit_sample","delete_region","undo","faStyle","marginBottom","iconDictionary","pan","fixedWidth","icon","faHandPaper","zoom","faSearch","faCrosshairs","faVectorSquare","faDrawPolygon","faMinusSquare","faCircle","HotkeyDiv","withHotKeys","hotKeys","divRef","MainLayout","dispatchAction","memoizedActionFns","action","params","fnKey","fn","reduce","acc","getActiveImage","images","useKey","detectKeys","innerContainerRef","hotkeyHandlers","refocusOnMouseEvent","useCallback","contains","document","activeElement","showTags","realSize","pointDistancePrecision","includes","onClickIconSidebarItem","item","name","onClickHeaderItem","onMouseOver","allowChanges","handlers","Workspace","headerLeftSide","headerItems","selectedTools","iconSidebarItems","helperText","alwaysShowing","enabledTools","typesToSaveWithHistory","BEGIN_BOX_TRANSFORM","BEGIN_MOVE_POINT","DELETE_REGION","BEGIN_CIRCLE_TRANSFORM","saveToHistory","updateIn","time","moment","toDate","without","concat","slice","colors","muiColors","rrggbb","bbggrr","replace","substr","parseInt","reverseParseColor","getRandomId","random","toString","split","Date","now","lastMouseMoveCall","setIn","getRegionIndex","regionIndex","findIndex","getRegion","modifyRegion","closeEditors","setNewImage","img","index","imageIndex","oldRegion","clsIndex","regionClsList","indexOf","isEqual","delta","Object","keys","mode","directions","freedom","original","pointIndex","splice","point1Index","point1","holes","creatingHole","mouseDownAt","moveRegion","xFree","yFree","ox","oy","ow","oh","dx","dw","dy","dh","newRegion","region1Index","defaultRegionCls","defaultRegionColor","editLabelEditorAfter","isNew","newRegions","toLowerCase","some","metadata","Annotator","onExit","onNextImage","onPrevImage","reducer","useReducer","reducers","combineReducers","imageReducer","generalReducer","prevState","nextState","history","makeImmutable","dispatchToReducer","alwaysShowNextButton","alwaysShowPrevButton","config","require","SubmitHIT","isLoaded","EnabledTools","AllowComments","Tags","imgData","Local","submitTask","bind","getSubmissionUrl","handleSubmit","componentDidMount","res","Tools","fetch","then","json","result","push","getEnabledTools","setState","url","queryString","queryPieces","pieces","paramName","paramValue","input","getElementById","setAttribute","JSON","stringify","this","form","HTMLFormElement","prototype","submit","call","axios","post","response","catch","assignmentID","parseParameters","window","location","href","message","method","output","block","encodeURIComponent","download","main_ShowResult","resultsArr","results","Submit","Annotation","customHistory","createBrowserHistory","exact","path","component","setTutorial","setIntro","hasError","setHasError","loading","setLoading","err","preview","hostname","match","ReactDOM","render","route","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.3b2deaf5.chunk.js","sourcesContent":["import {red} from \"@material-ui/core/colors\";\r\nimport {bold} from \"colorette\";\r\n\r\nexport default {\r\n    homeContainer:{\r\n        margin: \"auto\",\r\n        width:\"85%\",\r\n        fontFamily: \"Arial\",\r\n    },\r\n    introTutorial:{\r\n        backgroundColor: \"#E8E8E8\",\r\n        paddingBottom:20,\r\n    },\r\n    /*intro*/\r\n    introContainer:{\r\n        color: \"DodgerBlue\",\r\n        textAlign: \"center\",\r\n       paddingTop: 10\r\n    },\r\n    jumbotron:{\r\n        paddingTop:100,\r\n        backgroundColor: \"#E8E8E8\"\r\n    },\r\n    introContent:{\r\n        padding: 40,\r\n        fontSize: \"x-large\",\r\n    },\r\n    introTitle: {\r\n        fontWeight: bold(),\r\n    },\r\n    buttonTitle: {\r\n        padding: \"40px\",\r\n    },\r\n    // tutorial\r\n    card:{\r\n        margin: 20,\r\n\r\n    },\r\n    tutorialTitles:{\r\n        textAlign: \"center\",\r\n\r\n    },\r\n    imageContainer: {\r\n        display: \"block\",\r\n        margin: \"auto\",\r\n        maxWidth: 1000,\r\n        padding:5,\r\n    },\r\n    media: {\r\n        height: 0,\r\n        paddingTop: '56.25%', // 16:9\r\n\r\n    },\r\n\r\n    avatar: {\r\n        backgroundColor: red[500],\r\n    },\r\n    steps:{\r\n        paddingLeft:\"25%\",\r\n    },\r\n    /*annotate*/\r\n    annotateContainer: {\r\n        marginTop: \"170px\",\r\n    }\r\n}\r\n\r\n","import React from \"react\";\r\nimport Button from 'react-bootstrap/Button';\r\nimport styles from \"../styles_Home\"\r\nimport {Jumbotron} from \"react-bootstrap\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n// get style from style.js\r\nconst myStyle = makeStyles(styles);\r\n\r\nexport default function Introduction (props){\r\n    const classes = myStyle();\r\n    const [opened, setOpened] = React.useState(false);\r\n    const [title, setTitle]=React.useState('Show Tutorial');\r\n    function toggleTutorial(e) {\r\n        if (opened) {\r\n            setTitle('Show Tutorial');\r\n\r\n        } else {\r\n            setTitle('Hide Tutorial');\r\n\r\n        }\r\n        setOpened(!opened);\r\n\r\n    }\r\n    return (\r\n        <div>\r\n            <div className={classes.introContainer}>\r\n                <Jumbotron  className={classes.jumbotron}>\r\n                    <h1 className={classes.introTitle}>Task Overview</h1>\r\n                    <p className={classes.introContent}>\r\n                        { props.intro.intro}\r\n                    </p>\r\n                    <p>\r\n                        <div className={classes.buttonTitle}>\r\n                            <Button\r\n                                variant=\"outline-primary\"\r\n                                size=\"lg\"\r\n                                onClick={e => toggleTutorial(e)}>\r\n                                {title}\r\n                            </Button>\r\n                        </div>\r\n                    </p>\r\n                </Jumbotron>\r\n            </div>\r\n            {opened && (\r\n\r\n                <div class=\"boxContent\">\r\n                    {props.children}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport styles from \"../styles_Home\"\r\nimport {Card, CardContent, CardHeader, CardMedia, Box} from \"@material-ui/core\";\r\n// get style from style.js\r\n\r\nconst myStyle = makeStyles(styles);\r\n\r\nfunction generateSteps(data) {\r\n    console.log(\"data before is:\",data)\r\n    return !data ? null :data.map(step => {\r\n        return (<ListItem>\r\n            <ListItemText primary={step} />\r\n        </ListItem>)\r\n    });\r\n\r\n};\r\nexport default function Tutorial(props) {\r\n    const classes = myStyle();\r\n    const [dense, setDense] = React.useState(false);\r\n        return (\r\n            <div className={classes.root}>\r\n                <Card className={classes.card}>\r\n                    <Box boxShadow={3}>\r\n                        <CardHeader\r\n                            className={classes.tutorialTitles}\r\n                            title=\"Tutorial\"\r\n                            subheader=\"This short tutorial is meant to guide you through the annotation process. \"\r\n                        />\r\n                    </Box>\r\n                    <div className={classes.imageContainer}>\r\n                        <CardMedia\r\n                            className={classes.media}\r\n                            image={props.tutorial.imgUrl}/>\r\n                    </div>\r\n                    <Box boxShadow={3}>\r\n                        <CardContent className={classes.steps}>\r\n                            <List dense={dense}>\r\n                                {generateSteps(props.tutorial.steps)}\r\n                            </List>\r\n                        </CardContent>\r\n                    </Box>\r\n                </Card>\r\n            </div>\r\n        );\r\n    // }\r\n}\r\n","\r\nimport { useRef } from \"react\"\r\nimport { Matrix } from \"transformation-matrix-js\"\r\n\r\nconst getDefaultMat = () => Matrix.from(1, 0, 0, 1, -10, -10)\r\n\r\nexport default ({\r\n  canvasEl,\r\n  changeMat,\r\n  changeDragging,\r\n  zoomStart,\r\n  zoomEnd,\r\n  changeZoomStart,\r\n  changeZoomEnd,\r\n  layoutParams,\r\n  zoomWithPrimary,\r\n  dragWithPrimary,\r\n  mat,\r\n  onMouseMove,\r\n  onMouseUp,\r\n  onMouseDown,\r\n  dragging,\r\n}) => {\r\n  const mousePosition = useRef({ x: 0, y: 0 })\r\n  const prevMousePosition = useRef({ x: 0, y: 0 })\r\n\r\n  const zoomIn = (direction, point) => {\r\n    const [mx, my] = [point.x, point.y]\r\n    let scale =\r\n      typeof direction === \"object\" ? direction.to / mat.a : 1 + 0.2 * direction\r\n\r\n    //  mutating mat here\r\n    mat.translate(mx, my).scaleU(scale)\r\n    if (mat.a > 2) mat.scaleU(2 / mat.a)\r\n    if (mat.a < 0.05) mat.scaleU(0.05 / mat.a)\r\n    mat.translate(-mx, -my)\r\n\r\n    changeMat(mat.clone())\r\n  }\r\n\r\n  const mouseEvents = {\r\n    onMouseMove: (e) => {\r\n      const { left, top } = canvasEl.current.getBoundingClientRect()\r\n      prevMousePosition.current.x = mousePosition.current.x\r\n      prevMousePosition.current.y = mousePosition.current.y\r\n      mousePosition.current.x = e.clientX - left\r\n      mousePosition.current.y = e.clientY - top\r\n\r\n      const projMouse = mat.applyToPoint(\r\n        mousePosition.current.x,\r\n        mousePosition.current.y\r\n      )\r\n\r\n      if (zoomWithPrimary && zoomStart) {\r\n        changeZoomEnd(projMouse)\r\n      }\r\n\r\n      const { iw, ih } = layoutParams.current\r\n      onMouseMove({ x: projMouse.x / iw, y: projMouse.y / ih })\r\n\r\n      if (dragging) {\r\n        mat.translate(\r\n          prevMousePosition.current.x - mousePosition.current.x,\r\n          prevMousePosition.current.y - mousePosition.current.y\r\n        )\r\n\r\n        changeMat(mat.clone())\r\n      }\r\n      e.preventDefault()\r\n    },\r\n    onMouseDown: (e, specialEvent = {}) => {\r\n      e.preventDefault()\r\n\r\n      if (\r\n        e.button === 1 ||\r\n        e.button === 2 ||\r\n        (e.button === 0 && dragWithPrimary)\r\n      )\r\n        return changeDragging(true)\r\n\r\n      const projMouse = mat.applyToPoint(\r\n        mousePosition.current.x,\r\n        mousePosition.current.y\r\n      )\r\n      if (zoomWithPrimary && e.button === 0) {\r\n        changeZoomStart(projMouse)\r\n        changeZoomEnd(projMouse)\r\n        return\r\n      }\r\n      if (e.button === 0) {\r\n        if (specialEvent.type === \"resize-box\") {\r\n        }\r\n        if (specialEvent.type === \"move-region\") {\r\n        }\r\n        const { iw, ih } = layoutParams.current\r\n        onMouseDown({ x: projMouse.x / iw, y: projMouse.y / ih })\r\n      }\r\n    },\r\n    onMouseUp: (e) => {\r\n      e.preventDefault()\r\n      const projMouse = mat.applyToPoint(\r\n        mousePosition.current.x,\r\n        mousePosition.current.y\r\n      )\r\n      if (zoomStart) {\r\n        const zoomEnd = projMouse\r\n        if (\r\n          Math.abs(zoomStart.x - zoomEnd.x) < 10 &&\r\n          Math.abs(zoomStart.y - zoomEnd.y) < 10\r\n        ) {\r\n          if (mat.a < 1) {\r\n            zoomIn({ to: 1 }, mousePosition.current)\r\n          } else {\r\n            zoomIn({ to: 0.25 }, mousePosition.current)\r\n          }\r\n        } else {\r\n          const { iw, ih } = layoutParams.current\r\n\r\n          if (zoomStart.x > zoomEnd.x) {\r\n            ;[zoomStart.x, zoomEnd.x] = [zoomEnd.x, zoomStart.x]\r\n          }\r\n          if (zoomStart.y > zoomEnd.y) {\r\n            ;[zoomStart.y, zoomEnd.y] = [zoomEnd.y, zoomStart.y]\r\n          }\r\n\r\n          // The region defined by zoomStart and zoomEnd should be the new transform\r\n          let scale = Math.min(\r\n            (zoomEnd.x - zoomStart.x) / iw,\r\n            (zoomEnd.y - zoomStart.y) / ih\r\n          )\r\n          if (scale < 0.05) scale = 0.05\r\n          if (scale > 10) scale = 10\r\n\r\n          const newMat = getDefaultMat()\r\n            .translate(zoomStart.x, zoomStart.y)\r\n            .scaleU(scale)\r\n\r\n          changeMat(newMat.clone())\r\n        }\r\n\r\n        changeZoomStart(null)\r\n        changeZoomEnd(null)\r\n      }\r\n      if (\r\n        e.button === 1 ||\r\n        e.button === 2 ||\r\n        (e.button === 0 && dragWithPrimary)\r\n      )\r\n        return changeDragging(false)\r\n      if (e.button === 0) {\r\n        const { iw, ih } = layoutParams.current\r\n        onMouseUp({ x: projMouse.x / iw, y: projMouse.y / ih })\r\n      }\r\n    },\r\n    onWheel: (e) => {\r\n      const direction = e.deltaY > 0 ? 1 : e.deltaY < 0 ? -1 : 0\r\n      zoomIn(direction, mousePosition.current)\r\n    },\r\n    onContextMenu: (e) => {\r\n      e.preventDefault()\r\n    },\r\n  }\r\n  return { mouseEvents, mousePosition }\r\n}\r\n","import useEventCallback from \"use-event-callback\"\r\nimport { getEnclosingBox } from \"./regionTools.js\"\r\n\r\nexport default ({ layoutParams, mat }) => {\r\n  return useEventCallback((r) => {\r\n    const { iw, ih } = layoutParams.current\r\n    const bbox = getEnclosingBox(r)\r\n    const margin = r.type === \"point\" ? 15 : 2\r\n    const cbox = {\r\n      x: bbox.x * iw - margin,\r\n      y: bbox.y * ih - margin,\r\n      w: bbox.w * iw + margin * 2,\r\n      h: bbox.h * ih + margin * 2,\r\n    }\r\n    const pbox = {\r\n      ...mat.clone().inverse().applyToPoint(cbox.x, cbox.y),\r\n      w: cbox.w / mat.a,\r\n      h: cbox.h / mat.d,\r\n    }\r\n    return pbox\r\n  })\r\n}\r\n","\r\nexport type BaseRegion = {\r\n  id: string | number,\r\n  cls?: string,\r\n  locked?: boolean,\r\n  visible?: boolean,\r\n  color: string,\r\n  editingLabels?: boolean,\r\n  highlighted?: boolean,\r\n  tags?: Array<string>,\r\n}\r\n\r\nexport type Point = {|\r\n  ...$Exact<BaseRegion>,\r\n  type: \"point\",\r\n  x: number,\r\n  y: number,\r\n|}\r\n\r\nexport type Rectangle = {|\r\n  ...$Exact<BaseRegion>,\r\n  type: \"rectangle\",\r\n  x: number,\r\n  y: number,\r\n  w: number,\r\n  h: number,\r\n|}\r\n\r\nexport type Polygon = {|\r\n  ...$Exact<BaseRegion>,\r\n  type: \"polygon\",\r\n  open?: boolean,\r\n  points: Array<[number, number]>,\r\n|}\r\n\r\nexport type Polygon1 = {|\r\n...$Exact<BaseRegion>,\r\n    type:\r\n\"polygon1\",\r\n    points:Array<[number, number]>,\r\n    holes: Array<[number, number]>,\r\n    open?: boolean,\r\n    creatingHole?:  boolean,\r\n|}\r\nexport type Circle = {|\r\n...$Exact<BaseRegion>,\r\n    type: \"circle\",\r\n    // x and y indicate the coordinates of the centre of the circle\r\n    x: number,\r\n    y: number,\r\n    // x and y radius (technically, Circles are capable of representing Ovals)\r\n    xr: number,\r\n    xr: number\r\n|}\r\nexport type Region =\r\n  | Point\r\n  | Rectangle\r\n  | Polygon\r\n  | Polygon1\r\n  |Circle\r\n\r\nexport const getEnclosingBox = (region: Region) => {\r\n  switch (region.type) {\r\n    case \"polygon\": {\r\n      const rectangle = {\r\n        x: Math.min(...region.points.map(([x, y]) => x)),\r\n        y: Math.min(...region.points.map(([x, y]) => y)),\r\n        w: 0,\r\n        h: 0,\r\n      }\r\n      rectangle.w = Math.max(...region.points.map(([x, y]) => x)) - rectangle.x\r\n      rectangle.h = Math.max(...region.points.map(([x, y]) => y)) - rectangle.y\r\n      return rectangle\r\n    }\r\n    case \"polygon1\": {\r\n      const rectangle = {\r\n        x: Math.min(...region.points.map(([x, y]) => x)),\r\n        y: Math.min(...region.points.map(([x, y]) => y)),\r\n        w: 0,\r\n        h: 0,\r\n      }\r\n      rectangle.w = Math.max(...region.points.map(([x, y]) => x)) - rectangle.x\r\n      rectangle.h = Math.max(...region.points.map(([x, y]) => y)) - rectangle.y\r\n      return rectangle\r\n    }\r\n    case \"circle\": {\r\n      return {\r\n        x: region.x - region.xr,\r\n        y: region.y - region.yr,\r\n        w: region.xr * 2,\r\n        h: region.yr * 2\r\n      }\r\n    }\r\n    case \"rectangle\": {\r\n      return { x: region.x, y: region.y, w: region.w, h: region.h }\r\n    }\r\n    case \"point\": {\r\n      return { x: region.x, y: region.y, w: 0, h: 0 }\r\n    }\r\n    default: {\r\n      return { x: 0, y: 0, w: 0, h: 0 }\r\n    }\r\n  }\r\n  throw new Error(\"unknown region\")\r\n}\r\n\r\nexport const moveRegion = (region: Region, x: number, y: number) => {\r\n  switch (region.type) {\r\n    case \"point\": {\r\n      return { ...region, x, y }\r\n    }\r\n    case \"rectangle\": {\r\n      return { ...region, x: x - region.w / 2, y: y - region.h / 2 }\r\n    }\r\n    case \"circle\": {\r\n      return {\r\n        ...region,\r\n        x,\r\n        y\r\n      }\r\n    }\r\n  }\r\n  return region\r\n}\r\n","\r\nimport { grey } from \"@material-ui/core/colors\"\r\n\r\nexport default {\r\n  regionInfo: {\r\n    fontSize: 12,\r\n    cursor: \"default\",\r\n    transition: \"opacity 200ms\",\r\n    opacity: 0.5,\r\n    \"&:hover\": {\r\n      opacity: 0.9,\r\n      cursor: \"pointer\",\r\n    },\r\n    \"&.highlighted\": {\r\n      opacity: 0.9,\r\n      \"&:hover\": {\r\n        opacity: 1,\r\n      },\r\n    },\r\n    fontWeight: 600,\r\n    color: grey[900],\r\n    padding: 8,\r\n    \"& .name\": {\r\n      display: \"flex\",\r\n      flexDirection: \"row\",\r\n      alignItems: \"center\",\r\n      \"& .circle\": {\r\n        marginRight: 4,\r\n        boxShadow: \"0px 0px 2px rgba(0,0,0,0.4)\",\r\n        width: 10,\r\n        height: 10,\r\n        borderRadius: 5,\r\n      },\r\n    },\r\n    \"& .tags\": {\r\n      \"& .tag\": {\r\n        color: grey[700],\r\n        display: \"inline-block\",\r\n        margin: 1,\r\n        fontSize: 10,\r\n        textDecoration: \"underline\",\r\n      },\r\n    },\r\n  },\r\n  commentBox: {\r\n    fontWeight: 400,\r\n    fontSize: 13,\r\n  },\r\n}\r\n","\r\nimport React, { useRef, memo } from \"react\"\r\nimport Paper from \"@material-ui/core/Paper\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport styles from \"./styles_RegionLabel\"\r\nimport classnames from \"classnames\"\r\nimport type { Region } from \"../ImageCanvas/regionTools.js\"\r\nimport IconButton from \"@material-ui/core/IconButton\"\r\nimport Button from \"@material-ui/core/Button\"\r\nimport TrashIcon from \"@material-ui/icons/Delete\"\r\nimport CheckIcon from \"@material-ui/icons/Check\"\r\nimport TextField from \"@material-ui/core/TextField\"\r\nimport Select from \"react-select\"\r\nimport { asMutable } from \"seamless-immutable\"\r\n// get style from style.js\r\nconst myStyle = makeStyles(styles)\r\n\r\ntype Props = {\r\n  region: Region,\r\n  editing?: boolean,\r\n  allowedTags?: Array<string>,\r\n  cls?: string,\r\n  tags?: Array<string>,\r\n  onDelete: (Region) => null,\r\n  onChange: (Region) => null,\r\n  onClose: (Region) => null,\r\n  onOpen: (Region) => null,\r\n  allowComments?: boolean,\r\n}\r\n\r\nexport const RegionLabel = ({\r\n  region,\r\n  editing,\r\n  allowedTags,\r\n  onDelete,\r\n  onChange,\r\n  onClose,\r\n  onOpen,\r\n                              allowComments,\r\n}: Props) => {\r\n  const classes = myStyle()\r\n  const commentInputRef = useRef(null)\r\n  const onCommentInputClick = (_) => {\r\n    // The TextField wraps the <input> tag with two divs\r\n    const commentInput = commentInputRef.current.children[0].children[0]\r\n\r\n    if (commentInput) return commentInput.focus()\r\n  }\r\n  return (\r\n    <Paper\r\n      onClick={() => (!editing ? onOpen(region) : null)}\r\n      className={classnames(classes.regionInfo, {\r\n        highlighted: region.highlighted,\r\n      })}\r\n    >\r\n      {!editing ? (\r\n        <div>\r\n          {region.cls && (\r\n            <div className=\"name\">\r\n              <div\r\n                className=\"circle\"\r\n                style={{ backgroundColor: region.color }}\r\n              />\r\n              {region.cls}\r\n            </div>\r\n          )}\r\n          {region.tags && (\r\n            <div className=\"tags\">\r\n              {region.tags.map((t) => (\r\n                <div key={t} className=\"tag\">\r\n                  {t}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div style={{ width: 200 }}>\r\n          <div style={{ display: \"flex\", flexDirection: \"row\" }}>\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                backgroundColor: region.color || \"#888\",\r\n                color: \"#fff\",\r\n                padding: 4,\r\n                paddingLeft: 8,\r\n                paddingRight: 8,\r\n                borderRadius: 4,\r\n                fontWeight: \"bold\",\r\n                textShadow: \"0px 0px 5px rgba(0,0,0,0.4)\",\r\n              }}\r\n            >\r\n              {region.type}\r\n            </div>\r\n            <div style={{ flexGrow: 1 }} />\r\n            <IconButton\r\n              onClick={() => onDelete(region)}\r\n              tabIndex={-1}\r\n              style={{ width: 22, height: 22 }}\r\n              size=\"small\"\r\n              variant=\"outlined\"\r\n            >\r\n              <TrashIcon style={{ marginTop: -8, width: 16, height: 16 }} />\r\n            </IconButton>\r\n          </div>\r\n          {(allowedTags || []).length > 0 && (\r\n            <div style={{ marginTop: 4 }}>\r\n              <Select\r\n                onChange={(newTags) =>\r\n                  onChange({\r\n                    ...(region: any),\r\n                    tags: newTags.map((t) => t.value),\r\n                  })\r\n                }\r\n                placeholder=\"Tags\"\r\n                value={(region.tags || []).map((c) => ({ label: c, value: c }))}\r\n                isMulti\r\n                options={asMutable(\r\n                  allowedTags.map((c) => ({ value: c, label: c }))\r\n                )}\r\n              />\r\n            </div>\r\n          )}\r\n          {allowComments && (\r\n              <TextField\r\n                  InputProps={{\r\n                    className: classes.commentBox,\r\n                  }}\r\n                  fullWidth\r\n                  multiline\r\n                  rows={3}\r\n                  ref={commentInputRef}\r\n                  onClick={onCommentInputClick}\r\n                  value={region.comment || \"\"}\r\n                  onChange={(event) =>\r\n                      onChange({ ...(region: any), comment: event.target.value })\r\n                  }\r\n              />\r\n          )}\r\n          {onClose && (\r\n            <div style={{ marginTop: 4, display: \"flex\" }}>\r\n              <div style={{ flexGrow: 1 }} />\r\n              <Button\r\n                onClick={() => onClose(region)}\r\n                size=\"small\"\r\n                variant=\"contained\"\r\n                color=\"primary\"\r\n              >\r\n                <CheckIcon />\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </Paper>\r\n  )\r\n}\r\n\r\nexport default memo(\r\n  RegionLabel,\r\n  (prevProps, nextProps) =>\r\n    prevProps.editing === nextProps.editing &&\r\n    prevProps.region === nextProps.region\r\n)\r\n","\r\nimport React from \"react\"\r\nimport Paper from \"@material-ui/core/Paper\"\r\nimport DefaultRegionLabel from \"../RegionLabel/main_RegionLabel\"\r\nimport LockIcon from \"@material-ui/icons/Lock\"\r\n\r\nconst copyWithout = (obj, ...args) => {\r\n  const newObj = { ...obj }\r\n  for (const arg of args) {\r\n    delete newObj[arg]\r\n  }\r\n  return newObj\r\n}\r\n\r\nexport const RegionTags = ({\r\n  regions,\r\n  projectRegionBox,\r\n  mouseEvents,\r\n  regionTagList,\r\n  onBeginRegionEdit,\r\n  onChangeRegion,\r\n  onCloseRegionEdit,\r\n  onDeleteRegion,\r\n  layoutParams,\r\n  imageSrc,\r\n  RegionEditLabel,\r\n  onRegionClassAdded,\r\n                               allowComments,\r\n}) => {\r\n  const RegionLabel =\r\n    RegionEditLabel != null ? RegionEditLabel : DefaultRegionLabel\r\n  return regions\r\n    .filter((r) => r.visible || r.visible === undefined)\r\n    .map((region) => {\r\n      const pbox = projectRegionBox(region)\r\n      const { iw, ih } = layoutParams.current\r\n      let margin = 8\r\n      if (region.highlighted && region.type === \"rectangle\") margin += 6\r\n      const labelBoxHeight =\r\n        region.editingLabels && !region.locked ? 170 : region.tags ? 60 : 50\r\n      const displayOnTop = pbox.y > labelBoxHeight\r\n\r\n      const coords = displayOnTop\r\n        ? {\r\n            left: pbox.x,\r\n            top: pbox.y - margin / 2,\r\n          }\r\n        : { left: pbox.x, top: pbox.y + pbox.h + margin / 2 }\r\n      if (region.locked) {\r\n        return (\r\n          <div\r\n            key={region.id}\r\n            style={{\r\n              position: \"absolute\",\r\n              ...coords,\r\n              zIndex: 10 + (region.editingLabels ? 5 : 0),\r\n            }}\r\n          >\r\n            <Paper\r\n              style={{\r\n                position: \"absolute\",\r\n                left: 0,\r\n                ...(displayOnTop ? { bottom: 0 } : { top: 0 }),\r\n                zIndex: 10,\r\n                backgroundColor: \"#fff\",\r\n                borderRadius: 4,\r\n                padding: 2,\r\n                paddingBottom: 0,\r\n                opacity: 0.5,\r\n                pointerEvents: \"none\",\r\n              }}\r\n            >\r\n              <LockIcon style={{ width: 16, height: 16, color: \"#333\" }} />\r\n            </Paper>\r\n          </div>\r\n        )\r\n      }\r\n      return (\r\n        <div\r\n          key={region.id}\r\n          style={{\r\n            position: \"absolute\",\r\n            ...coords,\r\n            zIndex: 10 + (region.editingLabels ? 5 : 0),\r\n            width: 200,\r\n          }}\r\n          onMouseDown={(e) => e.preventDefault()}\r\n          onMouseUp={(e) => e.preventDefault()}\r\n          onMouseEnter={(e) => {\r\n            if (region.editingLabels) {\r\n              mouseEvents.onMouseUp(e)\r\n              e.button = 1\r\n              mouseEvents.onMouseUp(e)\r\n            }\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              position: \"absolute\",\r\n              zIndex: 20,\r\n              left: 0,\r\n              ...(displayOnTop ? { bottom: 0 } : { top: 0 }),\r\n            }}\r\n            {...(!region.editingLabels\r\n              ? copyWithout(mouseEvents, \"onMouseDown\", \"onMouseUp\")\r\n              : {})}\r\n          >\r\n            <RegionLabel\r\n              allowedTags={regionTagList}\r\n              onOpen={onBeginRegionEdit}\r\n              onChange={onChangeRegion}\r\n              onClose={onCloseRegionEdit}\r\n              onDelete={onDeleteRegion}\r\n              editing={region.editingLabels}\r\n              region={region}\r\n              regions={regions}\r\n              imageSrc={imageSrc}\r\n              onRegionClassAdded={onRegionClassAdded}\r\n              allowComments={allowComments}\r\n            />\r\n          </div>\r\n        </div>\r\n      )\r\n    })\r\n}\r\n\r\nexport default RegionTags\r\n","import React, { Fragment, memo } from \"react\"\r\nimport { styled } from \"@material-ui/core/styles\"\r\n\r\nconst TransformMyStyles = styled(\"div\")({\r\n  width: 8,\r\n  height: 8,\r\n  zIndex: 2,\r\n  border: \"2px solid #FFF\",\r\n  position: \"absolute\",\r\n})\r\n\r\nconst boxCursorMap = [\r\n  [\"nw-resize\", \"n-resize\", \"ne-resize\"],\r\n  [\"w-resize\", \"grab\", \"e-resize\"],\r\n  [\"sw-resize\", \"s-resize\", \"se-resize\"],\r\n]\r\n\r\nconst arePropsEqual = (prev, next) => {\r\n  return (\r\n    prev.region === next.region &&\r\n    prev.dragWithPrimary === next.dragWithPrimary &&\r\n    prev.createWithPrimary === next.createWithPrimary &&\r\n    prev.zoomWithPrimary === next.zoomWithPrimary &&\r\n    prev.mat === next.mat\r\n  )\r\n}\r\n\r\nexport const RegionSelectAndTransformBox = memo(\r\n  ({\r\n    region: r,\r\n    mouseEvents,\r\n    projectRegionBox,\r\n    dragWithPrimary,\r\n    createWithPrimary,\r\n    zoomWithPrimary,\r\n    onBeginMovePoint,\r\n    onSelectRegion,\r\n    layoutParams,\r\n    mat,\r\n    onBeginBoxTransform,\r\n    onBeginMovePolygonPoint,\r\n       onBeginMovePolygon1Point,\r\n    onBeginMoveKeypoint,\r\n    onAddPolygonPoint,\r\n       onAddPolygon1Point,\r\n       onBeginCircleTransform\r\n  }) => {\r\n    const pbox = projectRegionBox(r)\r\n    const { iw, ih } = layoutParams.current\r\n    return (\r\n      <Fragment>\r\n        <div>\r\n          {r.type === \"rectangle\" &&\r\n            !dragWithPrimary &&\r\n            !zoomWithPrimary &&\r\n            !r.locked &&\r\n            r.highlighted &&\r\n            mat.a < 1.2 &&\r\n            [\r\n              [0, 0],\r\n              [0.5, 0],\r\n              [1, 0],\r\n              [1, 0.5],\r\n              [1, 1],\r\n              [0.5, 1],\r\n              [0, 1],\r\n              [0, 0.5],\r\n              [0.5, 0.5],\r\n            ].map(([px, py], i) => (\r\n              <TransformMyStyles\r\n                key={i}\r\n                {...mouseEvents}\r\n                onMouseDown={(e) => {\r\n                  if (e.button === 0)\r\n                    return onBeginBoxTransform(r, [px * 2 - 1, py * 2 - 1])\r\n                  mouseEvents.onMouseDown(e)\r\n                }}\r\n                style={{\r\n                  left: pbox.x - 4 - 2 + pbox.w * px,\r\n                  top: pbox.y - 4 - 2 + pbox.h * py,\r\n                  cursor: boxCursorMap[py * 2][px * 2],\r\n                  borderRadius: px === 0.5 && py === 0.5 ? 4 : undefined,\r\n                }}\r\n              />\r\n            ))}\r\n            {\r\n                r.type === \"circle\" &&\r\n                !dragWithPrimary &&\r\n                !zoomWithPrimary &&\r\n                !r.locked &&\r\n                r.highlighted &&\r\n                [\r\n                    [r.x, r.y],\r\n                    [(r.x*iw + Math.sqrt(Math.pow((r.xr-r.x)*iw,2) + Math.pow((r.yr-r.y)*ih,2)))/iw, r.y],\r\n                    [r.x, (r.y*ih + Math.sqrt(Math.pow((r.xr-r.x)*iw,2) + Math.pow((r.yr-r.y)*ih,2)))/ih],\r\n                    [(r.x*iw - Math.sqrt(Math.pow((r.xr-r.x)*iw,2) + Math.pow((r.yr-r.y)*ih,2)))/iw, r.y],\r\n                    [r.x, (r.y*ih - Math.sqrt(Math.pow((r.xr-r.x)*iw,2) + Math.pow((r.yr-r.y)*ih,2)))/ih]\r\n                ].map(([px, py], i) => {\r\n                    const proj = mat\r\n                        .clone()\r\n                        .inverse()\r\n                        .applyToPoint(px * iw, py * ih)\r\n                    return(\r\n                        <div\r\n                            key={i}\r\n                            // className={classes.transformGrabber}\r\n                            {...mouseEvents}\r\n                            onMouseDown={e => {\r\n                                if (e.button === 0 && i==0){\r\n                                    return onBeginCircleTransform(r, \"MOVE_REGION\")\r\n                                }else if(e.button === 0 && i!=0){\r\n                                    return onBeginCircleTransform(r, \"RESIZE_CIRCLE\")\r\n                                }\r\n                                mouseEvents.onMouseDown(e)\r\n                            }}\r\n                            style={{\r\n                                left: proj.x - 4,\r\n                                top: proj.y - 4,\r\n                                borderRadius: px === r.x && py === r.y ? 4 : undefined\r\n                            }}\r\n                        />\r\n                    )\r\n                })\r\n            }\r\n          {r.type === \"polygon\" &&\r\n            !dragWithPrimary &&\r\n            !zoomWithPrimary &&\r\n            !r.locked &&\r\n            r.highlighted &&\r\n            r.points.map(([px, py], i) => {\r\n              const proj = mat\r\n                .clone()\r\n                .inverse()\r\n                .applyToPoint(px * iw, py * ih)\r\n              return (\r\n                <TransformMyStyles\r\n                  key={i}\r\n                  {...mouseEvents}\r\n                  onMouseDown={(e) => {\r\n                    if (e.button === 0 && (!r.open || i === 0))\r\n                      return onBeginMovePolygonPoint(r, i)\r\n                    mouseEvents.onMouseDown(e)\r\n                  }}\r\n                  style={{\r\n                    cursor: !r.open ? \"move\" : i === 0 ? \"pointer\" : undefined,\r\n                    zIndex: 10,\r\n                    pointerEvents:\r\n                      r.open && i === r.points.length - 1 ? \"none\" : undefined,\r\n                    left: proj.x - 4,\r\n                    top: proj.y - 4,\r\n                  }}\r\n                />\r\n              )\r\n            })}\r\n            {r.type === \"polygon1\" &&\r\n            !dragWithPrimary &&\r\n            !zoomWithPrimary &&\r\n            !r.locked &&\r\n            r.highlighted &&\r\n            r.points.map(([px, py], i) => {\r\n                const proj = mat\r\n                    .clone()\r\n                    .inverse()\r\n                    .applyToPoint(px * iw, py * ih)\r\n                return (\r\n                    <TransformMyStyles\r\n                        key={i}\r\n                        {...mouseEvents}\r\n                        onMouseDown={(e) => {\r\n                            if (e.button === 0 && (!r.open || i === 0))\r\n                                return onBeginMovePolygon1Point(r, i)\r\n                            mouseEvents.onMouseDown(e)\r\n                        }}\r\n                        style={{\r\n                            cursor: !r.open ? \"move\" : i === 0 ? \"pointer\" : undefined,\r\n                            zIndex: 10,\r\n                            pointerEvents:\r\n                                r.open && i === r.points.length - 1 ? \"none\" : undefined,\r\n                            left: proj.x - 4,\r\n                            top: proj.y - 4,\r\n                        }}\r\n                    />\r\n                )\r\n            })}\r\n          {r.type === \"polygon\" &&\r\n            r.highlighted &&\r\n            !dragWithPrimary &&\r\n            !zoomWithPrimary &&\r\n            !r.locked &&\r\n            !r.open &&\r\n            r.points.length > 1 &&\r\n            r.points\r\n              .map((p1, i) => [p1, r.points[(i + 1) % r.points.length]])\r\n              .map(([p1, p2]) => [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2])\r\n              .map((pa, i) => {\r\n                const proj = mat\r\n                  .clone()\r\n                  .inverse()\r\n                  .applyToPoint(pa[0] * iw, pa[1] * ih)\r\n                return (\r\n                  <TransformMyStyles\r\n                    key={i}\r\n                    {...mouseEvents}\r\n                    onMouseDown={(e) => {\r\n                      if (e.button === 0) return onAddPolygonPoint(r, pa, i + 1)\r\n                      mouseEvents.onMouseDown(e)\r\n                    }}\r\n                    style={{\r\n                      cursor: \"copy\",\r\n                      zIndex: 10,\r\n                      left: proj.x - 4,\r\n                      top: proj.y - 4,\r\n                      border: \"2px dotted #fff\",\r\n                      opacity: 0.5,\r\n                    }}\r\n                  />\r\n                )\r\n              })}\r\n            {r.type === \"polygon1\" &&\r\n            r.highlighted &&\r\n            !dragWithPrimary &&\r\n            !zoomWithPrimary &&\r\n            !r.locked &&\r\n            !r.open &&\r\n            r.points.length > 1 &&\r\n            r.points\r\n                .map((p1, i) => [p1, r.points[(i + 1) % r.points.length]])\r\n                .map(([p1, p2]) => [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2])\r\n                .map((pa, i) => {\r\n                    const proj = mat\r\n                        .clone()\r\n                        .inverse()\r\n                        .applyToPoint(pa[0] * iw, pa[1] * ih)\r\n                    return (\r\n                        <TransformMyStyles\r\n                            key={i}\r\n                            {...mouseEvents}\r\n                            onMouseDown={(e) => {\r\n                                if (e.button === 0) return onAddPolygon1Point(r, pa, i + 1)\r\n                                mouseEvents.onMouseDown(e)\r\n                            }}\r\n                            style={{\r\n                                cursor: \"copy\",\r\n                                zIndex: 10,\r\n                                left: proj.x - 4,\r\n                                top: proj.y - 4,\r\n                                border: \"2px dotted #fff\",\r\n                                opacity: 0.5,\r\n                            }}\r\n                        />\r\n                    )\r\n                })}\r\n        </div>\r\n      </Fragment>\r\n    )\r\n  },\r\n  arePropsEqual\r\n)\r\n\r\nexport const RegionSelectAndTransformBoxes = memo(\r\n  (props) => {\r\n    return props.regions\r\n      .filter((r) => r.visible || r.visible === undefined)\r\n      .filter((r) => !r.locked)\r\n      .map((r, i) => {\r\n        return <RegionSelectAndTransformBox key={r.id} {...props} region={r} />\r\n      })\r\n  },\r\n  (n, p) => n.regions === p.regions && n.mat === p.mat\r\n)\r\n\r\nexport default RegionSelectAndTransformBoxes\r\n","\r\nimport React, { useRef, useEffect, useMemo, useState } from \"react\"\r\nimport { styled } from \"@material-ui/core/styles\"\r\nimport useEventCallback from \"use-event-callback\"\r\n\r\nconst StyledImage = styled(\"img\")({\r\n  zIndex: 0,\r\n  position: \"absolute\",\r\n})\r\n\r\nconst Error = styled(\"div\")({\r\n  zIndex: 0,\r\n  position: \"absolute\",\r\n  left: 0,\r\n  right: 0,\r\n  bottom: 0,\r\n  top: 0,\r\n  backgroundColor: \"rgba(255,0,0,0.2)\",\r\n  color: \"#ff0000\",\r\n  fontWeight: \"bold\",\r\n  whiteSpace: \"pre-wrap\",\r\n  padding: 50,\r\n})\r\n\r\nexport default ({\r\n  imagePosition,\r\n  mouseEvents,\r\n  imageSrc,\r\n  onLoad,\r\n  useCrossOrigin = false,\r\n}) => {\r\n  // const settings = useSettings()\r\n  const imageRef = useRef()\r\n  const [error, setError] = useState()\r\n\r\n  const onImageLoaded = useEventCallback((event) => {\r\n    const imageElm = event.currentTarget\r\n    if (onLoad)\r\n      onLoad({\r\n        naturalWidth: imageElm.naturalWidth,\r\n        naturalHeight: imageElm.naturalHeight,\r\n        imageElm,\r\n      })\r\n  })\r\n  const onImageError = useEventCallback((event) => {\r\n    setError(\r\n      `Could not load image\\n\\nMake sure your image works by visiting ${\r\n        imageSrc \r\n      } in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.${\r\n        !useCrossOrigin\r\n          ? \"\"\r\n          : `\\n\\nYour image may be blocked because it's not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you're using an S3 bucket or own the server hosting your images.`\r\n      }\\n\\n If you need a hand, reach out to the community at universaldatatool.slack.com`\r\n    )\r\n  })\r\n\r\n  const stylePosition = useMemo(() => {\r\n    let width = imagePosition.bottomRight.x - imagePosition.topLeft.x\r\n    let height = imagePosition.bottomRight.y - imagePosition.topLeft.y\r\n    return {\r\n      imageRendering: \"pixelated\",\r\n      left: imagePosition.topLeft.x,\r\n      top: imagePosition.topLeft.y,\r\n      width: isNaN(width) ? 0 : width,\r\n      height: isNaN(height) ? 0 : height,\r\n    }\r\n  }, [\r\n    imagePosition.topLeft.x,\r\n    imagePosition.topLeft.y,\r\n    imagePosition.bottomRight.x,\r\n    imagePosition.bottomRight.y,\r\n  ])\r\n\r\n  if (!imageSrc)\r\n    return <Error>No imageSrc or videoSrc provided</Error>\r\n\r\n  if (error) return <Error>{error}</Error>\r\n\r\n  return  (\r\n    <StyledImage\r\n      {...mouseEvents}\r\n      src={imageSrc}\r\n      ref={imageRef}\r\n      style={stylePosition}\r\n      onLoad={onImageLoaded}\r\n      onError={onImageError}\r\n      crossOrigin={useCrossOrigin ? \"anonymous\" : undefined}\r\n    />\r\n  )\r\n}\r\n","import React, { useMemo } from \"react\"\r\nimport { HotKeys } from \"react-hotkeys\"\r\n\r\nexport const defaultHotkeys = [\r\n  {\r\n    id: \"zoom_tool\",\r\n    description: \"Select the Zoom Tool\",\r\n  },\r\n  {\r\n    id: \"create_point\",\r\n    description: \"Create a point\",\r\n  },\r\n  {\r\n    id: \"create_rectangle\",\r\n    description: \"Create a rectangle\",\r\n  },\r\n  {\r\n    id: \"pan_tool\",\r\n    description: \"Select the Pan Tool\",\r\n  },\r\n  {\r\n    id: \"create_polygon\",\r\n    description: \"Create a Polygon\",\r\n  },\r\n  {\r\n    id: \"create_polygon1\",\r\n    description: \"Create a Polygon with Holes\",\r\n  },\r\n  {\r\n    id: \"create_circle\",\r\n    description: \"Create a Ellipse\",\r\n  },\r\n  {\r\n    id: \"save_and_previous_sample\",\r\n    description: \"Save and go to previous sample\",\r\n  },\r\n  {\r\n    id: \"save_and_next_sample\",\r\n    description: \"Save and go to next sample\",\r\n  },\r\n  {\r\n    id: \"save_and_exit_sample\",\r\n    description: \"Save and exit current sample\",\r\n  },\r\n  {\r\n    id: \"exit_sample\",\r\n    description: \"Exit sample without saving\",\r\n  },\r\n  {\r\n    id: \"delete_region\",\r\n    description: \"Delete selected region\",\r\n  },\r\n  {\r\n    id: \"undo\",\r\n    description: \"Undo latest change\",\r\n  },\r\n]\r\nexport const defaultKeyMap = {}\r\nfor (const { id, binding } of defaultHotkeys) defaultKeyMap[id] = binding\r\n\r\nexport const useDispatchHotkeyHandlers = ({ dispatch }) => {\r\n  const handlers = useMemo(\r\n    () => ({\r\n\r\n      zoom_tool: () => {\r\n        dispatch({\r\n          type: \"SELECT_TOOL\",\r\n          selectedTool: \"zoom\",\r\n        })\r\n      },\r\n      create_point: () => {\r\n        dispatch({\r\n          type: \"SELECT_TOOL\",\r\n          selectedTool: \"create-point\",\r\n        })\r\n      },\r\n      create_rectangle: () => {\r\n        dispatch({\r\n          type: \"SELECT_TOOL\",\r\n          selectedTool: \"create-rectangle\",\r\n        })\r\n      },\r\n      pan_tool: () => {\r\n        dispatch({\r\n          type: \"SELECT_TOOL\",\r\n          selectedTool: \"pan\",\r\n        })\r\n      },\r\n      create_polygon: () => {\r\n        dispatch({\r\n          type: \"SELECT_TOOL\",\r\n          selectedTool: \"create-polygon\",\r\n        })\r\n      },\r\n      create_polygon1: () => {\r\n        dispatch({\r\n          type: \"SELECT_TOOL\",\r\n          selectedTool: \"create-polygon1\",\r\n        })\r\n      },\r\n      create_circle: () => {\r\n        dispatch({\r\n          type: \"SELECT_TOOL\",\r\n          selectedTool: \"create-circle\",\r\n        })\r\n      },\r\n\r\n      save_and_previous_sample: () => {\r\n        dispatch({\r\n          type: \"HEADER_BUTTON_CLICKED\",\r\n          buttonName: \"Prev\",\r\n        })\r\n      },\r\n      save_and_next_sample: () => {\r\n        dispatch({\r\n          type: \"HEADER_BUTTON_CLICKED\",\r\n          buttonName: \"Next\",\r\n        })\r\n      },\r\n      save_and_exit_sample: () => {\r\n        dispatch({\r\n          type: \"HEADER_BUTTON_CLICKED\",\r\n          buttonName: \"Save\",\r\n        })\r\n      },\r\n      delete_region: () => {\r\n        dispatch({\r\n          type: \"DELETE_SELECTED_REGION\",\r\n        })\r\n      },\r\n      undo: () => {\r\n        dispatch({\r\n          type: \"RESTORE_HISTORY\",\r\n        })\r\n      },\r\n    }),\r\n    [dispatch]\r\n  )\r\n  return handlers\r\n}\r\n\r\nexport default ({ children, dispatch }) => {\r\n  const handlers = useDispatchHotkeyHandlers({ dispatch })\r\n  return (\r\n    <HotKeys allowChanges handlers={handlers}>\r\n      {children}\r\n    </HotKeys>\r\n  )\r\n}\r\n","\r\nimport React, { memo } from \"react\"\r\nimport colorAlpha from \"color-alpha\"\r\n\r\nfunction clamp(num, min, max) {\r\n  return num <= min ? min : num >= max ? max : num\r\n}\r\n\r\nconst RegionComponents = {\r\n  point: memo(({ region, iw, ih }) => (\r\n    <g transform={`translate(${region.x * iw} ${region.y * ih})`}>\r\n      <path\r\n        d={\"M0 8L8 0L0 -8L-8 0Z\"}\r\n        strokeWidth={2}\r\n        stroke={region.color}\r\n        fill=\"transparent\"\r\n      />\r\n    </g>\r\n  )),\r\n    rectangle: memo(({ region, iw, ih }) => (\r\n    <g transform={`translate(${region.x * iw} ${region.y * ih})`}>\r\n      <rect\r\n        strokeWidth={2}\r\n        x={0}\r\n        y={0}\r\n        width={Math.max(region.w * iw, 0)}\r\n        height={Math.max(region.h * ih, 0)}\r\n        stroke={colorAlpha(region.color, 0.75)}\r\n        fill={colorAlpha(region.color, 0.25)}\r\n      />\r\n    </g>\r\n  )),\r\n    circle: memo(({ region, iw, ih }) => (\r\n        <g transform={`translate(${region.x * iw} ${region.y * ih})`}>\r\n            <ellipse\r\n                strokeWidth={2}\r\n                rx={Math.max(region.xr*iw,0)}\r\n                ry={Math.max(region.yr*ih,0)}\r\n                cx={region.x}\r\n                cy={region.y}\r\n                stroke={colorAlpha(region.color, 0.75)}\r\n                fill={colorAlpha(region.color, 0.25)}\r\n            />\r\n        </g>\r\n    )),\r\n  polygon1: memo(({ region, iw, ih, fullSegmentationMode }) => {\r\n    const Component = region.open? \"polyline\" : \"polygon\"\r\n\r\n      // const Hole=region.creatingHole ? \"polyline\" : \"polygon\"\r\n    return (\r\n      <Component\r\n          // paths={[region.points,region.holes]}\r\n        points={region.points\r\n          .map(([x, y]) => [x * iw, y * ih])\r\n          .map((a) => a.join(\" \"))\r\n          .join(\" \")}\r\n        // holes={region.holes\r\n        //     .map(([x, y]) => [x * iw, y * ih])\r\n        //     .map((a) => a.join(\" \"))\r\n        //     .join(\" \")}\r\n        strokeWidth={2}\r\n        stroke={colorAlpha(region.color, 0.75)}\r\n        fill={colorAlpha(region.color, 0.25)}>\r\n\r\n         </Component>\r\n\r\n\r\n    )\r\n  }),\r\n    polygon: memo(({ region, iw, ih, fullSegmentationMode }) => {\r\n        const Component = region.open ? \"polyline\" : \"polygon\"\r\n        return (\r\n            <Component\r\n                points={region.points\r\n                    .map(([x, y]) => [x * iw, y * ih])\r\n                    .map((a) => a.join(\" \"))\r\n                    .join(\" \")}\r\n                strokeWidth={2}\r\n                stroke={colorAlpha(region.color, 0.75)}\r\n                fill={colorAlpha(region.color, 0.25)}\r\n            />\r\n        )\r\n    }),\r\n  pixel: () => null,\r\n}\r\n\r\n\r\nexport const WrappedRegionList = memo(\r\n  ({ regions, keypointDefinitions, iw, ih, fullSegmentationMode }) => {\r\n    return regions\r\n      .filter((r) => r.visible !== false)\r\n      .map((r) => {\r\n        const Component = RegionComponents[r.type]\r\n        return (\r\n          <Component\r\n            key={r.regionId}\r\n            region={r}\r\n            iw={iw}\r\n            ih={ih}\r\n          />\r\n        )\r\n      })\r\n  },\r\n  (n, p) => n.regions === p.regions && n.iw === p.iw && n.ih === p.ih\r\n)\r\n\r\nexport const RegionShapes = ({\r\n  mat,\r\n  imagePosition,\r\n  regions = [],\r\n}) => {\r\n  const iw = imagePosition.bottomRight.x - imagePosition.topLeft.x\r\n  const ih = imagePosition.bottomRight.y - imagePosition.topLeft.y\r\n  if (isNaN(iw) || isNaN(ih)) return null\r\n  return (\r\n    <svg\r\n      width={iw}\r\n      height={ih}\r\n      style={{\r\n        position: \"absolute\",\r\n        zIndex: 2,\r\n        left: imagePosition.topLeft.x,\r\n        top: imagePosition.topLeft.y,\r\n        pointerEvents: \"none\",\r\n        width: iw,\r\n        height: ih,\r\n      }}\r\n    >\r\n      <WrappedRegionList\r\n        key=\"wrapped-region-list\"\r\n        regions={regions}\r\n        iw={iw}\r\n        ih={ih}\r\n      />\r\n    </svg>\r\n  )\r\n}\r\n\r\nexport default RegionShapes\r\n","import React, {\r\n  useRef,\r\n  useState,\r\n  useLayoutEffect,\r\n  useEffect,\r\n  useMemo,\r\n} from \"react\"\r\nimport { Matrix } from \"transformation-matrix-js\"\r\nimport type {\r\n  Region,\r\n  Point,\r\n  Polygon,\r\n  Polygon1,\r\n  Rectangle,\r\n  Circle\r\n} from \"./regionTools.js\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport styles from \"./styles_ImageCanvas\"\r\nimport useMouse from \"./useMouse\"\r\nimport useProjectRegionBox from \"./useProjectBox\"\r\nimport { useRafState } from \"react-use\"\r\nimport RegionTags from \"../RegionTags/main_RegionTags\"\r\nimport RegionSelectAndTransformBoxes from \"../TransformBoxes/main_TransformBoxes\"\r\nimport ImageCanvasBackground from \"./background\"\r\nimport useEventCallback from \"use-event-callback\"\r\nimport RegionShapes from \"../RegionShapes/main_RegionShapes\"\r\n\r\n// get style from style.js\r\nconst myStyle = makeStyles(styles)\r\n\r\ntype Props = {\r\n  regions: Array<Region>,\r\n  imageSrc?: string,\r\n  onMouseMove?: ({ x: number, y: number }) => any,\r\n  onMouseDown?: ({ x: number, y: number }) => any,\r\n  onMouseUp?: ({ x: number, y: number }) => any,\r\n  dragWithPrimary?: boolean,\r\n  zoomWithPrimary?: boolean,\r\n  createWithPrimary?: boolean,\r\n  realSize?: { width: number, height: number, unitName: string },\r\n  regionTagList?: Array<string>,\r\n  allowedArea?: { x: number, y: number, w: number, h: number },\r\n  allowComments?: Boolean,\r\n  onChangeRegion: (Region) => any,\r\n  onBeginRegionEdit: (Region) => any,\r\n  onCloseRegionEdit: (Region) => any,\r\n  onDeleteRegion: (Region) => any,\r\n  onBeginBoxTransform: (Rectangle, [number, number]) => any,\r\n  onBeginMovePolygonPoint: (Polygon, index: number) => any,\r\n  onAddPolygonPoint: (Polygon, point: [number, number], index: number) => any,\r\n  onBeginMovePolygon1Point: (Polygon1, index1: number) => any,\r\n  onAddPolygon1Point: (Polygon1, Polygon1Index:number, point1: [number, number], index1: number) => any,\r\n  onBeginCircleTransform: (Circle, directions: string) => any,\r\n  onSelectRegion: (Region) => any,\r\n  onBeginMovePoint: (Point) => any,\r\n  onLoaded: ({\r\n    naturalWidth: number,\r\n    naturalHeight: number,\r\n  }) => any,\r\n  onRegionClassAdded: () => {},\r\n}\r\nconst getCanvasDimension = (allowedArea = null, { iw, ih } = {}) => {\r\n  let dimension = Matrix.from(1, 0, 0, 1, -10, -10)\r\n  if (allowedArea && iw) {\r\n    dimension = dimension\r\n      .translate(allowedArea.x * iw, allowedArea.y * ih)\r\n      .scaleU(allowedArea.w + 0.05)\r\n  }\r\n  return dimension\r\n}\r\n\r\nexport const ImageCanvas = ({\r\n  regions,\r\n  imageSrc,\r\n  onMouseMove = (p) => null,\r\n  onMouseDown = (p) => null,\r\n  onMouseUp = (p) => null,\r\n  dragWithPrimary = false,\r\n  zoomWithPrimary = false,\r\n  createWithPrimary = false,\r\n  regionTagList,\r\n  allowedArea,\r\n  onLoaded,\r\n  onChangeRegion,\r\n  onBeginRegionEdit,\r\n  onCloseRegionEdit,\r\n  onBeginBoxTransform,\r\n  onBeginMovePolygonPoint,\r\n  onAddPolygonPoint,\r\n  onBeginMovePolygon1Point,\r\n  onAddPolygon1Point,\r\n  onBeginMoveKeypoint,\r\n  onSelectRegion,\r\n  onBeginMovePoint,\r\n  onDeleteRegion,\r\n  onRegionClassAdded,\r\n  zoomOnAllowedArea = true,\r\n  allowComments,\r\nnBeginCircleTransform,\r\n}: Props) => {\r\n  const classes = myStyle()\r\n\r\n  const canvasEl = useRef(null)\r\n  const layoutParams = useRef({})\r\n  const [dragging, changeDragging] = useRafState(false)\r\n  const [zoomStart, changeZoomStart] = useRafState(null)\r\n  const [zoomEnd, changeZoomEnd] = useRafState(null)\r\n  const [mat, changeMat] = useRafState(getCanvasDimension())\r\n\r\n  const { mouseEvents, mousePosition } = useMouse({\r\n    canvasEl,\r\n    dragging,\r\n    mat,\r\n    layoutParams,\r\n    changeMat,\r\n    zoomStart,\r\n    zoomEnd,\r\n    changeZoomStart,\r\n    changeZoomEnd,\r\n    changeDragging,\r\n    zoomWithPrimary,\r\n    dragWithPrimary,\r\n    onMouseMove,\r\n    onMouseDown,\r\n    onMouseUp,\r\n  })\r\n\r\n\r\n\r\n  const projectRegionBox = useProjectRegionBox({ layoutParams, mat })\r\n\r\n  const [imageDimensions, changeImageDimensions] = useState()\r\n  const imageLoaded = Boolean(imageDimensions && imageDimensions.naturalWidth)\r\n\r\n  const ImageLoaded = useEventCallback(\r\n    ({ naturalWidth, naturalHeight}) => {\r\n      const dims = { naturalWidth, naturalHeight}\r\n      if (onLoaded) onLoaded(dims)\r\n      changeImageDimensions(dims)\r\n\r\n    }\r\n  )\r\n  const canvas = canvasEl.current\r\n  if (canvas && imageLoaded) {\r\n    const { clientWidth, clientHeight } = canvas\r\n\r\n    const fitScale = Math.max(\r\n      imageDimensions.naturalWidth / (clientWidth - 20),\r\n      imageDimensions.naturalHeight / (clientHeight - 20)\r\n    )\r\n\r\n    const [iw, ih] = [\r\n      imageDimensions.naturalWidth / fitScale,\r\n      imageDimensions.naturalHeight / fitScale,\r\n    ]\r\n\r\n    layoutParams.current = {\r\n      iw,\r\n      ih,\r\n      fitScale,\r\n      canvasWidth: clientWidth,\r\n      canvasHeight: clientHeight,\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!imageLoaded) return\r\n    changeMat(\r\n        getCanvasDimension(\r\n        zoomOnAllowedArea ? allowedArea : null,\r\n        layoutParams.current\r\n      )\r\n    )\r\n  }, [imageLoaded])\r\n\r\n  useLayoutEffect(() => {\r\n    if (!imageDimensions) return\r\n    const { clientWidth, clientHeight } = canvas\r\n    canvas.width = clientWidth\r\n    canvas.height = clientHeight\r\n    const context = canvas.getContext(\"2d\")\r\n\r\n    context.save()\r\n    context.transform(...mat.clone().inverse().toArray())\r\n\r\n    const { iw, ih } = layoutParams.current\r\n\r\n    if (allowedArea) {\r\n      // Pattern to indicate the NOT allowed areas\r\n      const { x, y, w, h } = allowedArea\r\n      context.save()\r\n      context.globalAlpha = 1\r\n      const outer = [\r\n        [0, 0],\r\n        [iw, 0],\r\n        [iw, ih],\r\n        [0, ih],\r\n      ]\r\n      const inner = [\r\n        [x * iw, y * ih],\r\n        [x * iw + w * iw, y * ih],\r\n        [x * iw + w * iw, y * ih + h * ih],\r\n        [x * iw, y * ih + h * ih],\r\n      ]\r\n      context.moveTo(...outer[0])\r\n      outer.forEach((p) => context.lineTo(...p))\r\n      context.lineTo(...outer[0])\r\n      context.closePath()\r\n\r\n      inner.reverse()\r\n      context.moveTo(...inner[0])\r\n      inner.forEach((p) => context.lineTo(...p))\r\n      context.lineTo(...inner[0])\r\n\r\n      context.fill()\r\n\r\n      context.restore()\r\n    }\r\n\r\n    context.restore()\r\n  })\r\n\r\n  const { iw, ih } = layoutParams.current\r\n\r\n  let zoomBox =\r\n    !zoomStart || !zoomEnd\r\n      ? null\r\n      : {\r\n          ...mat.clone().inverse().applyToPoint(zoomStart.x, zoomStart.y),\r\n          w: (zoomEnd.x - zoomStart.x) / mat.a,\r\n          h: (zoomEnd.y - zoomStart.y) / mat.d,\r\n        }\r\n  if (zoomBox) {\r\n    if (zoomBox.w < 0) {\r\n      zoomBox.x += zoomBox.w\r\n      zoomBox.w *= -1\r\n    }\r\n    if (zoomBox.h < 0) {\r\n      zoomBox.y += zoomBox.h\r\n      zoomBox.h *= -1\r\n    }\r\n  }\r\n\r\n  const imagePosition = {\r\n    topLeft: mat.clone().inverse().applyToPoint(0, 0),\r\n    bottomRight: mat.clone().inverse().applyToPoint(iw, ih),\r\n  }\r\n\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        width: \"100%\",\r\n        height: \"100%\",\r\n        maxHeight: \"calc(100vh - 68px)\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n        cursor: createWithPrimary\r\n          ? \"crosshair\"\r\n          : dragging\r\n          ? \"grabbing\"\r\n          : dragWithPrimary\r\n          ? \"grab\"\r\n          : zoomWithPrimary\r\n          ? mat.a < 1\r\n            ? \"zoom-out\"\r\n            : \"zoom-in\"\r\n          : undefined,\r\n      }}\r\n    >\r\n      {imageLoaded && !dragging && (\r\n        <RegionSelectAndTransformBoxes\r\n          key=\"regionSelectAndTransformBoxes\"\r\n          regions={\r\n             !allowedArea\r\n              ? regions\r\n              : [\r\n                  {\r\n                    type: \"rectangle\",\r\n                    id: \"$$allowed_area\",\r\n                    cls: \"allowed_area\",\r\n                    highlighted: true,\r\n                    x: allowedArea.x,\r\n                    y: allowedArea.y,\r\n                    w: allowedArea.w,\r\n                    h: allowedArea.h,\r\n                    visible: true,\r\n                    color: \"#ff0\",\r\n                  },\r\n                ]\r\n          }\r\n          mouseEvents={mouseEvents}\r\n          projectRegionBox={projectRegionBox}\r\n          dragWithPrimary={dragWithPrimary}\r\n          createWithPrimary={createWithPrimary}\r\n          zoomWithPrimary={zoomWithPrimary}\r\n          onBeginMovePoint={onBeginMovePoint}\r\n          onSelectRegion={onSelectRegion}\r\n          layoutParams={layoutParams}\r\n          mat={mat}\r\n          onBeginBoxTransform={onBeginBoxTransform}\r\n          onBeginMovePolygonPoint={onBeginMovePolygonPoint}\r\n          onBeginMoveKeypoint={onBeginMoveKeypoint}\r\n          onAddPolygonPoint={onAddPolygonPoint}\r\n          onAddPolygon1Point={onAddPolygon1Point}\r\n          onBeginMovePolygon1Point={onBeginMovePolygon1Point}\r\n        />\r\n      )}\r\n      {imageLoaded  && !dragging && (\r\n        <div key=\"regionTags\">\r\n          <RegionTags\r\n            regions={regions}\r\n            projectRegionBox={projectRegionBox}\r\n            mouseEvents={mouseEvents}\r\n            regionTagList={regionTagList}\r\n            onBeginRegionEdit={onBeginRegionEdit}\r\n            onChangeRegion={onChangeRegion}\r\n            onCloseRegionEdit={onCloseRegionEdit}\r\n            onDeleteRegion={onDeleteRegion}\r\n            layoutParams={layoutParams}\r\n            imageSrc={imageSrc}\r\n            onRegionClassAdded={onRegionClassAdded}\r\n            allowComments={allowComments}\r\n          />\r\n       </div>\r\n      )}\r\n\r\n      {zoomWithPrimary && zoomBox !== null && (\r\n        <div\r\n          key=\"zoomBox\"\r\n          style={{\r\n            position: \"absolute\",\r\n            zIndex: 1,\r\n            border: \"1px solid #fff\",\r\n            pointerEvents: \"none\",\r\n            left: zoomBox.x,\r\n            top: zoomBox.y,\r\n            width: zoomBox.w,\r\n            height: zoomBox.h,\r\n          }}\r\n        />\r\n      )}\r\n\r\n      <div\r\n        style={{ width: \"100%\", height: \"100%\" }}\r\n        {...mouseEvents}\r\n      >\r\n\r\n        <>\r\n          <canvas\r\n            style={{ opacity: 0.25 }}\r\n            className={classes.canvas}\r\n            ref={canvasEl}\r\n          />\r\n          <RegionShapes\r\n            imagePosition={imagePosition}\r\n            regions={regions}\r\n          />\r\n          <ImageCanvasBackground\r\n            imagePosition={imagePosition}\r\n            mouseEvents={mouseEvents}\r\n            onLoad={ImageLoaded}\r\n            imageSrc={imageSrc}\r\n          />\r\n        </>\r\n      </div>\r\n      <div className={classes.zoomIndicator}>\r\n        {((1 / mat.a) * 100).toFixed(0)}%\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ImageCanvas\r\n","\r\nexport default {\r\n  canvas: { width: \"100%\", height: \"100%\", position: \"relative\", zIndex: 1 },\r\n  zoomIndicator: {\r\n    position: \"absolute\",\r\n    bottom: 16,\r\n    right: 0,\r\n    backgroundColor: \"rgba(0,0,0,0.4)\",\r\n    color: \"#fff\",\r\n    opacity: 0.5,\r\n    fontWeight: \"bolder\",\r\n    fontSize: 14,\r\n    padding: 4,\r\n  },\r\n}\r\n","import { grey } from \"@material-ui/core/colors\"\r\n\r\nexport default {\r\n  container: {\r\n    display: \"flex\",\r\n    flexGrow: 1,\r\n    flexDirection: \"column\",\r\n    height: \"100%\",\r\n    maxHeight: \"100vh\",\r\n    backgroundColor: \"#fff\",\r\n    overflow: \"hidden\",\r\n    \"&.fullscreen\": {\r\n      position: \"absolute\",\r\n      zIndex: 99999,\r\n      left: 0,\r\n      right: 0,\r\n      top: 0,\r\n      bottom: 0,\r\n    },\r\n  },\r\n  headerTitle: {\r\n    fontWeight: \"bold\",\r\n    color: grey[700],\r\n    paddingLeft: 16,\r\n  },\r\n}\r\n","import { getIn } from \"seamless-immutable\"\r\n\r\nexport default (state) => {\r\n  let currentImageIndex = null,\r\n    pathToActiveImage,\r\n    activeImage\r\n  if (state.annotationType === \"image\") {\r\n    currentImageIndex = state.selectedImage\r\n    if (currentImageIndex === -1) {\r\n      currentImageIndex = null\r\n      activeImage = null\r\n    } else {\r\n      pathToActiveImage = [\"images\", currentImageIndex]\r\n      activeImage = getIn(state, pathToActiveImage)\r\n    }\r\n  }\r\n  return { currentImageIndex, pathToActiveImage, activeImage }\r\n}\r\n","// @flow\r\n\r\nimport React from \"react\"\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\r\nimport {\r\n  faCrosshairs,\r\n  faDrawPolygon,\r\n  faVectorSquare,\r\n  faHandPaper,\r\n  faSearch,\r\n    faMinusSquare,\r\n} from \"@fortawesome/free-solid-svg-icons\"\r\nimport { faCircle } from \"@fortawesome/free-regular-svg-icons\"\r\n\r\nconst faStyle = { marginTop: 4, width: 16, height: 16, marginBottom: 4 }\r\n\r\nexport const iconDictionary = {\r\n  pan: () => (\r\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faHandPaper} />\r\n  ),\r\n  zoom: () => (\r\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faSearch} />\r\n  ),\r\n  \"create-point\": () => (\r\n    <FontAwesomeIcon style={faStyle} size=\"xs\" fixedWidth icon={faCrosshairs} />\r\n  ),\r\n  \"create-rectangle\": () => (\r\n    <FontAwesomeIcon\r\n      style={faStyle}\r\n      size=\"xs\"\r\n      fixedWidth\r\n      icon={faVectorSquare}\r\n    />\r\n  ),\r\n  \"create-polygon\": () => (\r\n    <FontAwesomeIcon\r\n      style={faStyle}\r\n      size=\"xs\"\r\n      fixedWidth\r\n      icon={faDrawPolygon}\r\n    />\r\n  ),\r\n  \"create-polygon1\": () => (\r\n      <FontAwesomeIcon\r\n          style={faStyle}\r\n          size=\"xs\"\r\n          fixedWidth\r\n          icon={faMinusSquare}\r\n      />\r\n  ),\r\n  \"create-circle\": () => (\r\n      <FontAwesomeIcon\r\n          style={faStyle}\r\n          size=\"xs\"\r\n          fixedWidth\r\n          icon={faCircle}\r\n      />\r\n  ),\r\n\r\n\r\n}\r\n\r\nexport default iconDictionary\r\n","\r\nimport React, { useRef, useCallback } from \"react\"\r\nimport { makeStyles, styled } from \"@material-ui/core/styles\"\r\nimport ImageCanvas from \"../ImageCanvas/main_ImageCanvas\"\r\nimport styles from \"./styles_MainLayout\"\r\nimport type, { MainLayoutState, Action } from \"./types\"\r\nimport useKey from \"use-key-hook\"\r\nimport classnames from \"classnames\"\r\nimport getActiveImage from \"../reducers/getActiveImage\"\r\nimport { useDispatchHotkeyHandlers } from \"../ShortcutsManager/main_ShortcutsManager\"\r\nimport { withHotKeys } from \"react-hotkeys\"\r\nimport iconDictionary from \"./iconDictionary\"\r\nimport Workspace from \"react-material-workspace-layout/Workspace\"\r\nimport useEventCallback from \"use-event-callback\"\r\n// get style from style.js\r\n\r\nconst myStyle = makeStyles(styles)\r\n\r\nconst HotkeyDiv = withHotKeys(({ hotKeys, children, divRef, ...props }) => (\r\n  <div {...{ ...hotKeys, ...props }} ref={divRef}>\r\n    {children}\r\n  </div>\r\n))\r\n\r\ntype Props = {\r\n  state: MainLayoutState,\r\n  dispatchAction: (Action) => any,\r\n  onRegionClassAdded: () => {},\r\n}\r\n\r\nexport const MainLayout = ({\r\n  state,\r\n  dispatchAction,\r\n}: Props) => {\r\n  const classes = myStyle()\r\n\r\n  const memoizedActionFns = useRef({})\r\n  const action = (type: string, ...params: Array<string>) => {\r\n    const fnKey = `${type}(${params.join(\",\")})`\r\n    if (memoizedActionFns.current[fnKey])\r\n      return memoizedActionFns.current[fnKey]\r\n\r\n    const fn = (...args: any) =>\r\n      params.length > 0\r\n        ? dispatchAction(\r\n            ({\r\n              type,\r\n              ...params.reduce((acc, p, i) => ((acc[p] = args[i]), acc), {}),\r\n            }: any)\r\n          )\r\n        : dispatchAction({ type, ...args[0] })\r\n    memoizedActionFns.current[fnKey] = fn\r\n    return fn\r\n  }\r\n\r\n  const { currentImageIndex, activeImage } = getActiveImage(state)\r\n  let nextImage\r\n  if (currentImageIndex !== null) {\r\n    nextImage = state.images[currentImageIndex + 1]\r\n  }\r\n\r\n  useKey(() => dispatchAction({ type: \"CANCEL\" }), {\r\n    detectKeys: [27],\r\n  })\r\n\r\n  const innerContainerRef = useRef()\r\n  const hotkeyHandlers = useDispatchHotkeyHandlers({ dispatchAction })\r\n  const refocusOnMouseEvent = useCallback((e) => {\r\n    if (!innerContainerRef.current) return\r\n    if (innerContainerRef.current.contains(document.activeElement)) return\r\n    if (innerContainerRef.current.contains(e.target)) {\r\n      innerContainerRef.current.focus()\r\n      e.target.focus()\r\n    }\r\n  }, [])\r\n\r\n  const canvas = (\r\n    <ImageCanvas\r\n      key={state.selectedImage}\r\n      showTags={state.showTags}\r\n      regionTagList={state.regionTagList}\r\n      regions={\r\n        activeImage.regions || []\r\n      }\r\n      realSize={activeImage ? activeImage.realSize : undefined}\r\n      imageSrc={state.annotationType === \"image\" ? activeImage.src : null}\r\n      pointDistancePrecision={state.pointDistancePrecision}\r\n      createWithPrimary={state.selectedTool.includes(\"create\")}\r\n      dragWithPrimary={state.selectedTool === \"pan\"}\r\n      zoomWithPrimary={state.selectedTool === \"zoom\"}\r\n      onMouseMove={action(\"MOUSE_MOVE\")}\r\n      onMouseDown={action(\"MOUSE_DOWN\")}\r\n      onMouseUp={action(\"MOUSE_UP\")}\r\n      onChangeRegion={action(\"CHANGE_REGION\", \"region\")}\r\n      onBeginRegionEdit={action(\"OPEN_REGION_EDITOR\", \"region\")}\r\n      onCloseRegionEdit={action(\"CLOSE_REGION_EDITOR\", \"region\")}\r\n      onDeleteRegion={action(\"DELETE_REGION\", \"region\")}\r\n      onBeginBoxTransform={action(\"BEGIN_BOX_TRANSFORM\", \"rectangle\", \"directions\")}\r\n      onBeginMovePolygonPoint={action(\r\n        \"BEGIN_MOVE_POLYGON_POINT\",\r\n        \"polygon\",\r\n        \"pointIndex\"\r\n      )}\r\n      onAddPolygonPoint={action(\r\n        \"ADD_POLYGON_POINT\",\r\n        \"polygon\",\r\n        \"point\",\r\n        \"pointIndex\"\r\n      )}\r\n      onBeginMovePolygon1Point={action(\r\n          \"BEGIN_MOVE_POLYGON1_POINT\",\r\n          \"polygon1\",\r\n          \"point1Index\"\r\n      )}\r\n      onAddPolygon1Point={action(\r\n          \"ADD_POLYGON1_POINT\",\r\n          \"polygon1\",\r\n          \"point1\",\r\n          \"point1Index\"\r\n      )}\r\n      onBeginCircleTransform={action(\r\n          \"BEGIN_CIRCLE_TRANSFORM\",\r\n          \"circle\",\r\n          \"directions\"\r\n      )}\r\n      onSelectRegion={action(\"SELECT_REGION\", \"region\")}\r\n      onBeginMovePoint={action(\"BEGIN_MOVE_POINT\", \"point\")}\r\n      onImageLoaded={action(\"IMAGE_LOADED\", \"image\")}\r\n      allowComments={state.allowComments}\r\n    />\r\n  )\r\n\r\n  const onClickIconSidebarItem = useEventCallback((item) => {\r\n    dispatchAction({ type: \"SELECT_TOOL\", selectedTool: item.name })\r\n  })\r\n\r\n  const onClickHeaderItem = useEventCallback((item) => {\r\n    dispatchAction({ type: \"HEADER_BUTTON_CLICKED\", buttonName: item.name })\r\n  })\r\n  return (\r\n        <HotkeyDiv\r\n          tabIndex={-1}\r\n          divRef={innerContainerRef}\r\n          onMouseDown={refocusOnMouseEvent}\r\n          onMouseOver={refocusOnMouseEvent}\r\n          allowChanges\r\n          handlers={hotkeyHandlers}\r\n          className={classnames(\r\n            classes.container,\r\n\r\n          )}\r\n        >\r\n          <Workspace\r\n            iconDictionary={iconDictionary}\r\n            headerLeftSide={[\r\n               activeImage ? (\r\n                <div className={classes.headerTitle}>{activeImage.name}</div>\r\n              ) : null,\r\n            ].filter(Boolean)}\r\n            headerItems={[\r\n              { name: \"Prev\" },\r\n              { name: \"Next\" },\r\n              { name: \"Save\" },\r\n            ].filter(Boolean)}\r\n            onClickHeaderItem={onClickHeaderItem}\r\n            onClickIconSidebarItem={onClickIconSidebarItem}\r\n            selectedTools={[\r\n              state.selectedTool,\r\n            ].filter(Boolean)}\r\n            iconSidebarItems={[\r\n              {\r\n                name: \"pan\",\r\n                helperText:\r\n                  \"Drag/Pan (right or middle click)\",\r\n                alwaysShowing: true,\r\n              },\r\n              {\r\n                name: \"zoom\",\r\n                helperText:\r\n                  \"Zoom In/Out\",\r\n                alwaysShowing: true,\r\n              },\r\n              {\r\n                name: \"create-point\",\r\n                helperText: \"Add Point\" ,\r\n              },\r\n              {\r\n                name: \"create-rectangle\",\r\n                helperText:\r\n                  \"Add Rectangle\" ,\r\n              },\r\n              {\r\n                name: \"create-polygon\",\r\n                helperText: \"Add Polygon\",\r\n              },\r\n              {\r\n                name: \"create-polygon1\",\r\n                helperText: \"Add Polygon with Holes\",\r\n              },\r\n              {\r\n                name: \"create-circle\",\r\n                helperText: \"Add Ellipse\",\r\n              },\r\n\r\n            ]\r\n              .filter(Boolean)\r\n              .filter(\r\n                (a) => a.alwaysShowing || state.enabledTools.includes(a.name)\r\n              )}\r\n\r\n          >\r\n            {canvas}\r\n          </Workspace>\r\n        </HotkeyDiv>\r\n  )\r\n}\r\n\r\nexport default MainLayout\r\n","\r\nimport type { MainLayoutState, Action } from \"../MainLayout/types\"\r\nimport { setIn, updateIn, asMutable, without } from \"seamless-immutable\"\r\nimport moment from \"moment\"\r\n\r\nconst typesToSaveWithHistory = {\r\n  BEGIN_BOX_TRANSFORM: \"Transform/Move Box\",\r\n  BEGIN_MOVE_POINT: \"Move Point\",\r\n  DELETE_REGION: \"Delete Region\",\r\n  BEGIN_CIRCLE_TRANSFORM: \"Transform/Move Circle\",\r\n}\r\n\r\nexport const saveToHistory = (state: MainLayoutState, name: string) =>\r\n  updateIn(state, [\"history\"], (h) =>\r\n    [\r\n      {\r\n        time: moment().toDate(),\r\n        state: without(state, \"history\"),\r\n        name,\r\n      },\r\n    ].concat((h || []).slice(0, 9))\r\n  )\r\n\r\nexport default (reducer) => {\r\n  return (state: MainLayoutState, action: Action) => {\r\n    const prevState = state\r\n    const nextState = reducer(state, action)\r\n\r\n    if (action.type === \"RESTORE_HISTORY\") {\r\n      if (state.history.length > 0) {\r\n        return setIn(\r\n          nextState.history[0].state,\r\n          [\"history\"],\r\n          nextState.history.slice(1)\r\n        )\r\n      }\r\n    } else {\r\n      if (\r\n        prevState !== nextState &&\r\n        Object.keys(typesToSaveWithHistory).includes(action.type)\r\n      ) {\r\n        return setIn(\r\n          nextState,\r\n          [\"history\"],\r\n          [\r\n            {\r\n              time: moment().toDate(),\r\n              state: without(prevState, \"history\"),\r\n              name: typesToSaveWithHistory[action.type] || action.type,\r\n            },\r\n          ]\r\n            .concat(nextState.history || [])\r\n            .slice(0, 9)\r\n        )\r\n      }\r\n    }\r\n\r\n    return nextState\r\n  }\r\n}\r\n","\r\n\r\nimport * as muiColors from \"@material-ui/core/colors\"\r\n\r\nexport const colors = [\r\n  muiColors.red[500],\r\n  muiColors.blue[500],\r\n  muiColors.green[500],\r\n  muiColors.orange[800],\r\n  muiColors.brown[500],\r\n  muiColors.lightGreen[700],\r\n  muiColors.pink[500],\r\n  muiColors.purple[500],\r\n  muiColors.indigo[500],\r\n  muiColors.teal[500],\r\n  muiColors.lime[500],\r\n  muiColors.blueGrey[500],\r\n]\r\n\r\nconst transparency = 0x88000000\r\n\r\nfunction reverseParseColor(rrggbb) {\r\n  rrggbb = rrggbb.replace(\"#\", \"\")\r\n  const bbggrr = rrggbb.substr(4, 2) + rrggbb.substr(2, 2) + rrggbb.substr(0, 2)\r\n  return parseInt(bbggrr, 16)\r\n}\r\n\r\nexport const colorInts: Array<number> = colors.map(\r\n  (c) => (reverseParseColor(c) | transparency) >>> 0\r\n)\r\n\r\nexport default colors\r\n","import type { MainLayoutState, Action } from \"../MainLayout/types\"\r\nimport { moveRegion } from \"../ImageCanvas/regionTools.js\"\r\nimport { getIn, setIn, updateIn } from \"seamless-immutable\"\r\nimport isEqual from \"lodash/isEqual\"\r\nimport getActiveImage from \"./getActiveImage\"\r\nimport { saveToHistory } from \"./historyHandler.js\"\r\nimport colors from \"../ImageCanvas/colors\"\r\n\r\nconst getRandomId = () => Math.random().toString().split(\".\")[1]\r\n\r\nexport default (state: MainLayoutState, action: Action) => {\r\n  // Throttle certain actions\r\n  if (action.type === \"MOUSE_MOVE\") {\r\n    if (Date.now() - ((state: any).lastMouseMoveCall || 0) < 16) return state\r\n    state = setIn(state, [\"lastMouseMoveCall\"], Date.now())\r\n  }\r\n  if (!action.type.includes(\"MOUSE\")) {\r\n    state = setIn(state, [\"lastAction\"], action)\r\n  }\r\n\r\n  const { currentImageIndex, pathToActiveImage, activeImage } = getActiveImage(\r\n    state\r\n  )\r\n\r\n  const getRegionIndex = (region) => {\r\n    const regionId =\r\n      typeof region === \"string\" || typeof region === \"number\"\r\n        ? region\r\n        : region.id\r\n    if (!activeImage) return null\r\n    const regionIndex = (activeImage.regions || []).findIndex(\r\n      (r) => r.id === regionId\r\n    )\r\n    return regionIndex === -1 ? null : regionIndex\r\n  }\r\n  const getRegion = (regionId) => {\r\n    if (!activeImage) return null\r\n    const regionIndex = getRegionIndex(regionId)\r\n    if (regionIndex === null) return [null, null]\r\n    const region = activeImage.regions[regionIndex]\r\n    return [region, regionIndex]\r\n  }\r\n  const modifyRegion = (regionId, obj) => {\r\n    const [region, regionIndex] = getRegion(regionId)\r\n    if (!region) return state\r\n    if (obj !== null) {\r\n      return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\r\n        ...region,\r\n        ...obj,\r\n      })\r\n    } else {\r\n      // delete region\r\n      const regions = activeImage.regions\r\n      return setIn(\r\n        state,\r\n        [...pathToActiveImage, \"regions\"],\r\n        (regions || []).filter((r) => r.id !== region.id)\r\n      )\r\n    }\r\n  }\r\n\r\n  const closeEditors = (state: MainLayoutState) => {\r\n    if (currentImageIndex === null) return state\r\n    return setIn(\r\n      state,\r\n      [...pathToActiveImage, \"regions\"],\r\n      (activeImage.regions || []).map((r) => ({\r\n        ...r,\r\n        editingLabels: false,\r\n      }))\r\n    )\r\n  }\r\n\r\n  const setNewImage = (img: string | Object, index: number) => {\r\n    let { src } = typeof img === \"object\" ? img : { src: img }\r\n    return setIn(\r\n      setIn(state, [\"selectedImage\"], index),\r\n      [\"selectedImageFrameTime\"]\r\n    )\r\n  }\r\n\r\n  switch (action.type) {\r\n    case \"@@INIT\": {\r\n      return state\r\n    }\r\n    case \"SELECT_IMAGE\": {\r\n      return setNewImage(action.image, action.imageIndex)\r\n    }\r\n    case \"CHANGE_REGION\": {\r\n      const regionIndex = getRegionIndex(action.region)\r\n      if (regionIndex === null) return state\r\n      const oldRegion = activeImage.regions[regionIndex]\r\n      if (oldRegion.cls !== action.region.cls) {\r\n        state = saveToHistory(state, \"Change Region Classification\")\r\n        const clsIndex = state.regionClsList.indexOf(action.region.cls)\r\n        if (clsIndex !== -1) {\r\n          action.region.color = colors[clsIndex % colors.length]\r\n        }\r\n      }\r\n      if (!isEqual(oldRegion.tags, action.region.tags)) {\r\n        state = saveToHistory(state, \"Change Region Tags\")\r\n      }\r\n      if (!isEqual(oldRegion.comment, action.region.comment)) {\r\n        state = saveToHistory(state, \"Change Region Comment\")\r\n      }\r\n      return setIn(\r\n        state,\r\n        [...pathToActiveImage, \"regions\", regionIndex],\r\n        action.region\r\n      )\r\n    }\r\n    case \"CHANGE_IMAGE\": {\r\n      if (!activeImage) return state\r\n      const { delta } = action\r\n      for (const key of Object.keys(delta)) {\r\n        if (key === \"cls\") saveToHistory(state, \"Change Image Class\")\r\n        if (key === \"tags\") saveToHistory(state, \"Change Image Tags\")\r\n        state = setIn(state, [...pathToActiveImage, key], delta[key])\r\n      }\r\n      return state\r\n    }\r\n    case \"SELECT_REGION\": {\r\n      const { region } = action\r\n      const regionIndex = getRegionIndex(action.region)\r\n      if (regionIndex === null) return state\r\n      const regions = [...(activeImage.regions || [])].map((r) => ({\r\n        ...r,\r\n        highlighted: r.id === region.id,\r\n        editingLabels: r.id === region.id,\r\n      }))\r\n      return setIn(state, [...pathToActiveImage, \"regions\"], regions)\r\n    }\r\n    case \"BEGIN_MOVE_POINT\": {\r\n      state = closeEditors(state)\r\n      return setIn(state, [\"mode\"], {\r\n        mode: \"MOVE_REGION\",\r\n        regionId: action.point.id,\r\n      })\r\n    }\r\n    case \"BEGIN_BOX_TRANSFORM\": {\r\n      const { rectangle, directions } = action\r\n      state = closeEditors(state)\r\n      if (directions[0] === 0 && directions[1] === 0) {\r\n        return setIn(state, [\"mode\"], { mode: \"MOVE_REGION\", regionId: rectangle.id })\r\n      } else {\r\n        return setIn(state, [\"mode\"], {\r\n          mode: \"RESIZE_BOX\",\r\n          regionId: rectangle.id,\r\n          freedom: directions,\r\n          original: { x: rectangle.x, y: rectangle.y, w: rectangle.w, h: rectangle.h },\r\n        })\r\n      }\r\n    }\r\n    case \"BEGIN_MOVE_POLYGON_POINT\": {\r\n      const { polygon, pointIndex } = action\r\n      state = closeEditors(state)\r\n      if (\r\n        state.mode &&\r\n        state.mode.mode === \"DRAW_POLYGON\" &&\r\n        pointIndex === 0\r\n      ) {\r\n        return setIn(\r\n          modifyRegion(polygon, {\r\n            points: polygon.points.slice(0, -1),\r\n            open: false,\r\n          }),\r\n          [\"mode\"],\r\n          null\r\n        )\r\n      } else {\r\n        state = saveToHistory(state, \"Move Polygon Point\")\r\n      }\r\n      return setIn(state, [\"mode\"], {\r\n        mode: \"MOVE_POLYGON_POINT\",\r\n        regionId: polygon.id,\r\n        pointIndex,\r\n      })\r\n    }\r\n    case \"ADD_POLYGON_POINT\": {\r\n      const { polygon, point, pointIndex } = action\r\n      const regionIndex = getRegionIndex(polygon)\r\n      if (regionIndex === null) return state\r\n      const points = [...polygon.points]\r\n      points.splice(pointIndex, 0, point)\r\n      return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\r\n        ...polygon,\r\n        points,\r\n      })\r\n    }\r\n    case \"BEGIN_MOVE_POLYGON1_POINT\": {\r\n      const { polygon1, point1Index } = action\r\n      state = closeEditors(state)\r\n      if (\r\n          state.mode &&\r\n          state.mode.mode === \"DRAW_POLYGON1\" &&\r\n          point1Index === 0\r\n      ) {\r\n        return setIn(\r\n            modifyRegion(polygon1, {\r\n              points: polygon1.points.slice(0, -1),\r\n              open: false,\r\n            }),\r\n            [\"mode\"],\r\n            null\r\n        )\r\n      } else {\r\n        state = saveToHistory(state, \"Move Polygon Point\")\r\n      }\r\n      return setIn(state, [\"mode\"], {\r\n        mode: \"MOVE_POLYGON_POINT\",\r\n        regionId: polygon1.id,\r\n        point1Index,\r\n      })\r\n    }\r\n    case \"ADD_POLYGON1_POINT\": {\r\n      const { polygon1, point1, point1Index} = action\r\n      const regionIndex = getRegionIndex(polygon1)\r\n      if (regionIndex === null) return state\r\n      const points = [...polygon1.points]\r\n      const holes = [...polygon1.holes]\r\n      const open=[...polygon1.open]\r\n      let creatingHole=[...polygon1.creatingHole]\r\n\r\n      points.splice(point1Index, 0, point1)\r\n      if(!open){\r\n        creatingHole=true\r\n        holes.splice(point1Index-points.length, 0, point1);\r\n      }\r\n\r\n      return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\r\n        ...polygon1,\r\n        points,\r\n        holes,\r\n        creatingHole,\r\n      })\r\n    }\r\n    case \"MOUSE_MOVE\": {\r\n      const { x, y } = action\r\n\r\n      if (!state.mode) return state\r\n      if (!activeImage) return state\r\n      const { mouseDownAt } = state\r\n      switch (state.mode.mode) {\r\n        case \"MOVE_POLYGON_POINT\": {\r\n          const { pointIndex, regionId } = state.mode\r\n          const regionIndex = getRegionIndex(regionId)\r\n          if (regionIndex === null) return state\r\n          return setIn(\r\n            state,\r\n            [\r\n              ...pathToActiveImage,\r\n              \"regions\",\r\n              regionIndex,\r\n              \"points\",\r\n              pointIndex,\r\n            ],\r\n            [x, y]\r\n          )\r\n        }\r\n        case \"MOVE_POLYGON1_POINT\": {\r\n          const { pointIndex, regionId } = state.mode\r\n          const regionIndex = getRegionIndex(regionId)\r\n          if (regionIndex === null) return state\r\n          return setIn(\r\n              state,\r\n              [\r\n                ...pathToActiveImage,\r\n                \"regions\",\r\n                regionIndex,\r\n                \"points\",\r\n                \"holes\",\r\n                pointIndex,\r\n              ],\r\n              [x, y]\r\n          )\r\n        }\r\n        case \"MOVE_REGION\": {\r\n          const { regionId } = state.mode\r\n          if (regionId === \"$$allowed_area\") {\r\n            const {\r\n              allowedArea: { w, h },\r\n            } = state\r\n            return setIn(state, [\"allowedArea\"], {\r\n              x: x - w / 2,\r\n              y: y - h / 2,\r\n              w,\r\n              h,\r\n            })\r\n          }\r\n          const regionIndex = getRegionIndex(regionId)\r\n          if (regionIndex === null) return state\r\n          return setIn(\r\n            state,\r\n            [...pathToActiveImage, \"regions\", regionIndex],\r\n            moveRegion(activeImage.regions[regionIndex], x, y)\r\n          )\r\n        }\r\n        case \"RESIZE_BOX\": {\r\n          const {\r\n            regionId,\r\n            freedom: [xFree, yFree],\r\n            original: { x: ox, y: oy, w: ow, h: oh },\r\n          } = state.mode\r\n\r\n          const dx = xFree === 0 ? ox : xFree === -1 ? Math.min(ox + ow, x) : ox\r\n          const dw =\r\n            xFree === 0\r\n              ? ow\r\n              : xFree === -1\r\n              ? ow + (ox - dx)\r\n              : Math.max(0, ow + (x - ox - ow))\r\n          const dy = yFree === 0 ? oy : yFree === -1 ? Math.min(oy + oh, y) : oy\r\n          const dh =\r\n            yFree === 0\r\n              ? oh\r\n              : yFree === -1\r\n              ? oh + (oy - dy)\r\n              : Math.max(0, oh + (y - oy - oh))\r\n\r\n          // determine if we should switch the freedom\r\n          if (dw <= 0.001) {\r\n            state = setIn(state, [\"mode\", \"freedom\"], [xFree * -1, yFree])\r\n          }\r\n          if (dh <= 0.001) {\r\n            state = setIn(state, [\"mode\", \"freedom\"], [xFree, yFree * -1])\r\n          }\r\n\r\n          if (regionId === \"$$allowed_area\") {\r\n            return setIn(state, [\"allowedArea\"], {\r\n              x: dx,\r\n              w: dw,\r\n              y: dy,\r\n              h: dh,\r\n            })\r\n          }\r\n\r\n          const regionIndex = getRegionIndex(regionId)\r\n          if (regionIndex === null) return state\r\n          const rectangle= activeImage.regions[regionIndex]\r\n\r\n          return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\r\n            ...rectangle,\r\n            x: dx,\r\n            w: dw,\r\n            y: dy,\r\n            h: dh,\r\n          })\r\n        }\r\n        case \"DRAW_POLYGON\": {\r\n          const { regionId } = state.mode\r\n          const [region, regionIndex] = getRegion(regionId)\r\n          if (!region) return setIn(state, [\"mode\"], null)\r\n          return setIn(\r\n            state,\r\n            [\r\n              ...pathToActiveImage,\r\n              \"regions\",\r\n              regionIndex,\r\n              \"points\",\r\n              (region: any).points.length - 1,\r\n            ],\r\n            [x, y]\r\n          )\r\n        }\r\n        case \"DRAW_POLYGON1\": {\r\n          const { regionId } = state.mode\r\n          const [region, regionIndex] = getRegion(regionId)\r\n          if (!region) return setIn(state, [\"mode\"], null)\r\n          return setIn(\r\n              state,\r\n              [\r\n                ...pathToActiveImage,\r\n                \"regions\",\r\n                regionIndex,\r\n                \"points\",\r\n                \"holes\",\r\n                \"createHole\",\r\n                (region: any).points.length+(region: any).holes.length - 1,\r\n              ],\r\n              [x, y]\r\n          )\r\n        }\r\n        case \"RESIZE_CIRCLE\": {\r\n          const { regionId } = state.mode\r\n          const [region, regionIndex] = getRegion(regionId)\r\n          if (!region) return setIn(state, [\"mode\"], null)\r\n          return setIn(\r\n              state,\r\n              [\"images\", currentImageIndex, \"regions\", regionIndex],\r\n              {\r\n                ...region,\r\n                xr: Math.abs(region.x - x),\r\n                yr: Math.abs(region.y - y)\r\n              }\r\n          )\r\n        }\r\n        default:\r\n          return state\r\n      }\r\n    }\r\n    case \"MOUSE_DOWN\": {\r\n      if (!activeImage) return state\r\n      const { x, y } = action\r\n\r\n      state = setIn(state, [\"mouseDownAt\"], { x, y })\r\n\r\n      if (state.mode) {\r\n        switch (state.mode.mode) {\r\n          case \"DRAW_POLYGON\": {\r\n            const [polygon, regionIndex] = getRegion(state.mode.regionId)\r\n            if (!polygon) break\r\n            return setIn(\r\n              state,\r\n              [...pathToActiveImage, \"regions\", regionIndex],\r\n              { ...polygon, points: polygon.points.concat([[x, y]]) }\r\n            )\r\n          }\r\n          case \"DRAW_POLYGON1\": {\r\n            const [polygon1, region1Index] = getRegion(state.mode.regionId)\r\n            if (!polygon1) break\r\n            return setIn(\r\n                state,\r\n                [...pathToActiveImage, \"regions\", region1Index],\r\n                { ...polygon1, points: polygon1.points.concat([[x, y]]),holes:polygon1.holes.concat([[x, y]]) }\r\n            )\r\n          }\r\n          case \"DRAW_CIRCLE\": {\r\n            const [circle, regionIndex] = getRegion(state.mode.regionId)\r\n            if (!circle) break\r\n            return setIn(\r\n                state,\r\n                [...pathToActiveImage, \"regions\", regionIndex],\r\n                { ...circle}\r\n            )\r\n          }\r\n          default:\r\n            break\r\n        }\r\n      }\r\n\r\n      let newRegion\r\n      let defaultRegionCls = undefined,\r\n        defaultRegionColor = \"#ff0000\"\r\n      if (activeImage && (activeImage.regions || []).length > 0) {\r\n        defaultRegionCls = activeImage.regions.slice(-1)[0].cls\r\n        const clsIndex = (state.regionClsList || []).indexOf(defaultRegionCls)\r\n        if (clsIndex !== -1) {\r\n          defaultRegionColor = colors[clsIndex % colors.length]\r\n        }\r\n      }\r\n\r\n      switch (state.selectedTool) {\r\n        case \"create-point\": {\r\n          state = saveToHistory(state, \"Create Point\")\r\n          newRegion = {\r\n            type: \"point\",\r\n            x,\r\n            y,\r\n            highlighted: true,\r\n            editingLabels: true,\r\n            color: defaultRegionColor,\r\n            id: getRandomId(),\r\n            cls: defaultRegionCls,\r\n          }\r\n          break\r\n        }\r\n        case \"create-rectangle\": {\r\n          state = saveToHistory(state, \"Create Rectangle\")\r\n          newRegion = {\r\n            type: \"rectangle\",\r\n            x: x,\r\n            y: y,\r\n            w: 0,\r\n            h: 0,\r\n            highlighted: true,\r\n            editingLabels: false,\r\n            color: defaultRegionColor,\r\n            cls: defaultRegionCls,\r\n            id: getRandomId(),\r\n          }\r\n          state = setIn(state, [\"mode\"], {\r\n            mode: \"RESIZE_BOX\",\r\n            editLabelEditorAfter: true,\r\n            regionId: newRegion.id,\r\n            freedom: [1, 1],\r\n            original: { x, y, w: newRegion.w, h: newRegion.h },\r\n            isNew: true,\r\n          })\r\n          break\r\n        }\r\n        case \"create-polygon\": {\r\n          if (state.mode && state.mode.mode === \"DRAW_POLYGON\") break\r\n          state = saveToHistory(state, \"Create Polygon\")\r\n          newRegion = {\r\n            type: \"polygon\",\r\n            points: [\r\n              [x, y],\r\n              [x, y],\r\n            ],\r\n            open: true,\r\n            highlighted: true,\r\n            color: defaultRegionColor,\r\n            cls: defaultRegionCls,\r\n            id: getRandomId(),\r\n          }\r\n          state = setIn(state, [\"mode\"], {\r\n            mode: \"DRAW_POLYGON\",\r\n            regionId: newRegion.id,\r\n          })\r\n          break\r\n        }\r\n        case \"create-polygon1\": {\r\n          if (state.mode && state.mode.mode === \"DRAW_POLYGON1\") break\r\n          state = saveToHistory(state, \"Create Polygon1\")\r\n          newRegion = {\r\n            type: \"polygon1\",\r\n            points: [\r\n              [x, y],\r\n              [x, y],\r\n            ],\r\n            holes:[[x, y],\r\n              [x, y],],\r\n            open: true,\r\n            creatingHole:false,\r\n            highlighted: true,\r\n            color: defaultRegionColor,\r\n            cls: defaultRegionCls,\r\n            id: getRandomId(),\r\n          }\r\n          state = setIn(state, [\"mode\"], {\r\n            mode: \"DRAW_POLYGON1\",\r\n            regionId: newRegion.id,\r\n          })\r\n          break\r\n        }\r\n        case \"create-circle\": {\r\n          state = saveToHistory(state, \"Create Circle\")\r\n          newRegion = {\r\n            type: \"circle\",\r\n            x: x,\r\n            y: y,\r\n            xr: 0.1,\r\n            yr: 0.1,\r\n            highlighted: true,\r\n            editingLabels: false,\r\n            color: defaultRegionColor,\r\n            id: getRandomId()\r\n          }\r\n          // state = unselectRegions(state)\r\n          state = setIn(state, [\"mode\"], {\r\n            mode: \"RESIZE_CIRCLE\",\r\n            editLabelEditorAfter: true,\r\n            regionId: newRegion.id,\r\n            original: { x: x, y: y, xr: newRegion.xr, yr: newRegion.yr }\r\n          })\r\n          break\r\n        }\r\n        default:\r\n          break\r\n      }\r\n\r\n      const regions = [...(getIn(state, pathToActiveImage).regions || [])]\r\n        .map((r) =>\r\n          setIn(r, [\"editingLabels\"], false).setIn([\"highlighted\"], false)\r\n        )\r\n        .concat(newRegion ? [newRegion] : [])\r\n\r\n      return setIn(state, [...pathToActiveImage, \"regions\"], regions)\r\n    }\r\n    case \"MOUSE_UP\": {\r\n      const { x, y } = action\r\n\r\n      const { mouseDownAt = { x, y } } = state\r\n      if (!state.mode) return state\r\n      state = setIn(state, [\"mouseDownAt\"], null)\r\n      switch (state.mode.mode) {\r\n        case \"RESIZE_BOX\": {\r\n          if (state.mode.isNew) {\r\n            if (\r\n              Math.abs(state.mode.original.x - x) < 0.002 ||\r\n              Math.abs(state.mode.original.y - y) < 0.002\r\n            ) {\r\n              return setIn(\r\n                modifyRegion(state.mode.regionId, null),\r\n                [\"mode\"],\r\n                null\r\n              )\r\n            }\r\n          }\r\n          if (state.mode.editLabelEditorAfter) {\r\n            return {\r\n              ...modifyRegion(state.mode.regionId, { editingLabels: true }),\r\n              mode: null,\r\n            }\r\n          }\r\n        }\r\n        case \"MOVE_REGION\":\r\n        case \"RESIZE_CIRCLE\": {\r\n          if (state.mode.editLabelEditorAfter) {\r\n            return {\r\n              ...modifyRegion(state.mode.regionId, { editingLabels: true }),\r\n              mode: null\r\n            }\r\n          }\r\n        }\r\n        case \"MOVE_POLYGON_POINT\": {\r\n          return { ...state, mode: null }\r\n        }\r\n        case \"MOVE_POLYGON1_POINT\": {\r\n          return { ...state, mode: null }\r\n        }\r\n        default:\r\n          return state\r\n      }\r\n    }\r\n    case \"OPEN_REGION_EDITOR\": {\r\n      const { region } = action\r\n      const regionIndex = getRegionIndex(action.region)\r\n      if (regionIndex === null) return state\r\n      const newRegions = setIn(\r\n        activeImage.regions.map((r) => ({\r\n          ...r,\r\n          highlighted: false,\r\n          editingLabels: false,\r\n        })),\r\n        [regionIndex],\r\n        {\r\n          ...(activeImage.regions || [])[regionIndex],\r\n          highlighted: true,\r\n          editingLabels: true,\r\n        }\r\n      )\r\n      return setIn(state, [...pathToActiveImage, \"regions\"], newRegions)\r\n    }\r\n    case \"CLOSE_REGION_EDITOR\": {\r\n      const regionIndex = getRegionIndex(action.region)\r\n      if (regionIndex === null) return state\r\n      return setIn(state, [...pathToActiveImage, \"regions\", regionIndex], {\r\n        ...(activeImage.regions || [])[regionIndex],\r\n        editingLabels: false,\r\n      })\r\n    }\r\n    case \"DELETE_REGION\": {\r\n      const regionIndex = getRegionIndex(action.region)\r\n      if (regionIndex === null) return state\r\n      return setIn(\r\n        state,\r\n        [...pathToActiveImage, \"regions\"],\r\n        (activeImage.regions || []).filter((r) => r.id !== action.region.id)\r\n      )\r\n    }\r\n    case \"DELETE_SELECTED_REGION\": {\r\n      return setIn(\r\n        state,\r\n        [...pathToActiveImage, \"regions\"],\r\n        (activeImage.regions || []).filter((r) => !r.highlighted)\r\n      )\r\n    }\r\n    case \"HEADER_BUTTON_CLICKED\": {\r\n      const buttonName = action.buttonName.toLowerCase()\r\n      switch (buttonName) {\r\n        case \"prev\": {\r\n          if (currentImageIndex === null) return state\r\n          if (currentImageIndex === 0) return state\r\n          return setNewImage(\r\n            state.images[currentImageIndex - 1],\r\n            currentImageIndex - 1\r\n          )\r\n        }\r\n        case \"next\": {\r\n          if (currentImageIndex === null) return state\r\n          if (currentImageIndex === state.images.length - 1) return state\r\n          return setNewImage(\r\n            state.images[currentImageIndex + 1],\r\n            currentImageIndex + 1\r\n          )\r\n        }\r\n        case \"clone\": {\r\n          if (currentImageIndex === null) return state\r\n          if (currentImageIndex === state.images.length - 1) return state\r\n          return setIn(\r\n            setNewImage(\r\n              state.images[currentImageIndex + 1],\r\n              currentImageIndex + 1\r\n            ),\r\n            [\"images\", currentImageIndex + 1, \"regions\"],\r\n            activeImage.regions\r\n          )\r\n        }\r\n        case \"hotkeys\": {\r\n          return state\r\n        }\r\n        case \"exit\":\r\n        case \"done\": {\r\n          return state\r\n        }\r\n        default:\r\n          return state\r\n      }\r\n    }\r\n    case \"SELECT_TOOL\": {\r\n\r\n      state = setIn(state, [\"mode\"], null)\r\n      return setIn(state, [\"selectedTool\"], action.selectedTool)\r\n    }\r\n    case \"BEGIN_CIRCLE_TRANSFORM\": {\r\n      const { circle, directions } = action\r\n      state = closeEditors(state)\r\n      if (directions === \"MOVE_REGION\") {\r\n        return setIn(state, [\"mode\"], {\r\n          mode: \"MOVE_REGION\",\r\n          regionId: circle.id\r\n        })\r\n      } else {\r\n        return setIn(state, [\"mode\"], {\r\n          mode: \"RESIZE_CIRCLE\",\r\n          regionId: circle.id,\r\n          original: { x: circle.x, y: circle.y, rx: circle.rx, ry: circle.ry }\r\n        })\r\n      }\r\n    }\r\n    case \"CANCEL\": {\r\n      const { mode } = state\r\n      if (mode) {\r\n        switch (mode.mode) {\r\n          case \"DRAW_POLYGON\": {\r\n            const { regionId } = mode\r\n            return modifyRegion(regionId, null)\r\n          }\r\n          case \"DRAW_POLYGON1\": {\r\n            const { regionId } = mode\r\n            return modifyRegion(regionId, null)\r\n          }\r\n          case \"MOVE_POLYGON_POINT\":\r\n          case \"MOVE_POLYGON1_POINT\":\r\n          case \"RESIZE_BOX\":\r\n          case \"RESIZE_CIRCLE\":\r\n          case \"MOVE_REGION\": {\r\n            return setIn(state, [\"mode\"], null)\r\n          }\r\n          default:\r\n            return state\r\n        }\r\n      }\r\n      // Close any open boxes\r\n      const regions: any = activeImage.regions\r\n      if (regions && regions.some((r) => r.editingLabels)) {\r\n        return setIn(\r\n          state,\r\n          [...pathToActiveImage, \"regions\"],\r\n          regions.map((r) => ({\r\n            ...r,\r\n            editingLabels: false,\r\n          }))\r\n        )\r\n      } else if (regions) {\r\n        return setIn(\r\n          state,\r\n          [...pathToActiveImage, \"regions\"],\r\n          regions.map((r) => ({\r\n            ...r,\r\n            highlighted: false,\r\n          }))\r\n        )\r\n      }\r\n      break\r\n    }\r\n\r\n\r\n    default:\r\n      break\r\n  }\r\n  return state\r\n}\r\n","\r\nimport type {\r\n  MainLayoutImageAnnotationState,\r\n  Action,\r\n} from \"../MainLayout/types\"\r\nimport { setIn } from \"seamless-immutable\"\r\nimport getActiveImage from \"./getActiveImage\"\r\n\r\nexport default (state: MainLayoutImageAnnotationState, action: Action) => {\r\n  const { currentImageIndex, pathToActiveImage, activeImage } = getActiveImage(\r\n    state\r\n  )\r\n\r\n  switch (action.type) {\r\n    case \"IMAGE_LOADED\": {\r\n      return setIn(state, [\"images\", currentImageIndex, \"pixelSize\"], {\r\n        w: action.metadata.naturalWidth,\r\n        h: action.metadata.naturalHeight,\r\n      })\r\n    }\r\n  }\r\n  return state\r\n}\r\n","\r\nimport React, { useReducer, useEffect } from \"react\"\r\nimport MainLayout from \"./MainLayout/main_MainLayout\"\r\nimport type {\r\n  Image,\r\n  MainLayoutState,\r\n  Action,\r\n} from \"./MainLayout/types\"\r\n\r\nimport combineReducers from \"./reducers/combineReducers.js\"\r\nimport generalReducer from \"./reducers/generalReducer.js\"\r\nimport imageReducer from \"./reducers/imageReducer.js\"\r\nimport historyHandler from \"./reducers/historyHandler.js\"\r\nimport useEventCallback from \"use-event-callback\"\r\nimport makeImmutable, { without } from \"seamless-immutable\"\r\n\r\ntype Props = {\r\n  regionTagList?: Array<string>,\r\n  enabledTools?: Array<string>,\r\n  selectedTool?: String,\r\n  selectedImage?: string | number,\r\n  images?: Array<Image>,\r\n  onExit: (MainLayoutState) => any,\r\n}\r\n\r\nexport const Annotator = ({\r\n  images,\r\n  selectedImage = images && images.length > 0 ? 0 : undefined,\r\n  enabledTools = [\r\n    \"select\",\r\n    \"create-point\",\r\n    \"create-rectangle\",\r\n    \"create-polygon\",\r\n    \"create-polygon1\",\r\n    \"create-circle\"\r\n  ],\r\n  selectedTool = \"select\",\r\n  regionTagList = [],\r\n  onExit,\r\n  onNextImage,\r\n  onPrevImage,\r\n  allowComments,\r\n}: Props) => {\r\n  if (typeof selectedImage === \"string\") {\r\n    selectedImage = (images || []).findIndex((img) => img.src === selectedImage)\r\n    if (selectedImage === -1) selectedImage = undefined\r\n  }\r\n  const annotationType = \"image\"\r\n  const [state, dispatchToReducer] = useReducer(\r\n    historyHandler(\r\n      combineReducers(\r\n        imageReducer ,\r\n        generalReducer\r\n      )\r\n    ),\r\n    makeImmutable({\r\n      annotationType,\r\n      selectedTool,\r\n      mode: null,\r\n      regionTagList,\r\n      enabledTools,\r\n      history: [],\r\n      allowComments,\r\n      ...({\r\n            selectedImage,\r\n            images,\r\n          }),\r\n    })\r\n  )\r\n\r\n  const dispatchAction = useEventCallback((action: Action) => {\r\n    if (action.type === \"HEADER_BUTTON_CLICKED\") {\r\n      if ([\"Exit\", \"Done\", \"Save\", \"Complete\"].includes(action.buttonName)) {\r\n        return onExit(without(state, \"history\"))\r\n      } else if (action.buttonName === \"Next\" && onNextImage) {\r\n        return onNextImage(without(state, \"history\"))\r\n      } else if (action.buttonName === \"Prev\" && onPrevImage) {\r\n        return onPrevImage(without(state, \"history\"))\r\n      }\r\n    }\r\n    dispatchToReducer(action)\r\n  })\r\n\r\n  const onRegionClassAdded = useEventCallback((cls) => {\r\n    dispatchToReducer({\r\n      type: \"ON_CLS_ADDED\",\r\n      cls: cls,\r\n    })\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (selectedImage === undefined) return\r\n    dispatchToReducer({\r\n      type: \"SELECT_IMAGE\",\r\n      imageIndex: selectedImage,\r\n      image: state.images[selectedImage],\r\n    })\r\n  }, [selectedImage])\r\n\r\n  if (!images )\r\n    return 'Missing required prop \"images\" '\r\n\r\n  return (\r\n\r\n      <MainLayout\r\n        alwaysShowNextButton={Boolean(onNextImage)}\r\n        alwaysShowPrevButton={Boolean(onPrevImage)}\r\n        state={state}\r\n        dispatchAction={dispatchAction}\r\n        onRegionClassAdded={onRegionClassAdded}\r\n      />\r\n\r\n  )\r\n}\r\nexport default Annotator\r\n","export default (...reducers) => (state, action) => {\r\n  for (const reducer of reducers) {\r\n    state = reducer(state, action)\r\n  }\r\n  return state\r\n}\r\n","import React, { Component } from \"react\";\r\nimport axios from \"axios\";\r\nimport AnnotationTool from \"../annotateComponents/main_Annotate\";\r\nimport Button from 'react-bootstrap/Button';\r\n\r\nvar env = process.env.NODE_ENV;\r\nvar config = require(\"../../../config.json\");\r\n\r\nexport default class SubmitHIT extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            error: null,\r\n            isLoaded: false,\r\n            EnabledTools:null,\r\n            AllowComments:null,\r\n            Tags:null,\r\n            imgData: null,\r\n            Local:null\r\n        }\r\n\r\n        this.props = props;\r\n        this.submitTask = this.submitTask.bind(this);\r\n        this.getSubmissionUrl = this.getSubmissionUrl.bind(this);\r\n        this.handleSubmit = this.handleSubmit.bind(this);\r\n        this.componentDidMount=this.componentDidMount(this);\r\n\r\n    }\r\n    getTools(res){\r\n        console.log(\"get tool:\",res.Tools['enenabledTools'])\r\n\r\n    }\r\n//get data from api\r\n    componentDidMount() {\r\n        function getEnabledTools(data) {\r\n            const enabledTools=data[\"enabledTools\"]\r\n            var res=[]\r\n            for (var i = 0; i < enabledTools.length; i++) {\r\n                if (enabledTools[i][\"create point\"]==true){\r\n                    res.push(\"create-point\")\r\n                }\r\n                else if (enabledTools[i][\"create rectangle\"]==true){\r\n                    res.push(\"create-rectangle\")\r\n                }\r\n                else if(enabledTools[i][\"create polygon\"]==true){\r\n                    res.push(\"create-polygon\")\r\n                }\r\n                else if(enabledTools[i][\"create polygon1\"]==true){\r\n                    res.push(\"create-polygon1\")\r\n                }\r\n                else if(enabledTools[i][\"create ellipse\"]==true){\r\n                    res.push(\"create-circle\")\r\n                }\r\n            }\r\n            return res\r\n        }\r\n\r\n        fetch(\"./backendConfig.json\")\r\n            .then(res => res.json())\r\n            .then(\r\n                (result) => {\r\n                    const enabledTools=getEnabledTools(result[\"setup\"])\r\n                    if (result[\"setup\"][\"importData\"]) {\r\n                        this.setState({imgData:result[\"setup\"][\"importData\"]});\r\n                    } else {\r\n                        this.setState({imgData:result[\"setup\"][\"defaultImgData\"]});\r\n                    }\r\n                    \r\n                    this.setState({\r\n                        isLoaded: true,\r\n                        EnabledTools:enabledTools,\r\n                        AllowComments:result[\"setup\"][\"allow-comments\"],\r\n                        Tags:result[\"setup\"][\"tags\"],\r\n                        Local:result[\"setup\"][\"local\"],\r\n                    });\r\n\r\n\r\n\r\n                    console.log(\"res is: \", result)\r\n                },\r\n                // Note: it's important to handle errors here\r\n                // instead of a catch() block so that we don't swallow\r\n                // exceptions from actual bugs in components.\r\n                (error) => {\r\n                    this.setState({\r\n                        isLoaded: true,\r\n                        error\r\n                    });\r\n                }\r\n            )\r\n    }\r\n\r\n    parseParameters(url){\r\n        var params = {\r\n            'assignmentId' : null,\r\n            'hitId' : null,\r\n            'workerId' : null,\r\n            'turkSubmitTo' : null\r\n        };\r\n\r\n        var queryString = url.split('?')[1];\r\n\r\n        if (queryString){\r\n            var queryPieces = queryString.split('&');\r\n            for (var i = 0; i < queryPieces.length; ++i){\r\n                var pieces = queryPieces[i].split('=');\r\n                var paramName = pieces[0];\r\n                var paramValue = pieces[1];\r\n                if(paramName in params){\r\n                    params[paramName] = paramValue;\r\n                }\r\n            }\r\n        }\r\n\r\n        return params;\r\n    }\r\n\r\n    handleSubmit(e) {\r\n        e.preventDefault();\r\n        const input = document.getElementById('submitButton');\r\n        input.setAttribute('value', JSON.stringify(this.state.imgData));\r\n        console.log(input);\r\n        const form = document.getElementById('submitForm');\r\n        HTMLFormElement.prototype.submit.call(form);\r\n\r\n    }\r\n\r\n    submitTask(e) {\r\n        // e.preventDefault();\r\n        console.log(\"POSTing data\");\r\n        axios\r\n            .post(`${this.getSubmissionUrl()}`, {})\r\n            .then(function(response) {\r\n                console.log(response);\r\n            })\r\n            .catch(function(error) {\r\n                console.log(error);\r\n            });\r\n    }\r\n\r\n    getSubmissionUrl() {\r\n        let mturkParams = this.parseParameters(window.location.href);\r\n        const assignmentID =  mturkParams['assignmentId'];\r\n        const url = config[\"submit\"][env] + \"/?assignmentId=\" + assignmentID;\r\n        console.log(url);\r\n        return url;\r\n    }\r\n\r\n    render() {\r\n        const { error, isLoaded, EnabledTools, AllowComments, Tags, imgData, Local} = this.state;\r\n        console.log(\"render data is:\", this.state)\r\n        if (error) {\r\n            return <div>Error: {error.message}</div>;\r\n        } else if (!isLoaded) {\r\n            return <div>Loading...</div>;\r\n        } else if (Local) {\r\n            return (\r\n                <div id=\"Submit\">\r\n\r\n                    <form\r\n                        id=\"submitForm\"\r\n                        type=\"submit\"\r\n                        method=\"POST\"\r\n                    >\r\n                        <AnnotationTool\r\n                            name=\"AnnotationTool\"\r\n                            type=\"submit\"\r\n                            ref={value => {\r\n                                this.value = value;\r\n                            }}\r\n                            images={imgData}\r\n                            enabledTools={EnabledTools}\r\n                            regionTagList={Tags}\r\n                            allowComments={AllowComments}\r\n                            Local={Local}\r\n                            imgData={imgData}\r\n                            onExit={output => {\r\n                                this.setState({imgData: output.images});\r\n                                console.log(\"output:\", JSON.stringify(output.images));\r\n                                console.log(typeof({imgData}));\r\n                                console.log({imgData});\r\n                            }}\r\n\r\n                        />\r\n                        <div>\r\n                            <Button\r\n                                variant=\"outline-dark\" size=\"lg\" block\r\n                                name=\"Annotation\"\r\n                                type=\"submit\"\r\n                                id=\"submitButton\"\r\n                                href={`data:text/json;charset=utf-8,${encodeURIComponent(\r\n                                JSON.stringify(this.state.imgData)\r\n                                )}`}\r\n                                download=\"results.json\"\r\n                            >\r\n                            {`Download Annotations as Json File`}\r\n                            </Button>   \r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            );\r\n        } else {\r\n            return (\r\n                <div id=\"Submit\">\r\n\r\n                    <form\r\n                        id=\"submitForm\"\r\n                        type=\"submit\"\r\n                        method=\"POST\"\r\n                        action={this.getSubmissionUrl()}\r\n                    >\r\n                        <AnnotationTool\r\n                            name=\"AnnotationTool\"\r\n                            type=\"submit\"\r\n                            ref={value => {\r\n                                this.value = value;\r\n                            }}\r\n                            images={imgData}\r\n                            enabledTools={EnabledTools}\r\n                            regionTagList={Tags}\r\n                            allowComments={AllowComments}\r\n                            Local={Local}\r\n                            imgData={imgData}\r\n                            onExit={output => {\r\n                                this.setState({imgData: output.images});\r\n                                console.log(\"output:\", JSON.stringify(output.images));\r\n                            }}\r\n\r\n                        />\r\n                        <div>\r\n                            <Button variant=\"outline-dark\" size=\"lg\" block\r\n                                    name=\"Annotation\"\r\n                                    type=\"submit\"\r\n                                    id=\"submitButton\"\r\n                                    value={JSON.stringify(this.state.imgData)}\r\n                                    ref={value => {\r\n                                        this.value = value;\r\n                                    }}\r\n                            >Complete the HIT</Button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n}\r\n","import React, {Component, useEffect, useState} from \"react\";\r\nimport Intro from \"./Introduction/main_Introduction\";\r\nimport Tutorial from \"./Tutorial/main_Tutorial\";\r\nimport SubmitHIT from \"./SubmitHIT/main_SubmitHIT\"\r\nimport styles from './styles_Home'\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\n// get style from style.js\r\nconst myStyle = makeStyles(styles)\r\n\r\nexport default function Home() {\r\n\r\n    const classes = myStyle();\r\n    const [tutorial, setTutorial] = useState({\r\n        steps:null,\r\n        imgUrl:null,\r\n    })\r\n    const [intro, setIntro]=useState({\r\n        intro:null,})\r\n    const [hasError, setHasError] = useState(false)\r\n    const [loading, setLoading]= useState(false)\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        fetch(\"./backendConfig.json\").then(res=>res.json()).then(\r\n            (result) => {\r\n                console.log(\"start setState\");\r\n                setTutorial({\r\n                    steps:result[\"setup\"][\"tutorial\"][\"steps\"],\r\n                    imgUrl:result[\"setup\"][\"tutorial\"][\"imgUrl\"]\r\n                });\r\n                setIntro({\r\n                    intro:result[\"setup\"][\"introduction\"],\r\n                });\r\n                setLoading(false);\r\n            }\r\n        ).catch(err => {\r\n            setHasError(err)\r\n            setLoading(false)})\r\n    },[]);\r\n\r\n    if (hasError!=false) {\r\n        return <div>Error: {hasError.message}</div>;\r\n    } else if (loading) {\r\n        return <div>Loading...</div>;\r\n    } else {\r\n        return (\r\n            <div className={classes.homeContainer}>\r\n                <div className={classes.introTutorial}>\r\n                    <Intro title=\"Show tutorial\"\r\n                           intro={intro}>\r\n                        <Tutorial tutorial={tutorial} />\r\n                    </Intro >\r\n                </div>\r\n                <div className={classes.annotateContainer}>\r\n                    <SubmitHIT />\r\n                </div>\r\n            </div>\r\n\r\n        );\r\n    }\r\n\r\n}\r\n\r\n\r\n","import React, { Component } from \"react\";\r\nimport AnnotationTool from \"../Home/annotateComponents/main_Annotate\";\r\nimport results from \"../../train_results.json\";\r\n\r\nexport default class main_ShowResult extends Component {\r\n  render() {\r\n    //transfer object to arr\r\n    const resultsArr = []\r\n    Object.keys(results).forEach(\r\n        key => resultsArr.push(\r\n             results[key]))\r\n    console.log( resultsArr)\r\n    return (\r\n        <div>\r\n          {\r\n            //loop through arr\r\n            resultsArr.map((result, index) => {\r\n              if (result.Submit===\"Yes\")\r\n              return (\r\n                  <div key={index} >\r\n                    <AnnotationTool\r\n                      images={result.Annotation}\r\n                      enabledTools={[\"create-point\", \"create-rectangle\", \"create-polygon\"]}\r\n                      regionTagList={[\"tag1\", \"tag2\", \"tag3\"]}\r\n                      // comments\r\n                      allowComments={true}\r\n                      onExit={output => console.log(output.images)}\r\n                    />\r\n                  </div>\r\n              )\r\n            })\r\n          }\r\n        </div>\r\n    )\r\n  }\r\n}\r\n","import React from 'react';\r\nimport {\r\n    HashRouter as Router,\r\n    Switch,\r\n    Link,\r\n    Route\r\n} from 'react-router-dom';\r\nimport { createBrowserHistory } from \"history\";\r\n\r\nimport Home from './pages/Home/main_Home';\r\nimport preview from './pages/ShowResult/main_ShowResult';\r\n\r\nconst customHistory = createBrowserHistory();\r\n\r\nexport default (\r\n    <Router history={customHistory}>\r\n        <Switch>\r\n        <Route exact path=\"/\" component={Home} />\r\n            <Route exact path=\"/result\" component={preview} />\r\n\r\n        </Switch>\r\n    </Router>\r\n);","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","\r\nimport React from \"react\"\r\nimport \"./site.css\"\r\nimport ReactDOM from 'react-dom';\r\nimport route from \"./route\";\r\nimport * as serviceWorker from './pages/Home/SubmitHIT/serviceWorker';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\n\r\n\r\nReactDOM.render(\r\n    <div>{route}\r\n    </div>,\r\n    document.getElementById('root')\r\n);\r\nserviceWorker.unregister();\r\n\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\n\r\n"],"sourceRoot":""}