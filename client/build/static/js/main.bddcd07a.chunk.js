(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{152:function(e){e.exports=JSON.parse('{"train_7":{"Annotation":[{"name":"Image 1","pixelSize":{"h":1500,"w":2580},"regions":[{"color":"#ff0000","comment":"test1","editingLabels":false,"highlighted":true,"id":"7826303892518429","tags":["tag1"],"type":"point","x":0.2061310782241015,"y":0.26969696969696977}],"src":"https://geodata.lib.utexas.edu/assets/blac_featured_image_map-dca4cbca4e07010e5bd201ad8fab1cc0aa9abd24a8842f90e3c1eef1834e8498.jpg"},{"name":"Image 2","pixelSize":{"h":1500,"w":2580},"regions":[{"color":"#ff0000","comment":"test2","editingLabels":false,"h":0.22575757575757577,"highlighted":true,"id":"11647179160397592","tags":["tag2"],"type":"box","w":0.443093727977449,"x":0.03083157152924595,"y":0.21363636363636368}],"src":"https://geodata.lib.utexas.edu/assets/utlmaps_featured_image_map-c07ae2551145ff2e5f5fa3c71baa345d9d674a33b08f422449203cf9ed47e0d1.jpg"},{"name":"Image 3","pixelSize":{"h":1362,"w":2000},"regions":[{"color":"#ff0000","comment":"test3","editingLabels":false,"highlighted":true,"id":"0647520744688721","open":false,"points":[[0.4034409090909091,0.10454545454545454],[0.29200454545454546,0.2878787878787879],[0.3446272727272727,0.34545454545454546],[0.4209818181818182,0.2681818181818182],[0.43026818181818177,0.11818181818181818]],"tags":["tag3"],"type":"polygon"}],"src":"https://1igc0ojossa412h1e3ek8d1w-wpengine.netdna-ssl.com/wp-content/uploads/2018/03/TMSELEMWORLD.M.jpg"}],"Hit_id":"3B9XR6P1XHY1YYG13K2Y3ISOBY6BJK","Submit":"Yes"},"train_8":{"Hit_id":"3URJ6VVYVSQVEAMP4IKG303400ZO4A","Submit":"No"},"train_9":{"Hit_id":"31S7M7DAHJT7PAYI6R5WJRB2LUBLTM","Submit":"No"}}')},319:function(e,t,n){e.exports=n(454)},321:function(e,t,n){},375:function(e,t){},449:function(e){e.exports=JSON.parse('{"submit":{"production":"https://workersandbox.mturk.com/mturk/externalSubmit","development":"https://workersandbox.mturk.com/mturk/externalSubmit"},"server":null}')},454:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=(n(321),n(13)),i=n.n(r),c=n(304),l=n(16),s=n(25),u=n(9),d=n(114),g=n(66),m=n(276),p={homeContainer:{margin:"auto",width:"85%",fontFamily:"Arial"},introTutorial:{backgroundColor:"#E8E8E8",paddingBottom:20},introContainer:{color:"DodgerBlue",textAlign:"center",paddingTop:10},jumbotron:{paddingTop:100,backgroundColor:"#E8E8E8"},introContent:{padding:40,fontSize:"x-large"},introTitle:{fontWeight:Object(m.a)()},buttonTitle:{padding:"40px"},card:{margin:20},tutorialTitles:{textAlign:"center"},imageContainer:{display:"block",margin:"auto",maxWidth:1e3,padding:5},media:{height:0,paddingTop:"56.25%"},avatar:{backgroundColor:g.a[500]},steps:{paddingLeft:"25%"},annotateContainer:{marginTop:"170px"}},h=n(554),b=n(552),f=Object(b.a)(p);function O(e){var t=f(),n=a.a.useState(!1),o=Object(u.a)(n,2),r=o[0],i=o[1],c=a.a.useState("Show Tutorial"),l=Object(u.a)(c,2),s=l[0],g=l[1];return a.a.createElement("div",null,a.a.createElement("div",{className:t.introContainer},a.a.createElement(h.a,{className:t.jumbotron},a.a.createElement("h1",{className:t.introTitle},"Task Overview"),a.a.createElement("p",{className:t.introContent},e.intro.intro),a.a.createElement("p",null,a.a.createElement("div",{className:t.buttonTitle},a.a.createElement(d.a,{variant:"outline-primary",size:"lg",onClick:function(e){return g(r?"Show Tutorial":"Hide Tutorial"),void i(!r)}},s))))),r&&a.a.createElement("div",{class:"boxContent"},e.children))}var y=n(280),v=n(327),E=n(330),j=n(331),x=n(455),I=n(332),w=n(333),T=n(334),_=Object(b.a)(p);function M(e){var t,n=_(),o=a.a.useState(!1),r=Object(u.a)(o,2),i=r[0];r[1];return a.a.createElement("div",{className:n.root},a.a.createElement(j.a,{className:n.card},a.a.createElement(x.a,{boxShadow:3},a.a.createElement(I.a,{className:n.tutorialTitles,title:"Tutorial",subheader:"This short tutorial is meant to guide you through the annotation process. "})),a.a.createElement("div",{className:n.imageContainer},a.a.createElement(w.a,{className:n.media,image:e.tutorial.imgUrl})),a.a.createElement(x.a,{boxShadow:3},a.a.createElement(T.a,{className:n.steps},a.a.createElement(y.a,{dense:i},(t=e.tutorial.steps,console.log("data before is:",t),t?t.map((function(e){return a.a.createElement(v.a,null,a.a.createElement(E.a,{primary:e}))})):null))))))}var P=n(105),C=n(106),N=n(54),L=n(115),R=n(113),S=n(281),D=n.n(S),k=n(6),A=n(309),B=n(8),G=n(107),W=function(e){var t=e.canvasEl,n=e.changeMat,a=e.changeDragging,r=e.zoomStart,i=(e.zoomEnd,e.changeZoomStart),c=e.changeZoomEnd,l=e.layoutParams,s=e.zoomWithPrimary,u=e.dragWithPrimary,d=e.mat,g=e.onMouseMove,m=e.onMouseUp,p=e.onMouseDown,h=e.dragging,b=Object(o.useRef)({x:0,y:0}),f=Object(o.useRef)({x:0,y:0}),O=function(e,t){var o=[t.x,t.y],a=o[0],r=o[1],i="object"===typeof e?e.to/d.a:1+.2*e;d.translate(a,r).scaleU(i),d.a>2&&d.scaleU(2/d.a),d.a<.05&&d.scaleU(.05/d.a),d.translate(-a,-r),n(d.clone())};return{mouseEvents:{onMouseMove:function(e){var o=t.current.getBoundingClientRect(),a=o.left,i=o.top;f.current.x=b.current.x,f.current.y=b.current.y,b.current.x=e.clientX-a,b.current.y=e.clientY-i;var u=d.applyToPoint(b.current.x,b.current.y);s&&r&&c(u);var m=l.current,p=m.iw,O=m.ih;g({x:u.x/p,y:u.y/O}),h&&(d.translate(f.current.x-b.current.x,f.current.y-b.current.y),n(d.clone())),e.preventDefault()},onMouseDown:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.preventDefault(),1===e.button||2===e.button||0===e.button&&u)return a(!0);var n=d.applyToPoint(b.current.x,b.current.y);if(s&&0===e.button)return i(n),void c(n);if(0===e.button){t.type,t.type;var o=l.current,r=o.iw,g=o.ih;p({x:n.x/r,y:n.y/g})}},onMouseUp:function(e){e.preventDefault();var t=d.applyToPoint(b.current.x,b.current.y);if(r){var o=t;if(Math.abs(r.x-o.x)<10&&Math.abs(r.y-o.y)<10)d.a<1?O({to:1},b.current):O({to:.25},b.current);else{var s=l.current,g=s.iw,p=s.ih;if(r.x>o.x){var h=[o.x,r.x];r.x=h[0],o.x=h[1]}if(r.y>o.y){var f=[o.y,r.y];r.y=f[0],o.y=f[1]}var y=Math.min((o.x-r.x)/g,(o.y-r.y)/p);y<.05&&(y=.05),y>10&&(y=10);var v=G.Matrix.from(1,0,0,1,-10,-10).translate(r.x,r.y).scaleU(y);n(v.clone())}i(null),c(null)}if(1===e.button||2===e.button||0===e.button&&u)return a(!1);if(0===e.button){var E=l.current,j=E.iw,x=E.ih;m({x:t.x/j,y:t.y/x})}},onWheel:function(e){var t=e.deltaY>0?1:e.deltaY<0?-1:0;O(t,b.current)},onContextMenu:function(e){e.preventDefault()}},mousePosition:b}},z=n(30),U=function(e){var t=e.layoutParams,n=e.mat;return Object(z.a)((function(e){var o=t.current,a=o.iw,r=o.ih,i=function(e){switch(e.type){case"polygon":var t={x:Math.min.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2),n=t[0];t[1];return n})))),y:Math.min.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2);t[0];return t[1]})))),w:0,h:0};return t.w=Math.max.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2),n=t[0];t[1];return n}))))-t.x,t.h=Math.max.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2);t[0];return t[1]}))))-t.y,t;case"polygon1":var n={x:Math.min.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2),n=t[0];t[1];return n})))),y:Math.min.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2);t[0];return t[1]})))),w:0,h:0};return n.w=Math.max.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2),n=t[0];t[1];return n}))))-n.x,n.h=Math.max.apply(Math,Object(B.a)(e.points.map((function(e){var t=Object(u.a)(e,2);t[0];return t[1]}))))-n.y,n;case"circle":return{x:e.x-e.xr,y:e.y-e.yr,w:2*e.xr,h:2*e.yr};case"rectangle":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};default:return{x:0,y:0,w:0,h:0}}throw new Error("unknown region")}(e),c="point"===e.type?15:2,l={x:i.x*a-c,y:i.y*r-c,w:i.w*a+2*c,h:i.h*r+2*c};return Object(k.a)(Object(k.a)({},n.clone().inverse().applyToPoint(l.x,l.y)),{},{w:l.w/n.a,h:l.h/n.d})}))},Y=n(556),H=n(144),V=n(67),Z={regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.5,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:V.a[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:V.a[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}},commentBox:{fontWeight:400,fontSize:13}},F=n(41),K=n.n(F),J=n(352),X=n(372),$=n(282),q=n.n($),Q=n(292),ee=n.n(Q),te=n(369),ne=n(305),oe=n(5),ae=n.n(oe),re=Object(b.a)(Z),ie=Object(o.memo)((function(e){var t=e.region,n=e.editing,r=e.allowedTags,i=e.onDelete,c=e.onChange,l=e.onClose,s=e.onOpen,u=e.allowComments,d=re(),g=Object(o.useRef)(null);return a.a.createElement(H.a,{onClick:function(){return n?null:s(t)},className:K()(d.regionInfo,{highlighted:t.highlighted})},n?a.a.createElement("div",{style:{width:200}},a.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.a.createElement("div",{style:{display:"flex",backgroundColor:t.color||"#888",color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},t.type),a.a.createElement("div",{style:{flexGrow:1}}),a.a.createElement(J.a,{onClick:function(){return i(t)},tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},a.a.createElement(q.a,{style:{marginTop:-8,width:16,height:16}}))),(r||[]).length>0&&a.a.createElement("div",{style:{marginTop:4}},a.a.createElement(ne.a,{onChange:function(e){return c(Object(k.a)(Object(k.a)({},t),{},{tags:e.map((function(e){return e.value}))}))},placeholder:"Tags",value:(t.tags||[]).map((function(e){return{label:e,value:e}})),isMulti:!0,options:Object(oe.asMutable)(r.map((function(e){return{value:e,label:e}})))})),u&&a.a.createElement(te.a,{InputProps:{className:d.commentBox},fullWidth:!0,multiline:!0,rows:3,ref:g,onClick:function(e){var t=g.current.children[0].children[0];if(t)return t.focus()},value:t.comment||"",onChange:function(e){return c(Object(k.a)(Object(k.a)({},t),{},{comment:e.target.value}))}}),l&&a.a.createElement("div",{style:{marginTop:4,display:"flex"}},a.a.createElement("div",{style:{flexGrow:1}}),a.a.createElement(X.a,{onClick:function(){return l(t)},size:"small",variant:"contained",color:"primary"},a.a.createElement(ee.a,null)))):a.a.createElement("div",null,t.cls&&a.a.createElement("div",{className:"name"},a.a.createElement("div",{className:"circle",style:{backgroundColor:t.color}}),t.cls),t.tags&&a.a.createElement("div",{className:"tags"},t.tags.map((function(e){return a.a.createElement("div",{key:e,className:"tag"},e)})))))}),(function(e,t){return e.editing===t.editing&&e.region===t.region})),ce=n(293),le=n.n(ce),se=function(e){var t=e.regions,n=e.projectRegionBox,o=e.mouseEvents,r=e.regionTagList,i=e.onBeginRegionEdit,c=e.onChangeRegion,l=e.onCloseRegionEdit,s=e.onDeleteRegion,u=e.layoutParams,d=e.imageSrc,g=e.RegionEditLabel,m=e.onRegionClassAdded,p=e.allowComments,h=null!=g?g:ie;return t.filter((function(e){return e.visible||void 0===e.visible})).map((function(e){var g=n(e),b=u.current,f=(b.iw,b.ih,8);e.highlighted&&"rectangle"===e.type&&(f+=6);var O=e.editingLabels&&!e.locked?170:e.tags?60:50,y=g.y>O,v=y?{left:g.x,top:g.y-f/2}:{left:g.x,top:g.y+g.h+f/2};return e.locked?a.a.createElement("div",{key:e.id,style:Object(k.a)(Object(k.a)({position:"absolute"},v),{},{zIndex:10+(e.editingLabels?5:0)})},a.a.createElement(H.a,{style:Object(k.a)(Object(k.a)({position:"absolute",left:0},y?{bottom:0}:{top:0}),{},{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},a.a.createElement(le.a,{style:{width:16,height:16,color:"#333"}}))):a.a.createElement("div",{key:e.id,style:Object(k.a)(Object(k.a)({position:"absolute"},v),{},{zIndex:10+(e.editingLabels?5:0),width:200}),onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(e){return e.preventDefault()},onMouseEnter:function(t){e.editingLabels&&(o.onMouseUp(t),t.button=1,o.onMouseUp(t))}},a.a.createElement("div",Object.assign({style:Object(k.a)({position:"absolute",zIndex:20,left:0},y?{bottom:0}:{top:0})},e.editingLabels?{}:function(e){for(var t=Object(k.a)({},e),n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];for(var r=0,i=o;r<i.length;r++){var c=i[r];delete t[c]}return t}(o,"onMouseDown","onMouseUp")),a.a.createElement(h,{allowedTags:r,onOpen:i,onChange:c,onClose:l,onDelete:s,editing:e.editingLabels,region:e,regions:t,imageSrc:d,onRegionClassAdded:m,allowComments:p})))}))},ue=n(308),de=Object(ue.a)("div")({width:8,height:8,zIndex:2,border:"2px solid #FFF",position:"absolute"}),ge=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],me=Object(o.memo)((function(e){var t=e.region,n=e.mouseEvents,r=e.projectRegionBox,i=e.dragWithPrimary,c=(e.createWithPrimary,e.zoomWithPrimary),l=(e.onBeginMovePoint,e.onSelectRegion,e.layoutParams),s=e.mat,d=e.onBeginBoxTransform,g=e.onBeginMovePolygonPoint,m=e.onBeginMovePolygon1Point,p=(e.onBeginMoveKeypoint,e.onAddPolygonPoint),h=e.onAddPolygon1Point,b=e.onBeginCircleTransform,f=r(t),O=l.current,y=O.iw,v=O.ih;return a.a.createElement(o.Fragment,null,a.a.createElement("div",null,"rectangle"===t.type&&!i&&!c&&!t.locked&&t.highlighted&&s.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map((function(e,o){var r=Object(u.a)(e,2),i=r[0],c=r[1];return a.a.createElement(de,Object.assign({key:o},n,{onMouseDown:function(e){if(0===e.button)return d(t,[2*i-1,2*c-1]);n.onMouseDown(e)},style:{left:f.x-4-2+f.w*i,top:f.y-4-2+f.h*c,cursor:ge[2*c][2*i],borderRadius:.5===i&&.5===c?4:void 0}}))})),"circle"===t.type&&!i&&!c&&!t.locked&&t.highlighted&&[[t.x,t.y],[(t.x*y+Math.sqrt(Math.pow((t.xr-t.x)*y,2)+Math.pow((t.yr-t.y)*v,2)))/y,t.y],[t.x,(t.y*v+Math.sqrt(Math.pow((t.xr-t.x)*y,2)+Math.pow((t.yr-t.y)*v,2)))/v],[(t.x*y-Math.sqrt(Math.pow((t.xr-t.x)*y,2)+Math.pow((t.yr-t.y)*v,2)))/y,t.y],[t.x,(t.y*v-Math.sqrt(Math.pow((t.xr-t.x)*y,2)+Math.pow((t.yr-t.y)*v,2)))/v]].map((function(e,o){var r=Object(u.a)(e,2),i=r[0],c=r[1],l=s.clone().inverse().applyToPoint(i*y,c*v);return a.a.createElement("div",Object.assign({key:o},n,{onMouseDown:function(e){return 0===e.button&&0==o?b(t,"MOVE_REGION"):0===e.button&&0!=o?b(t,"RESIZE_CIRCLE"):void n.onMouseDown(e)},style:{left:l.x-4,top:l.y-4,borderRadius:i===t.x&&c===t.y?4:void 0}}))})),"polygon"===t.type&&!i&&!c&&!t.locked&&t.highlighted&&t.points.map((function(e,o){var r=Object(u.a)(e,2),i=r[0],c=r[1],l=s.clone().inverse().applyToPoint(i*y,c*v);return a.a.createElement(de,Object.assign({key:o},n,{onMouseDown:function(e){if(0===e.button&&(!t.open||0===o))return g(t,o);n.onMouseDown(e)},style:{cursor:t.open?0===o?"pointer":void 0:"move",zIndex:10,pointerEvents:t.open&&o===t.points.length-1?"none":void 0,left:l.x-4,top:l.y-4}}))})),"polygon1"===t.type&&!i&&!c&&!t.locked&&t.highlighted&&t.points.map((function(e,o){var r=Object(u.a)(e,2),i=r[0],c=r[1],l=s.clone().inverse().applyToPoint(i*y,c*v);return a.a.createElement(de,Object.assign({key:o},n,{onMouseDown:function(e){if(0===e.button&&(!t.open||0===o))return m(t,o);n.onMouseDown(e)},style:{cursor:t.open?0===o?"pointer":void 0:"move",zIndex:10,pointerEvents:t.open&&o===t.points.length-1?"none":void 0,left:l.x-4,top:l.y-4}}))})),"polygon"===t.type&&t.highlighted&&!i&&!c&&!t.locked&&!t.open&&t.points.length>1&&t.points.map((function(e,n){return[e,t.points[(n+1)%t.points.length]]})).map((function(e){var t=Object(u.a)(e,2),n=t[0],o=t[1];return[(n[0]+o[0])/2,(n[1]+o[1])/2]})).map((function(e,o){var r=s.clone().inverse().applyToPoint(e[0]*y,e[1]*v);return a.a.createElement(de,Object.assign({key:o},n,{onMouseDown:function(a){if(0===a.button)return p(t,e,o+1);n.onMouseDown(a)},style:{cursor:"copy",zIndex:10,left:r.x-4,top:r.y-4,border:"2px dotted #fff",opacity:.5}}))})),"polygon1"===t.type&&t.highlighted&&!i&&!c&&!t.locked&&!t.open&&t.points.length>1&&t.points.map((function(e,n){return[e,t.points[(n+1)%t.points.length]]})).map((function(e){var t=Object(u.a)(e,2),n=t[0],o=t[1];return[(n[0]+o[0])/2,(n[1]+o[1])/2]})).map((function(e,o){var r=s.clone().inverse().applyToPoint(e[0]*y,e[1]*v);return a.a.createElement(de,Object.assign({key:o},n,{onMouseDown:function(a){if(0===a.button)return h(t,e,o+1);n.onMouseDown(a)},style:{cursor:"copy",zIndex:10,left:r.x-4,top:r.y-4,border:"2px dotted #fff",opacity:.5}}))}))))}),(function(e,t){return e.region===t.region&&e.dragWithPrimary===t.dragWithPrimary&&e.createWithPrimary===t.createWithPrimary&&e.zoomWithPrimary===t.zoomWithPrimary&&e.mat===t.mat})),pe=Object(o.memo)((function(e){return e.regions.filter((function(e){return e.visible||void 0===e.visible})).filter((function(e){return!e.locked})).map((function(t,n){return a.a.createElement(me,Object.assign({key:t.id},e,{region:t}))}))}),(function(e,t){return e.regions===t.regions&&e.mat===t.mat})),he=Object(ue.a)("img")({zIndex:0,position:"absolute"}),be=Object(ue.a)("div")({zIndex:0,position:"absolute",left:0,right:0,bottom:0,top:0,backgroundColor:"rgba(255,0,0,0.2)",color:"#ff0000",fontWeight:"bold",whiteSpace:"pre-wrap",padding:50}),fe=function(e){var t=e.imagePosition,n=e.mouseEvents,r=e.imageSrc,i=e.onLoad,c=e.useCrossOrigin,l=void 0!==c&&c,s=Object(o.useRef)(),d=Object(o.useState)(),g=Object(u.a)(d,2),m=g[0],p=g[1],h=Object(z.a)((function(e){var t=e.currentTarget;i&&i({naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,imageElm:t})})),b=Object(z.a)((function(e){p("Could not load image\n\nMake sure your image works by visiting ".concat(r," in a web browser. If that URL works, the server hosting the URL may be not allowing you to access the image from your current domain. Adjust server settings to enable the image to be viewed.").concat(l?"\n\nYour image may be blocked because it's not being sent with CORs headers. To do pixel segmentation, browser web security requires CORs headers in order for the algorithm to read the pixel data from the image. CORs headers are easy to add if you're using an S3 bucket or own the server hosting your images.":"","\n\n If you need a hand, reach out to the community at universaldatatool.slack.com"))})),f=Object(o.useMemo)((function(){var e=t.bottomRight.x-t.topLeft.x,n=t.bottomRight.y-t.topLeft.y;return{imageRendering:"pixelated",left:t.topLeft.x,top:t.topLeft.y,width:isNaN(e)?0:e,height:isNaN(n)?0:n}}),[t.topLeft.x,t.topLeft.y,t.bottomRight.x,t.bottomRight.y]);return r?m?a.a.createElement(be,null,m):a.a.createElement(he,Object.assign({},n,{src:r,ref:s,style:f,onLoad:h,onError:b,crossOrigin:l?"anonymous":void 0})):a.a.createElement(be,null,"No imageSrc or videoSrc provided")},Oe=n(43),ye=n.n(Oe);for(var ve={point:Object(o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih;return a.a.createElement("g",{transform:"translate(".concat(t.x*n," ").concat(t.y*o,")")},a.a.createElement("path",{d:"M0 8L8 0L0 -8L-8 0Z",strokeWidth:2,stroke:t.color,fill:"transparent"}))})),rectangle:Object(o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih;return a.a.createElement("g",{transform:"translate(".concat(t.x*n," ").concat(t.y*o,")")},a.a.createElement("rect",{strokeWidth:2,x:0,y:0,width:Math.max(t.w*n,0),height:Math.max(t.h*o,0),stroke:ye()(t.color,.75),fill:ye()(t.color,.25)}))})),circle:Object(o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih;return a.a.createElement("g",{transform:"translate(".concat(t.x*n," ").concat(t.y*o,")")},a.a.createElement("ellipse",{strokeWidth:2,rx:Math.max(t.xr*n,0),ry:Math.max(t.yr*o,0),cx:t.x,cy:t.y,stroke:ye()(t.color,.75),fill:ye()(t.color,.25)}))})),polygon1:Object(o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih,r=(e.fullSegmentationMode,t.open?"polyline":"polygon");return a.a.createElement(r,{points:t.points.map((function(e){var t=Object(u.a)(e,2),a=t[0],r=t[1];return[a*n,r*o]})).map((function(e){return e.join(" ")})).join(" "),strokeWidth:2,stroke:ye()(t.color,.75),fill:ye()(t.color,.25)})})),polygon:Object(o.memo)((function(e){var t=e.region,n=e.iw,o=e.ih,r=(e.fullSegmentationMode,t.open?"polyline":"polygon");return a.a.createElement(r,{points:t.points.map((function(e){var t=Object(u.a)(e,2),a=t[0],r=t[1];return[a*n,r*o]})).map((function(e){return e.join(" ")})).join(" "),strokeWidth:2,stroke:ye()(t.color,.75),fill:ye()(t.color,.25)})})),pixel:function(){return null}},Ee=Object(o.memo)((function(e){var t=e.regions,n=(e.keypointDefinitions,e.iw),o=e.ih;e.fullSegmentationMode;return t.filter((function(e){return!1!==e.visible})).map((function(e){var t=ve[e.type];return a.a.createElement(t,{key:e.regionId,region:e,iw:n,ih:o})}))}),(function(e,t){return e.regions===t.regions&&e.iw===t.iw&&e.ih===t.ih})),je=function(e){e.mat;var t=e.imagePosition,n=e.regions,o=void 0===n?[]:n,r=t.bottomRight.x-t.topLeft.x,i=t.bottomRight.y-t.topLeft.y;return isNaN(r)||isNaN(i)?null:a.a.createElement("svg",{width:r,height:i,style:{position:"absolute",zIndex:2,left:t.topLeft.x,top:t.topLeft.y,pointerEvents:"none",width:r,height:i}},a.a.createElement(Ee,{key:"wrapped-region-list",regions:o,iw:r,ih:i}))},xe=Object(b.a)({canvas:{width:"100%",height:"100%",position:"relative",zIndex:1},zoomIndicator:{position:"absolute",bottom:16,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4}}),Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.iw,o=t.ih,a=G.Matrix.from(1,0,0,1,-10,-10);return e&&n&&(a=a.translate(e.x*n,e.y*o).scaleU(e.w+.05)),a},we=function(e){var t=e.regions,n=e.imageSrc,r=e.onMouseMove,i=void 0===r?function(e){return null}:r,c=e.onMouseDown,l=void 0===c?function(e){return null}:c,s=e.onMouseUp,d=void 0===s?function(e){return null}:s,g=e.dragWithPrimary,m=void 0!==g&&g,p=e.zoomWithPrimary,h=void 0!==p&&p,b=e.createWithPrimary,f=void 0!==b&&b,O=e.regionTagList,y=e.allowedArea,v=e.onLoaded,E=e.onChangeRegion,j=e.onBeginRegionEdit,x=e.onCloseRegionEdit,I=e.onBeginBoxTransform,w=e.onBeginMovePolygonPoint,T=e.onAddPolygonPoint,_=e.onBeginMovePolygon1Point,M=e.onAddPolygon1Point,P=e.onBeginMoveKeypoint,C=e.onSelectRegion,N=e.onBeginMovePoint,L=e.onDeleteRegion,R=e.onRegionClassAdded,S=e.zoomOnAllowedArea,D=void 0===S||S,A=e.allowComments,G=(e.nBeginCircleTransform,xe()),H=Object(o.useRef)(null),V=Object(o.useRef)({}),Z=Object(Y.a)(!1),F=Object(u.a)(Z,2),K=F[0],J=F[1],X=Object(Y.a)(null),$=Object(u.a)(X,2),q=$[0],Q=$[1],ee=Object(Y.a)(null),te=Object(u.a)(ee,2),ne=te[0],oe=te[1],ae=Object(Y.a)(Ie()),re=Object(u.a)(ae,2),ie=re[0],ce=re[1],le=W({canvasEl:H,dragging:K,mat:ie,layoutParams:V,changeMat:ce,zoomStart:q,zoomEnd:ne,changeZoomStart:Q,changeZoomEnd:oe,changeDragging:J,zoomWithPrimary:h,dragWithPrimary:m,onMouseMove:i,onMouseDown:l,onMouseUp:d}),ue=le.mouseEvents,de=(le.mousePosition,U({layoutParams:V,mat:ie})),ge=Object(o.useState)(),me=Object(u.a)(ge,2),he=me[0],be=me[1],Oe=Boolean(he&&he.naturalWidth),ye=Object(z.a)((function(e){var t={naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight};v&&v(t),be(t)})),ve=H.current;if(ve&&Oe){var Ee=ve.clientWidth,we=ve.clientHeight,Te=Math.max(he.naturalWidth/(Ee-20),he.naturalHeight/(we-20)),_e=he.naturalWidth/Te,Me=he.naturalHeight/Te;V.current={iw:_e,ih:Me,fitScale:Te,canvasWidth:Ee,canvasHeight:we}}Object(o.useEffect)((function(){Oe&&ce(Ie(D?y:null,V.current))}),[Oe]),Object(o.useLayoutEffect)((function(){if(he){var e=ve.clientWidth,t=ve.clientHeight;ve.width=e,ve.height=t;var n=ve.getContext("2d");n.save(),n.transform.apply(n,Object(B.a)(ie.clone().inverse().toArray()));var o=V.current,a=o.iw,r=o.ih;if(y){var i=y.x,c=y.y,l=y.w,s=y.h;n.save(),n.globalAlpha=1;var u=[[0,0],[a,0],[a,r],[0,r]],d=[[i*a,c*r],[i*a+l*a,c*r],[i*a+l*a,c*r+s*r],[i*a,c*r+s*r]];n.moveTo.apply(n,Object(B.a)(u[0])),u.forEach((function(e){return n.lineTo.apply(n,Object(B.a)(e))})),n.lineTo.apply(n,Object(B.a)(u[0])),n.closePath(),d.reverse(),n.moveTo.apply(n,Object(B.a)(d[0])),d.forEach((function(e){return n.lineTo.apply(n,Object(B.a)(e))})),n.lineTo.apply(n,Object(B.a)(d[0])),n.fill(),n.restore()}n.restore()}}));var Pe=V.current,Ce=Pe.iw,Ne=Pe.ih,Le=q&&ne?Object(k.a)(Object(k.a)({},ie.clone().inverse().applyToPoint(q.x,q.y)),{},{w:(ne.x-q.x)/ie.a,h:(ne.y-q.y)/ie.d}):null;Le&&(Le.w<0&&(Le.x+=Le.w,Le.w*=-1),Le.h<0&&(Le.y+=Le.h,Le.h*=-1));var Re={topLeft:ie.clone().inverse().applyToPoint(0,0),bottomRight:ie.clone().inverse().applyToPoint(Ce,Ne)};return a.a.createElement("div",{style:{width:"100%",height:"100%",maxHeight:"calc(100vh - 68px)",position:"relative",overflow:"hidden",cursor:f?"crosshair":K?"grabbing":m?"grab":h?ie.a<1?"zoom-out":"zoom-in":void 0}},Oe&&!K&&a.a.createElement(pe,{key:"regionSelectAndTransformBoxes",regions:y?[{type:"rectangle",id:"$$allowed_area",cls:"allowed_area",highlighted:!0,x:y.x,y:y.y,w:y.w,h:y.h,visible:!0,color:"#ff0"}]:t,mouseEvents:ue,projectRegionBox:de,dragWithPrimary:m,createWithPrimary:f,zoomWithPrimary:h,onBeginMovePoint:N,onSelectRegion:C,layoutParams:V,mat:ie,onBeginBoxTransform:I,onBeginMovePolygonPoint:w,onBeginMoveKeypoint:P,onAddPolygonPoint:T,onAddPolygon1Point:M,onBeginMovePolygon1Point:_}),Oe&&!K&&a.a.createElement("div",{key:"regionTags"},a.a.createElement(se,{regions:t,projectRegionBox:de,mouseEvents:ue,regionTagList:O,onBeginRegionEdit:j,onChangeRegion:E,onCloseRegionEdit:x,onDeleteRegion:L,layoutParams:V,imageSrc:n,onRegionClassAdded:R,allowComments:A})),h&&null!==Le&&a.a.createElement("div",{key:"zoomBox",style:{position:"absolute",zIndex:1,border:"1px solid #fff",pointerEvents:"none",left:Le.x,top:Le.y,width:Le.w,height:Le.h}}),a.a.createElement("div",Object.assign({style:{width:"100%",height:"100%"}},ue),a.a.createElement(a.a.Fragment,null,a.a.createElement("canvas",{style:{opacity:.25},className:G.canvas,ref:H}),a.a.createElement(je,{imagePosition:Re,regions:t}),a.a.createElement(fe,{imagePosition:Re,mouseEvents:ue,onLoad:ye,imageSrc:n}))),a.a.createElement("div",{className:G.zoomIndicator},(1/ie.a*100).toFixed(0),"%"))},Te={container:{display:"flex",flexGrow:1,flexDirection:"column",height:"100%",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},headerTitle:{fontWeight:"bold",color:V.a[700],paddingLeft:16}},_e=(n(375),n(294)),Me=n.n(_e),Pe=function(e){var t,n,o=null;return"image"===e.annotationType&&(-1===(o=e.selectedImage)?(o=null,n=null):(t=["images",o],n=Object(oe.getIn)(e,t))),{currentImageIndex:o,pathToActiveImage:t,activeImage:n}},Ce=n(111),Ne={},Le=0,Re=[{id:"zoom_tool",description:"Select the Zoom Tool"},{id:"create_point",description:"Create a point"},{id:"create_rectangle",description:"Create a rectangle"},{id:"pan_tool",description:"Select the Pan Tool"},{id:"create_polygon",description:"Create a Polygon"},{id:"create_polygon1",description:"Create a Polygon with Holes"},{id:"create_circle",description:"Create a Ellipse"},{id:"save_and_previous_sample",description:"Save and go to previous sample"},{id:"save_and_next_sample",description:"Save and go to next sample"},{id:"save_and_exit_sample",description:"Save and exit current sample"},{id:"exit_sample",description:"Exit sample without saving"},{id:"delete_region",description:"Delete selected region"},{id:"undo",description:"Undo latest change"}];Le<Re.length;Le++){var Se=Re[Le],De=Se.id,ke=Se.binding;Ne[De]=ke}var Ae=function(e){var t=e.dispatch;return Object(o.useMemo)((function(){return{zoom_tool:function(){t({type:"SELECT_TOOL",selectedTool:"zoom"})},create_point:function(){t({type:"SELECT_TOOL",selectedTool:"create-point"})},create_rectangle:function(){t({type:"SELECT_TOOL",selectedTool:"create-rectangle"})},pan_tool:function(){t({type:"SELECT_TOOL",selectedTool:"pan"})},create_polygon:function(){t({type:"SELECT_TOOL",selectedTool:"create-polygon"})},create_polygon1:function(){t({type:"SELECT_TOOL",selectedTool:"create-polygon1"})},create_circle:function(){t({type:"SELECT_TOOL",selectedTool:"create-circle"})},save_and_previous_sample:function(){t({type:"HEADER_BUTTON_CLICKED",buttonName:"Prev"})},save_and_next_sample:function(){t({type:"HEADER_BUTTON_CLICKED",buttonName:"Next"})},save_and_exit_sample:function(){t({type:"HEADER_BUTTON_CLICKED",buttonName:"Save"})},delete_region:function(){t({type:"DELETE_SELECTED_REGION"})},undo:function(){t({type:"RESTORE_HISTORY"})}}}),[t])},Be=n(50),Ge=n(55),We=n(295),ze={marginTop:4,width:16,height:16,marginBottom:4},Ue={pan:function(){return a.a.createElement(Be.a,{style:ze,size:"xs",fixedWidth:!0,icon:Ge.c})},zoom:function(){return a.a.createElement(Be.a,{style:ze,size:"xs",fixedWidth:!0,icon:Ge.e})},"create-point":function(){return a.a.createElement(Be.a,{style:ze,size:"xs",fixedWidth:!0,icon:Ge.a})},"create-rectangle":function(){return a.a.createElement(Be.a,{style:ze,size:"xs",fixedWidth:!0,icon:Ge.f})},"create-polygon":function(){return a.a.createElement(Be.a,{style:ze,size:"xs",fixedWidth:!0,icon:Ge.b})},"create-polygon1":function(){return a.a.createElement(Be.a,{style:ze,size:"xs",fixedWidth:!0,icon:Ge.d})},"create-circle":function(){return a.a.createElement(Be.a,{style:ze,size:"xs",fixedWidth:!0,icon:We.a})}},Ye=n(306),He=Object(b.a)(Te),Ve=Object(Ce.withHotKeys)((function(e){var t=e.hotKeys,n=e.children,o=e.divRef,r=Object(A.a)(e,["hotKeys","children","divRef"]);return a.a.createElement("div",Object.assign({},Object(k.a)(Object(k.a)({},t),r),{ref:o}),n)})),Ze=function(e){var t=e.state,n=e.dispatchAction,r=He(),i=Object(o.useRef)({}),c=function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];var r="".concat(e,"(").concat(o.join(","),")");if(i.current[r])return i.current[r];var c=function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return o.length>0?n(Object(k.a)({type:e},o.reduce((function(e,t,n){return e[t]=a[n],e}),{}))):n(Object(k.a)({type:e},a[0]))};return i.current[r]=c,c},l=Pe(t),s=l.currentImageIndex,u=l.activeImage;null!==s&&t.images[s+1],Me()((function(){return n({type:"CANCEL"})}),{detectKeys:[27]});var d=Object(o.useRef)(),g=Ae({dispatchAction:n}),m=Object(o.useCallback)((function(e){d.current&&(d.current.contains(document.activeElement)||d.current.contains(e.target)&&(d.current.focus(),e.target.focus()))}),[]),p=a.a.createElement(we,{key:t.selectedImage,showTags:t.showTags,regionTagList:t.regionTagList,regions:u.regions||[],realSize:u?u.realSize:void 0,imageSrc:"image"===t.annotationType?u.src:null,pointDistancePrecision:t.pointDistancePrecision,createWithPrimary:t.selectedTool.includes("create"),dragWithPrimary:"pan"===t.selectedTool,zoomWithPrimary:"zoom"===t.selectedTool,onMouseMove:c("MOUSE_MOVE"),onMouseDown:c("MOUSE_DOWN"),onMouseUp:c("MOUSE_UP"),onChangeRegion:c("CHANGE_REGION","region"),onBeginRegionEdit:c("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:c("CLOSE_REGION_EDITOR","region"),onDeleteRegion:c("DELETE_REGION","region"),onBeginBoxTransform:c("BEGIN_BOX_TRANSFORM","rectangle","directions"),onBeginMovePolygonPoint:c("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onAddPolygonPoint:c("ADD_POLYGON_POINT","polygon","point","pointIndex"),onBeginMovePolygon1Point:c("BEGIN_MOVE_POLYGON1_POINT","polygon1","point1Index"),onAddPolygon1Point:c("ADD_POLYGON1_POINT","polygon1","point1","point1Index"),onBeginCircleTransform:c("BEGIN_CIRCLE_TRANSFORM","circle","directions"),onSelectRegion:c("SELECT_REGION","region"),onBeginMovePoint:c("BEGIN_MOVE_POINT","point"),onImageLoaded:c("IMAGE_LOADED","image"),allowComments:t.allowComments}),h=Object(z.a)((function(e){n({type:"SELECT_TOOL",selectedTool:e.name})})),b=Object(z.a)((function(e){n({type:"HEADER_BUTTON_CLICKED",buttonName:e.name})}));return a.a.createElement(Ve,{tabIndex:-1,divRef:d,onMouseDown:m,onMouseOver:m,allowChanges:!0,handlers:g,className:K()(r.container)},a.a.createElement(Ye.a,{iconDictionary:Ue,headerLeftSide:[u?a.a.createElement("div",{className:r.headerTitle},u.name):null].filter(Boolean),headerItems:[{name:"Prev"},{name:"Next"},{name:"Save"}].filter(Boolean),onClickHeaderItem:b,onClickIconSidebarItem:h,selectedTools:[t.selectedTool].filter(Boolean),iconSidebarItems:[{name:"pan",helperText:"Drag/Pan (right or middle click)",alwaysShowing:!0},{name:"zoom",helperText:"Zoom In/Out",alwaysShowing:!0},{name:"create-point",helperText:"Add Point"},{name:"create-rectangle",helperText:"Add Rectangle"},{name:"create-polygon",helperText:"Add Polygon"},{name:"create-polygon1",helperText:"Add Polygon with Holes"},{name:"create-circle",helperText:"Add Ellipse"}].filter(Boolean).filter((function(e){return e.alwaysShowing||t.enabledTools.includes(e.name)}))},p))},Fe=n(303),Ke=n(150),Je=n.n(Ke),Xe=n(151),$e=n.n(Xe),qe={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region",BEGIN_CIRCLE_TRANSFORM:"Transform/Move Circle"},Qe=function(e,t){return Object(oe.updateIn)(e,["history"],(function(n){return[{time:$e()().toDate(),state:Object(oe.without)(e,"history"),name:t}].concat((n||[]).slice(0,9))}))},et=n(71),tt=n(72),nt=n(70),ot=n(264),at=n(262),rt=n(69),it=n(260),ct=n(68),lt=n(261),st=n(263),ut=n(265),dt=[g.a[500],et.a[500],tt.a[500],nt.a[800],ot.a[500],at.a[700],rt.a[500],it.a[500],ct.a[500],lt.a[500],st.a[500],ut.a[500]];dt.map((function(e){return(2281701376|function(e){var t=(e=e.replace("#","")).substr(4,2)+e.substr(2,2)+e.substr(0,2);return parseInt(t,16)}(e))>>>0}));var gt=dt,mt=function(){return Math.random().toString().split(".")[1]},pt=function(e,t){if("MOUSE_MOVE"===t.type){if(Date.now()-(e.lastMouseMoveCall||0)<16)return e;e=Object(oe.setIn)(e,["lastMouseMoveCall"],Date.now())}t.type.includes("MOUSE")||(e=Object(oe.setIn)(e,["lastAction"],t));var n=Pe(e),o=n.currentImageIndex,a=n.pathToActiveImage,r=n.activeImage,i=function(e){var t="string"===typeof e||"number"===typeof e?e:e.id;if(!r)return null;var n=(r.regions||[]).findIndex((function(e){return e.id===t}));return-1===n?null:n},c=function(e){if(!r)return null;var t=i(e);return null===t?[null,null]:[r.regions[t],t]},l=function(t,n){var o=c(t),i=Object(u.a)(o,2),l=i[0],s=i[1];if(!l)return e;if(null!==n)return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",s]),Object(k.a)(Object(k.a)({},l),n));var d=r.regions;return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),(d||[]).filter((function(e){return e.id!==l.id})))},s=function(e){return null===o?e:Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),(r.regions||[]).map((function(e){return Object(k.a)(Object(k.a)({},e),{},{editingLabels:!1})})))},d=function(t,n){("object"===typeof t?t:{src:t}).src;return Object(oe.setIn)(Object(oe.setIn)(e,["selectedImage"],n),["selectedImageFrameTime"])};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return d(t.image,t.imageIndex);case"CHANGE_REGION":var g=i(t.region);if(null===g)return e;var m=r.regions[g];if(m.cls!==t.region.cls){var p=(e=Qe(e,"Change Region Classification")).regionClsList.indexOf(t.region.cls);-1!==p&&(t.region.color=gt[p%gt.length])}return Je()(m.tags,t.region.tags)||(e=Qe(e,"Change Region Tags")),Je()(m.comment,t.region.comment)||(e=Qe(e,"Change Region Comment")),Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",g]),t.region);case"CHANGE_IMAGE":if(!r)return e;for(var h=t.delta,b=0,f=Object.keys(h);b<f.length;b++){var O=f[b];"cls"===O&&Qe(e,"Change Image Class"),"tags"===O&&Qe(e,"Change Image Tags"),e=Object(oe.setIn)(e,[].concat(Object(B.a)(a),[O]),h[O])}return e;case"SELECT_REGION":var y=t.region;if(null===i(t.region))return e;var v=Object(B.a)(r.regions||[]).map((function(e){return Object(k.a)(Object(k.a)({},e),{},{highlighted:e.id===y.id,editingLabels:e.id===y.id})}));return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),v);case"BEGIN_MOVE_POINT":return e=s(e),Object(oe.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":var E=t.rectangle,j=t.directions;return e=s(e),0===j[0]&&0===j[1]?Object(oe.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:E.id}):Object(oe.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:E.id,freedom:j,original:{x:E.x,y:E.y,w:E.w,h:E.h}});case"BEGIN_MOVE_POLYGON_POINT":var x=t.polygon,I=t.pointIndex;return(e=s(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===I?Object(oe.setIn)(l(x,{points:x.points.slice(0,-1),open:!1}),["mode"],null):(e=Qe(e,"Move Polygon Point"),Object(oe.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:x.id,pointIndex:I}));case"ADD_POLYGON_POINT":var w=t.polygon,T=t.point,_=t.pointIndex,M=i(w);if(null===M)return e;var P=Object(B.a)(w.points);return P.splice(_,0,T),Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",M]),Object(k.a)(Object(k.a)({},w),{},{points:P}));case"BEGIN_MOVE_POLYGON1_POINT":var C=t.polygon1,N=t.point1Index;return(e=s(e)).mode&&"DRAW_POLYGON1"===e.mode.mode&&0===N?Object(oe.setIn)(l(C,{points:C.points.slice(0,-1),open:!1}),["mode"],null):(e=Qe(e,"Move Polygon Point"),Object(oe.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:C.id,point1Index:N}));case"ADD_POLYGON1_POINT":var L=t.polygon1,R=t.point1,S=t.point1Index,D=i(L);if(null===D)return e;var A=Object(B.a)(L.points),G=Object(B.a)(L.holes),W=Object(B.a)(L.open),z=Object(B.a)(L.creatingHole);return A.splice(S,0,R),W||(z=!0,G.splice(S-A.length,0,R)),Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",D]),Object(k.a)(Object(k.a)({},L),{},{points:A,holes:G,creatingHole:z}));case"MOUSE_MOVE":var U=t.x,Y=t.y;if(!e.mode)return e;if(!r)return e;e.mouseDownAt;switch(e.mode.mode){case"MOVE_POLYGON_POINT":var H=e.mode,V=H.pointIndex,Z=H.regionId,F=i(Z);return null===F?e:Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",F,"points",V]),[U,Y]);case"MOVE_POLYGON1_POINT":var K=e.mode,J=K.pointIndex,X=K.regionId,$=i(X);return null===$?e:Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",$,"points","holes",J]),[U,Y]);case"MOVE_REGION":var q=e.mode.regionId;if("$$allowed_area"===q){var Q=e.allowedArea,ee=Q.w,te=Q.h;return Object(oe.setIn)(e,["allowedArea"],{x:U-ee/2,y:Y-te/2,w:ee,h:te})}var ne=i(q);return null===ne?e:Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",ne]),function(e,t,n){switch(e.type){case"point":return Object(k.a)(Object(k.a)({},e),{},{x:t,y:n});case"rectangle":return Object(k.a)(Object(k.a)({},e),{},{x:t-e.w/2,y:n-e.h/2});case"circle":return Object(k.a)(Object(k.a)({},e),{},{x:t,y:n})}return e}(r.regions[ne],U,Y));case"RESIZE_BOX":var ae=e.mode,re=ae.regionId,ie=Object(u.a)(ae.freedom,2),ce=ie[0],le=ie[1],se=ae.original,ue=se.x,de=se.y,ge=se.w,me=se.h,pe=0===ce?ue:-1===ce?Math.min(ue+ge,U):ue,he=0===ce?ge:-1===ce?ge+(ue-pe):Math.max(0,ge+(U-ue-ge)),be=0===le?de:-1===le?Math.min(de+me,Y):de,fe=0===le?me:-1===le?me+(de-be):Math.max(0,me+(Y-de-me));if(he<=.001&&(e=Object(oe.setIn)(e,["mode","freedom"],[-1*ce,le])),fe<=.001&&(e=Object(oe.setIn)(e,["mode","freedom"],[ce,-1*le])),"$$allowed_area"===re)return Object(oe.setIn)(e,["allowedArea"],{x:pe,w:he,y:be,h:fe});var Oe=i(re);if(null===Oe)return e;var ye=r.regions[Oe];return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",Oe]),Object(k.a)(Object(k.a)({},ye),{},{x:pe,w:he,y:be,h:fe}));case"DRAW_POLYGON":var ve=e.mode.regionId,Ee=c(ve),je=Object(u.a)(Ee,2),xe=je[0],Ie=je[1];return xe?Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",Ie,"points",xe.points.length-1]),[U,Y]):Object(oe.setIn)(e,["mode"],null);case"DRAW_POLYGON1":var we=e.mode.regionId,Te=c(we),_e=Object(u.a)(Te,2),Me=_e[0],Ce=_e[1];return Me?Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",Ce,"points","holes","createHole",Me.points.length+Me.holes.length-1]),[U,Y]):Object(oe.setIn)(e,["mode"],null);case"RESIZE_CIRCLE":var Ne=e.mode.regionId,Le=c(Ne),Re=Object(u.a)(Le,2),Se=Re[0],De=Re[1];return Se?Object(oe.setIn)(e,["images",o,"regions",De],Object(k.a)(Object(k.a)({},Se),{},{xr:Math.abs(Se.x-U),yr:Math.abs(Se.y-Y)})):Object(oe.setIn)(e,["mode"],null);default:return e}case"MOUSE_DOWN":if(!r)return e;var ke,Ae=t.x,Be=t.y;if((e=Object(oe.setIn)(e,["mouseDownAt"],{x:Ae,y:Be})).mode)switch(e.mode.mode){case"DRAW_POLYGON":var Ge=c(e.mode.regionId),We=Object(u.a)(Ge,2),ze=We[0],Ue=We[1];if(!ze)break;return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",Ue]),Object(k.a)(Object(k.a)({},ze),{},{points:ze.points.concat([[Ae,Be]])}));case"DRAW_POLYGON1":var Ye=c(e.mode.regionId),He=Object(u.a)(Ye,2),Ve=He[0],Ze=He[1];if(!Ve)break;return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",Ze]),Object(k.a)(Object(k.a)({},Ve),{},{points:Ve.points.concat([[Ae,Be]]),holes:Ve.holes.concat([[Ae,Be]])}));case"DRAW_CIRCLE":var Fe=c(e.mode.regionId),Ke=Object(u.a)(Fe,2),Xe=Ke[0],$e=Ke[1];if(!Xe)break;return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",$e]),Object(k.a)({},Xe))}var qe=void 0,et="#ff0000";if(r&&(r.regions||[]).length>0){qe=r.regions.slice(-1)[0].cls;var tt=(e.regionClsList||[]).indexOf(qe);-1!==tt&&(et=gt[tt%gt.length])}switch(e.selectedTool){case"create-point":e=Qe(e,"Create Point"),ke={type:"point",x:Ae,y:Be,highlighted:!0,editingLabels:!0,color:et,id:mt(),cls:qe};break;case"create-rectangle":e=Qe(e,"Create Rectangle"),ke={type:"rectangle",x:Ae,y:Be,w:0,h:0,highlighted:!0,editingLabels:!1,color:et,cls:qe,id:mt()},e=Object(oe.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:ke.id,freedom:[1,1],original:{x:Ae,y:Be,w:ke.w,h:ke.h},isNew:!0});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=Qe(e,"Create Polygon"),ke={type:"polygon",points:[[Ae,Be],[Ae,Be]],open:!0,highlighted:!0,color:et,cls:qe,id:mt()},e=Object(oe.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:ke.id});break;case"create-polygon1":if(e.mode&&"DRAW_POLYGON1"===e.mode.mode)break;e=Qe(e,"Create Polygon1"),ke={type:"polygon1",points:[[Ae,Be],[Ae,Be]],holes:[[Ae,Be],[Ae,Be]],open:!0,creatingHole:!1,highlighted:!0,color:et,cls:qe,id:mt()},e=Object(oe.setIn)(e,["mode"],{mode:"DRAW_POLYGON1",regionId:ke.id});break;case"create-circle":e=Qe(e,"Create Circle"),ke={type:"circle",x:Ae,y:Be,xr:.1,yr:.1,highlighted:!0,editingLabels:!1,color:et,id:mt()},e=Object(oe.setIn)(e,["mode"],{mode:"RESIZE_CIRCLE",editLabelEditorAfter:!0,regionId:ke.id,original:{x:Ae,y:Be,xr:ke.xr,yr:ke.yr}})}var nt=Object(B.a)(Object(oe.getIn)(e,a).regions||[]).map((function(e){return Object(oe.setIn)(e,["editingLabels"],!1).setIn(["highlighted"],!1)})).concat(ke?[ke]:[]);return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),nt);case"MOUSE_UP":var ot=t.x,at=t.y;e.mouseDownAt;if(!e.mode)return e;switch((e=Object(oe.setIn)(e,["mouseDownAt"],null)).mode.mode){case"RESIZE_BOX":if(e.mode.isNew&&(Math.abs(e.mode.original.x-ot)<.002||Math.abs(e.mode.original.y-at)<.002))return Object(oe.setIn)(l(e.mode.regionId,null),["mode"],null);if(e.mode.editLabelEditorAfter)return Object(k.a)(Object(k.a)({},l(e.mode.regionId,{editingLabels:!0})),{},{mode:null});case"MOVE_REGION":case"RESIZE_CIRCLE":if(e.mode.editLabelEditorAfter)return Object(k.a)(Object(k.a)({},l(e.mode.regionId,{editingLabels:!0})),{},{mode:null});case"MOVE_POLYGON_POINT":case"MOVE_POLYGON1_POINT":return Object(k.a)(Object(k.a)({},e),{},{mode:null});default:return e}case"OPEN_REGION_EDITOR":t.region;var rt=i(t.region);if(null===rt)return e;var it=Object(oe.setIn)(r.regions.map((function(e){return Object(k.a)(Object(k.a)({},e),{},{highlighted:!1,editingLabels:!1})})),[rt],Object(k.a)(Object(k.a)({},(r.regions||[])[rt]),{},{highlighted:!0,editingLabels:!0}));return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),it);case"CLOSE_REGION_EDITOR":var ct=i(t.region);return null===ct?e:Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions",ct]),Object(k.a)(Object(k.a)({},(r.regions||[])[ct]),{},{editingLabels:!1}));case"DELETE_REGION":return null===i(t.region)?e:Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),(r.regions||[]).filter((function(e){return e.id!==t.region.id})));case"DELETE_SELECTED_REGION":return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),(r.regions||[]).filter((function(e){return!e.highlighted})));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===o||0===o?e:d(e.images[o-1],o-1);case"next":return null===o||o===e.images.length-1?e:d(e.images[o+1],o+1);case"clone":return null===o||o===e.images.length-1?e:Object(oe.setIn)(d(e.images[o+1],o+1),["images",o+1,"regions"],r.regions);case"hotkeys":return e;case"exit":case"done":default:return e}case"SELECT_TOOL":return e=Object(oe.setIn)(e,["mode"],null),Object(oe.setIn)(e,["selectedTool"],t.selectedTool);case"BEGIN_CIRCLE_TRANSFORM":var lt=t.circle,st=t.directions;return e=s(e),"MOVE_REGION"===st?Object(oe.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:lt.id}):Object(oe.setIn)(e,["mode"],{mode:"RESIZE_CIRCLE",regionId:lt.id,original:{x:lt.x,y:lt.y,rx:lt.rx,ry:lt.ry}});case"CANCEL":var ut=e.mode;if(ut)switch(ut.mode){case"DRAW_POLYGON":return l(ut.regionId,null);case"DRAW_POLYGON1":return l(ut.regionId,null);case"MOVE_POLYGON_POINT":case"MOVE_POLYGON1_POINT":case"RESIZE_BOX":case"RESIZE_CIRCLE":case"MOVE_REGION":return Object(oe.setIn)(e,["mode"],null);default:return e}var dt=r.regions;if(dt&&dt.some((function(e){return e.editingLabels})))return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),dt.map((function(e){return Object(k.a)(Object(k.a)({},e),{},{editingLabels:!1})})));if(dt)return Object(oe.setIn)(e,[].concat(Object(B.a)(a),["regions"]),dt.map((function(e){return Object(k.a)(Object(k.a)({},e),{},{highlighted:!1})})))}return e},ht=function(e,t){var n=Pe(e),o=n.currentImageIndex;n.pathToActiveImage,n.activeImage;switch(t.type){case"IMAGE_LOADED":return Object(oe.setIn)(e,["images",o,"pixelSize"],{w:t.metadata.naturalWidth,h:t.metadata.naturalHeight})}return e},bt=function(e){var t=e.images,n=e.selectedImage,r=void 0===n?t&&t.length>0?0:void 0:n,i=e.enabledTools,c=void 0===i?["select","create-point","create-rectangle","create-polygon","create-polygon1","create-circle"]:i,l=e.selectedTool,s=void 0===l?"select":l,d=e.regionTagList,g=void 0===d?[]:d,m=e.onExit,p=e.onNextImage,h=e.onPrevImage,b=e.allowComments;"string"===typeof r&&-1===(r=(t||[]).findIndex((function(e){return e.src===r})))&&(r=void 0);var f,O=Object(o.useReducer)((f=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n){var o,a=Object(Fe.a)(t);try{for(a.s();!(o=a.n()).done;)e=(0,o.value)(e,n)}catch(r){a.e(r)}finally{a.f()}return e}}(ht,pt),function(e,t){var n=e,o=f(e,t);if("RESTORE_HISTORY"===t.type){if(e.history.length>0)return Object(oe.setIn)(o.history[0].state,["history"],o.history.slice(1))}else if(n!==o&&Object.keys(qe).includes(t.type))return Object(oe.setIn)(o,["history"],[{time:$e()().toDate(),state:Object(oe.without)(n,"history"),name:qe[t.type]||t.type}].concat(o.history||[]).slice(0,9));return o}),ae()(Object(k.a)({annotationType:"image",selectedTool:s,mode:null,regionTagList:g,enabledTools:c,history:[],allowComments:b},{selectedImage:r,images:t}))),y=Object(u.a)(O,2),v=y[0],E=y[1],j=Object(z.a)((function(e){if("HEADER_BUTTON_CLICKED"===e.type){if(["Exit","Done","Save","Complete"].includes(e.buttonName))return m(Object(oe.without)(v,"history"));if("Next"===e.buttonName&&p)return p(Object(oe.without)(v,"history"));if("Prev"===e.buttonName&&h)return h(Object(oe.without)(v,"history"))}E(e)})),x=Object(z.a)((function(e){E({type:"ON_CLS_ADDED",cls:e})}));return Object(o.useEffect)((function(){void 0!==r&&E({type:"SELECT_IMAGE",imageIndex:r,image:v.images[r]})}),[r]),t?a.a.createElement(Ze,{alwaysShowNextButton:Boolean(p),alwaysShowPrevButton:Boolean(h),state:v,dispatchAction:j,onRegionClassAdded:x}):'Missing required prop "images" '},ft=n(449),Ot=function(e){Object(L.a)(n,e);var t=Object(R.a)(n);function n(e){var o;return Object(P.a)(this,n),(o=t.call(this,e)).state={error:null,isLoaded:!1,EnabledTools:null,AllowComments:null,Tags:null,imgData:[{src:"https://geodata.lib.utexas.edu/assets/blac_featured_image_map-dca4cbca4e07010e5bd201ad8fab1cc0aa9abd24a8842f90e3c1eef1834e8498.jpg",name:"Image 1",regions:[]},{src:"https://geodata.lib.utexas.edu/assets/utlmaps_featured_image_map-c07ae2551145ff2e5f5fa3c71baa345d9d674a33b08f422449203cf9ed47e0d1.jpg",name:"Image 2",regions:[]},{src:"https://1igc0ojossa412h1e3ek8d1w-wpengine.netdna-ssl.com/wp-content/uploads/2018/03/TMSELEMWORLD.M.jpg",name:"Image 3",regions:[]}]},o.props=e,o.submitTask=o.submitTask.bind(Object(N.a)(o)),o.getSubmissionUrl=o.getSubmissionUrl.bind(Object(N.a)(o)),o.handleSubmit=o.handleSubmit.bind(Object(N.a)(o)),o.componentDidMount=o.componentDidMount(Object(N.a)(o)),o}return Object(C.a)(n,[{key:"getTools",value:function(e){console.log("get tool:",e.Tools.enenabledTools)}},{key:"componentDidMount",value:function(){var e=this;fetch("./backendConfig.json").then((function(e){return e.json()})).then((function(t){var n=function(e){for(var t=e.enabledTools,n=[],o=0;o<t.length;o++)1==t[o]["create point"]?n.push("create-point"):1==t[o]["create rectangle"]?n.push("create-rectangle"):1==t[o]["create polygon"]?n.push("create-polygon"):1==t[o]["create polygon1"]?n.push("create-polygon1"):1==t[o]["create ellipse"]&&n.push("create-circle");return n}(t.setup);e.setState({isLoaded:!0,EnabledTools:n,AllowComments:t.setup["allow-comments"],Tags:t.setup.tags}),console.log("res is: ",t)}),(function(t){e.setState({isLoaded:!0,error:t})}))}},{key:"parseParameters",value:function(e){var t={assignmentId:null,hitId:null,workerId:null,turkSubmitTo:null},n=e.split("?")[1];if(n)for(var o=n.split("&"),a=0;a<o.length;++a){var r=o[a].split("="),i=r[0],c=r[1];i in t&&(t[i]=c)}return t}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=document.getElementById("submitButton");t.setAttribute("value",JSON.stringify(this.state.imgData)),console.log(t);var n=document.getElementById("submitForm");HTMLFormElement.prototype.submit.call(n)}},{key:"submitTask",value:function(e){console.log("POSTing data"),D.a.post("".concat(this.getSubmissionUrl()),{}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}},{key:"getSubmissionUrl",value:function(){var e=this.parseParameters(window.location.href).assignmentId,t=ft.submit.production+"/?assignmentId="+e;return console.log(t),t}},{key:"render",value:function(){var e=this,t=this.state,n=t.error,o=t.isLoaded,r=t.EnabledTools,i=t.AllowComments,c=t.Tags,l=t.imgData;return console.log("data is:",this.state),n?a.a.createElement("div",null,"Error: ",n.message):o?a.a.createElement("div",{id:"Submit"},a.a.createElement("form",{id:"submitForm",type:"submit",method:"POST",action:this.getSubmissionUrl()},a.a.createElement(bt,{name:"AnnotationTool",type:"submit",ref:function(t){e.value=t},images:l,enabledTools:r,regionTagList:c,allowComments:i,onExit:function(t){e.setState({imgData:t.images}),console.log(JSON.stringify(t.images))}}),a.a.createElement("div",null,a.a.createElement(d.a,{variant:"outline-dark",size:"lg",block:!0,name:"Annotation",type:"submit",id:"submitButton",value:JSON.stringify(this.state.imgData),ref:function(t){e.value=t}},"Complete the HIT")))):a.a.createElement("div",null,"Loading...")}}]),n}(o.Component),yt=Object(b.a)(p);var vt=n(152),Et=function(e){Object(L.a)(n,e);var t=Object(R.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"render",value:function(){var e=[];return Object.keys(vt).forEach((function(t){return e.push(vt[t])})),console.log(e),a.a.createElement("div",null,e.map((function(e,t){if("Yes"===e.Submit)return a.a.createElement("div",{key:t},a.a.createElement(bt,{images:e.Annotation,enabledTools:["create-point","create-rectangle","create-polygon"],regionTagList:["tag1","tag2","tag3"],allowComments:!0,onExit:function(e){return console.log(e.images)}}))})))}}]),n}(o.Component),jt=Object(s.a)(),xt=a.a.createElement(c.a,{history:jt},a.a.createElement(l.c,null,a.a.createElement(l.a,{exact:!0,path:"/",component:function(){var e=yt(),t=Object(o.useState)({steps:null,imgUrl:null}),n=Object(u.a)(t,2),r=n[0],i=n[1],c=Object(o.useState)({intro:null}),l=Object(u.a)(c,2),s=l[0],d=l[1],g=Object(o.useState)(!1),m=Object(u.a)(g,2),p=m[0],h=m[1],b=Object(o.useState)(!1),f=Object(u.a)(b,2),y=f[0],v=f[1];return Object(o.useEffect)((function(){v(!0),fetch("./backendConfig.json").then((function(e){return e.json()})).then((function(e){console.log("start setState"),i({steps:e.setup.tutorial.steps,imgUrl:e.setup.tutorial.imgUrl}),d({intro:e.setup.introduction}),v(!1)})).catch((function(e){h(e),v(!1)}))}),[]),0!=p?a.a.createElement("div",null,"Error: ",p.message):y?a.a.createElement("div",null,"Loading..."):a.a.createElement("div",{className:e.homeContainer},a.a.createElement("div",{className:e.introTutorial},a.a.createElement(O,{title:"Show tutorial",intro:s},a.a.createElement(M,{tutorial:r}))),a.a.createElement("div",{className:e.annotateContainer},a.a.createElement(Ot,null)))}}),a.a.createElement(l.a,{exact:!0,path:"/result",component:Et})));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(453);i.a.render(a.a.createElement("div",null,xt),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[319,1,2]]]);
//# sourceMappingURL=main.bddcd07a.chunk.js.map