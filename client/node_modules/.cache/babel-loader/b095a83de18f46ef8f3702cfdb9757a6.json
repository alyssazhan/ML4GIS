{"ast":null,"code":"import { setIn, updateIn, asMutable, without } from \"seamless-immutable\";\nimport moment from \"moment\";\nvar typesToSaveWithHistory = {\n  BEGIN_BOX_TRANSFORM: \"Transform/Move Box\",\n  BEGIN_MOVE_POINT: \"Move Point\",\n  DELETE_REGION: \"Delete Region\",\n  BEGIN_CIRCLE_TRANSFORM: \"Transform/Move Circle\"\n};\nexport var saveToHistory = function saveToHistory(state, name) {\n  return updateIn(state, [\"history\"], function (h) {\n    return [{\n      time: moment().toDate(),\n      state: without(state, \"history\"),\n      name: name\n    }].concat((h || []).slice(0, 9));\n  });\n};\nexport default (function (reducer) {\n  return function (state, action) {\n    var prevState = state;\n    var nextState = reducer(state, action);\n\n    if (action.type === \"RESTORE_HISTORY\") {\n      if (state.history.length > 0) {\n        return setIn(nextState.history[0].state, [\"history\"], nextState.history.slice(1));\n      }\n    } else {\n      if (prevState !== nextState && Object.keys(typesToSaveWithHistory).includes(action.type)) {\n        return setIn(nextState, [\"history\"], [{\n          time: moment().toDate(),\n          state: without(prevState, \"history\"),\n          name: typesToSaveWithHistory[action.type] || action.type\n        }].concat(nextState.history || []).slice(0, 9));\n      }\n    }\n\n    return nextState;\n  };\n});","map":{"version":3,"sources":["C:/Users/pccis/Desktop/ML4GIS-develop/ML4GIS-develop/client/src/pages/Home/annotateComponents/reducers/historyHandler.js"],"names":["setIn","updateIn","asMutable","without","moment","typesToSaveWithHistory","BEGIN_BOX_TRANSFORM","BEGIN_MOVE_POINT","DELETE_REGION","BEGIN_CIRCLE_TRANSFORM","saveToHistory","state","name","h","time","toDate","concat","slice","reducer","action","prevState","nextState","type","history","length","Object","keys","includes"],"mappings":"AAEA,SAASA,KAAT,EAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,OAArC,QAAoD,oBAApD;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,IAAMC,sBAAsB,GAAG;AAC7BC,EAAAA,mBAAmB,EAAE,oBADQ;AAE7BC,EAAAA,gBAAgB,EAAE,YAFW;AAG7BC,EAAAA,aAAa,EAAE,eAHc;AAI7BC,EAAAA,sBAAsB,EAAE;AAJK,CAA/B;AAOA,OAAO,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,KAAD,EAAyBC,IAAzB;AAAA,SAC3BX,QAAQ,CAACU,KAAD,EAAQ,CAAC,SAAD,CAAR,EAAqB,UAACE,CAAD;AAAA,WAC3B,CACE;AACEC,MAAAA,IAAI,EAAEV,MAAM,GAAGW,MAAT,EADR;AAEEJ,MAAAA,KAAK,EAAER,OAAO,CAACQ,KAAD,EAAQ,SAAR,CAFhB;AAGEC,MAAAA,IAAI,EAAJA;AAHF,KADF,EAMEI,MANF,CAMS,CAACH,CAAC,IAAI,EAAN,EAAUI,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,CANT,CAD2B;AAAA,GAArB,CADmB;AAAA,CAAtB;AAWP,gBAAe,UAACC,OAAD,EAAa;AAC1B,SAAO,UAACP,KAAD,EAAyBQ,MAAzB,EAA4C;AACjD,QAAMC,SAAS,GAAGT,KAAlB;AACA,QAAMU,SAAS,GAAGH,OAAO,CAACP,KAAD,EAAQQ,MAAR,CAAzB;;AAEA,QAAIA,MAAM,CAACG,IAAP,KAAgB,iBAApB,EAAuC;AACrC,UAAIX,KAAK,CAACY,OAAN,CAAcC,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,eAAOxB,KAAK,CACVqB,SAAS,CAACE,OAAV,CAAkB,CAAlB,EAAqBZ,KADX,EAEV,CAAC,SAAD,CAFU,EAGVU,SAAS,CAACE,OAAV,CAAkBN,KAAlB,CAAwB,CAAxB,CAHU,CAAZ;AAKD;AACF,KARD,MAQO;AACL,UACEG,SAAS,KAAKC,SAAd,IACAI,MAAM,CAACC,IAAP,CAAYrB,sBAAZ,EAAoCsB,QAApC,CAA6CR,MAAM,CAACG,IAApD,CAFF,EAGE;AACA,eAAOtB,KAAK,CACVqB,SADU,EAEV,CAAC,SAAD,CAFU,EAGV,CACE;AACEP,UAAAA,IAAI,EAAEV,MAAM,GAAGW,MAAT,EADR;AAEEJ,UAAAA,KAAK,EAAER,OAAO,CAACiB,SAAD,EAAY,SAAZ,CAFhB;AAGER,UAAAA,IAAI,EAAEP,sBAAsB,CAACc,MAAM,CAACG,IAAR,CAAtB,IAAuCH,MAAM,CAACG;AAHtD,SADF,EAOGN,MAPH,CAOUK,SAAS,CAACE,OAAV,IAAqB,EAP/B,EAQGN,KARH,CAQS,CART,EAQY,CARZ,CAHU,CAAZ;AAaD;AACF;;AAED,WAAOI,SAAP;AACD,GAlCD;AAmCD,CApCD","sourcesContent":["\nimport type { MainLayoutState, Action } from \"../MainLayout/types\"\nimport { setIn, updateIn, asMutable, without } from \"seamless-immutable\"\nimport moment from \"moment\"\n\nconst typesToSaveWithHistory = {\n  BEGIN_BOX_TRANSFORM: \"Transform/Move Box\",\n  BEGIN_MOVE_POINT: \"Move Point\",\n  DELETE_REGION: \"Delete Region\",\n  BEGIN_CIRCLE_TRANSFORM: \"Transform/Move Circle\",\n}\n\nexport const saveToHistory = (state: MainLayoutState, name: string) =>\n  updateIn(state, [\"history\"], (h) =>\n    [\n      {\n        time: moment().toDate(),\n        state: without(state, \"history\"),\n        name,\n      },\n    ].concat((h || []).slice(0, 9))\n  )\n\nexport default (reducer) => {\n  return (state: MainLayoutState, action: Action) => {\n    const prevState = state\n    const nextState = reducer(state, action)\n\n    if (action.type === \"RESTORE_HISTORY\") {\n      if (state.history.length > 0) {\n        return setIn(\n          nextState.history[0].state,\n          [\"history\"],\n          nextState.history.slice(1)\n        )\n      }\n    } else {\n      if (\n        prevState !== nextState &&\n        Object.keys(typesToSaveWithHistory).includes(action.type)\n      ) {\n        return setIn(\n          nextState,\n          [\"history\"],\n          [\n            {\n              time: moment().toDate(),\n              state: without(prevState, \"history\"),\n              name: typesToSaveWithHistory[action.type] || action.type,\n            },\n          ]\n            .concat(nextState.history || [])\n            .slice(0, 9)\n        )\n      }\n    }\n\n    return nextState\n  }\n}\n"]},"metadata":{},"sourceType":"module"}