{"ast":null,"code":"var _jsxFileName = \"/Users/yan/Documents/proj/ML4GIS/client/src/annotateComponents/RegionSelectAndTransformBoxes/index.js\";\nimport React, { Fragment, memo } from \"react\";\nimport HighlightBox from \"../HighlightBox\";\nimport { styled } from \"@material-ui/core/styles\";\nimport PreventScrollToParents from \"../PreventScrollToParents\";\nimport { Tooltip } from \"@material-ui/core\";\nconst TransformGrabber = styled(\"div\")({\n  width: 8,\n  height: 8,\n  zIndex: 2,\n  border: \"2px solid #FFF\",\n  position: \"absolute\"\n});\nconst boxCursorMap = [[\"nw-resize\", \"n-resize\", \"ne-resize\"], [\"w-resize\", \"grab\", \"e-resize\"], [\"sw-resize\", \"s-resize\", \"se-resize\"]];\n\nconst arePropsEqual = (prev, next) => {\n  return prev.region === next.region && prev.dragWithPrimary === next.dragWithPrimary && prev.createWithPrimary === next.createWithPrimary && prev.zoomWithPrimary === next.zoomWithPrimary && prev.mat === next.mat;\n};\n\nexport const RegionSelectAndTransformBox = memo(({\n  region: r,\n  mouseEvents,\n  projectRegionBox,\n  dragWithPrimary,\n  createWithPrimary,\n  zoomWithPrimary,\n  onBeginMovePoint,\n  onSelectRegion,\n  layoutParams,\n  // fullImageSegmentationMode = false,\n  mat,\n  onBeginBoxTransform,\n  onBeginMovePolygonPoint,\n  onBeginMoveKeypoint,\n  onAddPolygonPoint,\n  showHighlightBox\n}) => {\n  const pbox = projectRegionBox(r);\n  const _layoutParams$current = layoutParams.current,\n        iw = _layoutParams$current.iw,\n        ih = _layoutParams$current.ih;\n  return /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(PreventScrollToParents, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 9\n    }\n  }, showHighlightBox && r.type !== \"polygon\" && /*#__PURE__*/React.createElement(HighlightBox, {\n    region: r,\n    mouseEvents: mouseEvents,\n    dragWithPrimary: dragWithPrimary,\n    createWithPrimary: createWithPrimary,\n    zoomWithPrimary: zoomWithPrimary,\n    onBeginMovePoint: onBeginMovePoint,\n    onSelectRegion: onSelectRegion,\n    pbox: pbox,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 13\n    }\n  }), r.type === \"rectangle\" && !dragWithPrimary && !zoomWithPrimary && !r.locked && r.highlighted && mat.a < 1.2 && [[0, 0], [0.5, 0], [1, 0], [1, 0.5], [1, 1], [0.5, 1], [0, 1], [0, 0.5], [0.5, 0.5]].map(([px, py], i) => /*#__PURE__*/React.createElement(TransformGrabber, Object.assign({\n    key: i\n  }, mouseEvents, {\n    onMouseDown: e => {\n      if (e.button === 0) return onBeginBoxTransform(r, [px * 2 - 1, py * 2 - 1]);\n      mouseEvents.onMouseDown(e);\n    },\n    style: {\n      left: pbox.x - 4 - 2 + pbox.w * px,\n      top: pbox.y - 4 - 2 + pbox.h * py,\n      cursor: boxCursorMap[py * 2][px * 2],\n      borderRadius: px === 0.5 && py === 0.5 ? 4 : undefined\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 15\n    }\n  }))), r.type === \"polygon\" && !dragWithPrimary && !zoomWithPrimary && !r.locked && r.highlighted && r.points.map(([px, py], i) => {\n    const proj = mat.clone().inverse().applyToPoint(px * iw, py * ih);\n    return /*#__PURE__*/React.createElement(TransformGrabber, Object.assign({\n      key: i\n    }, mouseEvents, {\n      onMouseDown: e => {\n        if (e.button === 0 && (!r.open || i === 0)) return onBeginMovePolygonPoint(r, i);\n        mouseEvents.onMouseDown(e);\n      },\n      style: {\n        cursor: !r.open ? \"move\" : i === 0 ? \"pointer\" : undefined,\n        zIndex: 10,\n        pointerEvents: r.open && i === r.points.length - 1 ? \"none\" : undefined,\n        left: proj.x - 4,\n        top: proj.y - 4\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 17\n      }\n    }));\n  }), r.type === \"polygon\" && r.highlighted && !dragWithPrimary && !zoomWithPrimary && !r.locked && !r.open && r.points.length > 1 && r.points.map((p1, i) => [p1, r.points[(i + 1) % r.points.length]]).map(([p1, p2]) => [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2]).map((pa, i) => {\n    const proj = mat.clone().inverse().applyToPoint(pa[0] * iw, pa[1] * ih);\n    return /*#__PURE__*/React.createElement(TransformGrabber, Object.assign({\n      key: i\n    }, mouseEvents, {\n      onMouseDown: e => {\n        if (e.button === 0) return onAddPolygonPoint(r, pa, i + 1);\n        mouseEvents.onMouseDown(e);\n      },\n      style: {\n        cursor: \"copy\",\n        zIndex: 10,\n        left: proj.x - 4,\n        top: proj.y - 4,\n        border: \"2px dotted #fff\",\n        opacity: 0.5\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 19\n      }\n    }));\n  }), r.type === \"keypoints\" && !dragWithPrimary && !zoomWithPrimary && !r.locked && r.highlighted && Object.entries(r.points).map(([keypointId, {\n    x: px,\n    y: py\n  }], i) => {\n    const proj = mat.clone().inverse().applyToPoint(px * iw, py * ih);\n    return /*#__PURE__*/React.createElement(Tooltip, {\n      title: keypointId,\n      key: i,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(TransformGrabber, Object.assign({\n      key: i\n    }, mouseEvents, {\n      onMouseDown: e => {\n        if (e.button === 0 && (!r.open || i === 0)) return onBeginMoveKeypoint(r, keypointId);\n        mouseEvents.onMouseDown(e);\n      },\n      style: {\n        cursor: !r.open ? \"move\" : i === 0 ? \"pointer\" : undefined,\n        zIndex: 10,\n        pointerEvents: r.open && i === r.points.length - 1 ? \"none\" : undefined,\n        left: proj.x - 4,\n        top: proj.y - 4\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 21\n      }\n    })));\n  })));\n}, arePropsEqual);\nexport const RegionSelectAndTransformBoxes = memo(props => {\n  return props.regions.filter(r => r.visible || r.visible === undefined).filter(r => !r.locked).map((r, i) => {\n    return /*#__PURE__*/React.createElement(RegionSelectAndTransformBox, Object.assign({\n      key: r.id\n    }, props, {\n      region: r,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 16\n      }\n    }));\n  });\n}, (n, p) => n.regions === p.regions && n.mat === p.mat);\nexport default RegionSelectAndTransformBoxes;","map":{"version":3,"sources":["/Users/yan/Documents/proj/ML4GIS/client/src/annotateComponents/RegionSelectAndTransformBoxes/index.js"],"names":["React","Fragment","memo","HighlightBox","styled","PreventScrollToParents","Tooltip","TransformGrabber","width","height","zIndex","border","position","boxCursorMap","arePropsEqual","prev","next","region","dragWithPrimary","createWithPrimary","zoomWithPrimary","mat","RegionSelectAndTransformBox","r","mouseEvents","projectRegionBox","onBeginMovePoint","onSelectRegion","layoutParams","onBeginBoxTransform","onBeginMovePolygonPoint","onBeginMoveKeypoint","onAddPolygonPoint","showHighlightBox","pbox","current","iw","ih","type","locked","highlighted","a","map","px","py","i","e","button","onMouseDown","left","x","w","top","y","h","cursor","borderRadius","undefined","points","proj","clone","inverse","applyToPoint","open","pointerEvents","length","p1","p2","pa","opacity","Object","entries","keypointId","RegionSelectAndTransformBoxes","props","regions","filter","visible","id","n","p"],"mappings":"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","sourcesContent":["import React, { Fragment, memo } from \"react\"\nimport HighlightBox from \"../HighlightBox\"\nimport { styled } from \"@material-ui/core/styles\"\nimport PreventScrollToParents from \"../PreventScrollToParents\"\nimport { Tooltip } from \"@material-ui/core\"\n\nconst TransformGrabber = styled(\"div\")({\n  width: 8,\n  height: 8,\n  zIndex: 2,\n  border: \"2px solid #FFF\",\n  position: \"absolute\",\n})\n\nconst boxCursorMap = [\n  [\"nw-resize\", \"n-resize\", \"ne-resize\"],\n  [\"w-resize\", \"grab\", \"e-resize\"],\n  [\"sw-resize\", \"s-resize\", \"se-resize\"],\n]\n\nconst arePropsEqual = (prev, next) => {\n  return (\n    prev.region === next.region &&\n    prev.dragWithPrimary === next.dragWithPrimary &&\n    prev.createWithPrimary === next.createWithPrimary &&\n    prev.zoomWithPrimary === next.zoomWithPrimary &&\n    prev.mat === next.mat\n  )\n}\n\nexport const RegionSelectAndTransformBox = memo(\n  ({\n    region: r,\n    mouseEvents,\n    projectRegionBox,\n    dragWithPrimary,\n    createWithPrimary,\n    zoomWithPrimary,\n    onBeginMovePoint,\n    onSelectRegion,\n    layoutParams,\n    // fullImageSegmentationMode = false,\n    mat,\n    onBeginBoxTransform,\n    onBeginMovePolygonPoint,\n    onBeginMoveKeypoint,\n    onAddPolygonPoint,\n    showHighlightBox,\n  }) => {\n    const pbox = projectRegionBox(r)\n    const { iw, ih } = layoutParams.current\n    return (\n      <Fragment>\n        <PreventScrollToParents>\n          {showHighlightBox && r.type !== \"polygon\" && (\n            <HighlightBox\n              region={r}\n              mouseEvents={mouseEvents}\n              dragWithPrimary={dragWithPrimary}\n              createWithPrimary={createWithPrimary}\n              zoomWithPrimary={zoomWithPrimary}\n              onBeginMovePoint={onBeginMovePoint}\n              onSelectRegion={onSelectRegion}\n              pbox={pbox}\n            />\n          )}\n          {r.type === \"rectangle\" &&\n            !dragWithPrimary &&\n            !zoomWithPrimary &&\n            !r.locked &&\n            r.highlighted &&\n            mat.a < 1.2 &&\n            [\n              [0, 0],\n              [0.5, 0],\n              [1, 0],\n              [1, 0.5],\n              [1, 1],\n              [0.5, 1],\n              [0, 1],\n              [0, 0.5],\n              [0.5, 0.5],\n            ].map(([px, py], i) => (\n              <TransformGrabber\n                key={i}\n                {...mouseEvents}\n                onMouseDown={(e) => {\n                  if (e.button === 0)\n                    return onBeginBoxTransform(r, [px * 2 - 1, py * 2 - 1])\n                  mouseEvents.onMouseDown(e)\n                }}\n                style={{\n                  left: pbox.x - 4 - 2 + pbox.w * px,\n                  top: pbox.y - 4 - 2 + pbox.h * py,\n                  cursor: boxCursorMap[py * 2][px * 2],\n                  borderRadius: px === 0.5 && py === 0.5 ? 4 : undefined,\n                }}\n              />\n            ))}\n          {r.type === \"polygon\" &&\n            !dragWithPrimary &&\n            !zoomWithPrimary &&\n            !r.locked &&\n            r.highlighted &&\n            r.points.map(([px, py], i) => {\n              const proj = mat\n                .clone()\n                .inverse()\n                .applyToPoint(px * iw, py * ih)\n              return (\n                <TransformGrabber\n                  key={i}\n                  {...mouseEvents}\n                  onMouseDown={(e) => {\n                    if (e.button === 0 && (!r.open || i === 0))\n                      return onBeginMovePolygonPoint(r, i)\n                    mouseEvents.onMouseDown(e)\n                  }}\n                  style={{\n                    cursor: !r.open ? \"move\" : i === 0 ? \"pointer\" : undefined,\n                    zIndex: 10,\n                    pointerEvents:\n                      r.open && i === r.points.length - 1 ? \"none\" : undefined,\n                    left: proj.x - 4,\n                    top: proj.y - 4,\n                  }}\n                />\n              )\n            })}\n          {r.type === \"polygon\" &&\n            r.highlighted &&\n            !dragWithPrimary &&\n            !zoomWithPrimary &&\n            !r.locked &&\n            !r.open &&\n            r.points.length > 1 &&\n            r.points\n              .map((p1, i) => [p1, r.points[(i + 1) % r.points.length]])\n              .map(([p1, p2]) => [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2])\n              .map((pa, i) => {\n                const proj = mat\n                  .clone()\n                  .inverse()\n                  .applyToPoint(pa[0] * iw, pa[1] * ih)\n                return (\n                  <TransformGrabber\n                    key={i}\n                    {...mouseEvents}\n                    onMouseDown={(e) => {\n                      if (e.button === 0) return onAddPolygonPoint(r, pa, i + 1)\n                      mouseEvents.onMouseDown(e)\n                    }}\n                    style={{\n                      cursor: \"copy\",\n                      zIndex: 10,\n                      left: proj.x - 4,\n                      top: proj.y - 4,\n                      border: \"2px dotted #fff\",\n                      opacity: 0.5,\n                    }}\n                  />\n                )\n              })}\n          {r.type === \"keypoints\" &&\n            !dragWithPrimary &&\n            !zoomWithPrimary &&\n            !r.locked &&\n            r.highlighted &&\n            Object.entries(r.points).map(\n              ([keypointId, { x: px, y: py }], i) => {\n                const proj = mat\n                  .clone()\n                  .inverse()\n                  .applyToPoint(px * iw, py * ih)\n                return (\n                  <Tooltip title={keypointId} key={i}>\n                    <TransformGrabber\n                      key={i}\n                      {...mouseEvents}\n                      onMouseDown={(e) => {\n                        if (e.button === 0 && (!r.open || i === 0))\n                          return onBeginMoveKeypoint(r, keypointId)\n                        mouseEvents.onMouseDown(e)\n                      }}\n                      style={{\n                        cursor: !r.open\n                          ? \"move\"\n                          : i === 0\n                          ? \"pointer\"\n                          : undefined,\n                        zIndex: 10,\n                        pointerEvents:\n                          r.open && i === r.points.length - 1\n                            ? \"none\"\n                            : undefined,\n                        left: proj.x - 4,\n                        top: proj.y - 4,\n                      }}\n                    />\n                  </Tooltip>\n                )\n              }\n            )}\n        </PreventScrollToParents>\n      </Fragment>\n    )\n  },\n  arePropsEqual\n)\n\nexport const RegionSelectAndTransformBoxes = memo(\n  (props) => {\n    return props.regions\n      .filter((r) => r.visible || r.visible === undefined)\n      .filter((r) => !r.locked)\n      .map((r, i) => {\n        return <RegionSelectAndTransformBox key={r.id} {...props} region={r} />\n      })\n  },\n  (n, p) => n.regions === p.regions && n.mat === p.mat\n)\n\nexport default RegionSelectAndTransformBoxes\n"]},"metadata":{},"sourceType":"module"}