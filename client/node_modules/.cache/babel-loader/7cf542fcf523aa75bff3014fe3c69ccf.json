{"ast":null,"code":"import _objectSpread from\"D:\\\\GitHub\\\\ML4GIS\\\\client\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:\\\\GitHub\\\\ML4GIS\\\\client\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useReducer,useEffect}from\"react\";import MainLayout from\"./MainLayout/main_MainLayout\";import combineReducers from\"./reducers/combineReducers.js\";import generalReducer from\"./reducers/generalReducer.js\";import imageReducer from\"./reducers/imageReducer.js\";import historyHandler from\"./reducers/historyHandler.js\";import useEventCallback from\"use-event-callback\";import makeImmutable,{without}from\"seamless-immutable\";export var Annotator=function Annotator(_ref){var images=_ref.images,_ref$selectedImage=_ref.selectedImage,selectedImage=_ref$selectedImage===void 0?images&&images.length>0?0:undefined:_ref$selectedImage,_ref$enabledTools=_ref.enabledTools,enabledTools=_ref$enabledTools===void 0?[\"select\",\"create-point\",\"create-rectangle\",\"create-polygon\",\"create-polygon1\",\"create-circle\"]:_ref$enabledTools,_ref$selectedTool=_ref.selectedTool,selectedTool=_ref$selectedTool===void 0?\"select\":_ref$selectedTool,_ref$regionTagList=_ref.regionTagList,regionTagList=_ref$regionTagList===void 0?[]:_ref$regionTagList,onExit=_ref.onExit,onNextImage=_ref.onNextImage,onPrevImage=_ref.onPrevImage,allowComments=_ref.allowComments;if(typeof selectedImage===\"string\"){selectedImage=(images||[]).findIndex(function(img){return img.src===selectedImage;});if(selectedImage===-1)selectedImage=undefined;}var annotationType=\"image\";var _useReducer=useReducer(historyHandler(combineReducers(imageReducer,generalReducer)),makeImmutable(_objectSpread({annotationType:annotationType,selectedTool:selectedTool,mode:null,regionTagList:regionTagList,enabledTools:enabledTools,history:[],allowComments:allowComments},{selectedImage:selectedImage,images:images}))),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatchToReducer=_useReducer2[1];var dispatchAction=useEventCallback(function(action){if(action.type===\"HEADER_BUTTON_CLICKED\"){if([\"Exit\",\"Done\",\"Save\",\"Complete\"].includes(action.buttonName)){return onExit(without(state,\"history\"));}else if(action.buttonName===\"Next\"&&onNextImage){return onNextImage(without(state,\"history\"));}else if(action.buttonName===\"Prev\"&&onPrevImage){return onPrevImage(without(state,\"history\"));}}dispatchToReducer(action);});var onRegionClassAdded=useEventCallback(function(cls){dispatchToReducer({type:\"ON_CLS_ADDED\",cls:cls});});useEffect(function(){if(selectedImage===undefined)return;dispatchToReducer({type:\"SELECT_IMAGE\",imageIndex:selectedImage,image:state.images[selectedImage]});},[selectedImage]);if(!images)return'Missing required prop \"images\" ';return/*#__PURE__*/React.createElement(MainLayout,{alwaysShowNextButton:Boolean(onNextImage),alwaysShowPrevButton:Boolean(onPrevImage),state:state,dispatchAction:dispatchAction,onRegionClassAdded:onRegionClassAdded});};export default Annotator;","map":{"version":3,"sources":["D:/GitHub/ML4GIS/client/src/pages/Home/annotateComponents/main_Annotate.js"],"names":["React","useReducer","useEffect","MainLayout","combineReducers","generalReducer","imageReducer","historyHandler","useEventCallback","makeImmutable","without","Annotator","images","selectedImage","length","undefined","enabledTools","selectedTool","regionTagList","onExit","onNextImage","onPrevImage","allowComments","findIndex","img","src","annotationType","mode","history","state","dispatchToReducer","dispatchAction","action","type","includes","buttonName","onRegionClassAdded","cls","imageIndex","image","Boolean"],"mappings":"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","sourcesContent":["\r\nimport React, { useReducer, useEffect } from \"react\"\r\nimport MainLayout from \"./MainLayout/main_MainLayout\"\r\nimport type {\r\n  Image,\r\n  MainLayoutState,\r\n  Action,\r\n} from \"./MainLayout/types\"\r\n\r\nimport combineReducers from \"./reducers/combineReducers.js\"\r\nimport generalReducer from \"./reducers/generalReducer.js\"\r\nimport imageReducer from \"./reducers/imageReducer.js\"\r\nimport historyHandler from \"./reducers/historyHandler.js\"\r\nimport useEventCallback from \"use-event-callback\"\r\nimport makeImmutable, { without } from \"seamless-immutable\"\r\n\r\ntype Props = {\r\n  regionTagList?: Array<string>,\r\n  enabledTools?: Array<string>,\r\n  selectedTool?: String,\r\n  selectedImage?: string | number,\r\n  images?: Array<Image>,\r\n  onExit: (MainLayoutState) => any,\r\n}\r\n\r\nexport const Annotator = ({\r\n  images,\r\n  selectedImage = images && images.length > 0 ? 0 : undefined,\r\n  enabledTools = [\r\n    \"select\",\r\n    \"create-point\",\r\n    \"create-rectangle\",\r\n    \"create-polygon\",\r\n    \"create-polygon1\",\r\n    \"create-circle\"\r\n  ],\r\n  selectedTool = \"select\",\r\n  regionTagList = [],\r\n  onExit,\r\n  onNextImage,\r\n  onPrevImage,\r\n  allowComments,\r\n}: Props) => {\r\n  if (typeof selectedImage === \"string\") {\r\n    selectedImage = (images || []).findIndex((img) => img.src === selectedImage)\r\n    if (selectedImage === -1) selectedImage = undefined\r\n  }\r\n  const annotationType = \"image\"\r\n  const [state, dispatchToReducer] = useReducer(\r\n    historyHandler(\r\n      combineReducers(\r\n        imageReducer ,\r\n        generalReducer\r\n      )\r\n    ),\r\n    makeImmutable({\r\n      annotationType,\r\n      selectedTool,\r\n      mode: null,\r\n      regionTagList,\r\n      enabledTools,\r\n      history: [],\r\n      allowComments,\r\n      ...({\r\n            selectedImage,\r\n            images,\r\n          }),\r\n    })\r\n  )\r\n\r\n  const dispatchAction = useEventCallback((action: Action) => {\r\n    if (action.type === \"HEADER_BUTTON_CLICKED\") {\r\n      if ([\"Exit\", \"Done\", \"Save\", \"Complete\"].includes(action.buttonName)) {\r\n        return onExit(without(state, \"history\"))\r\n      } else if (action.buttonName === \"Next\" && onNextImage) {\r\n        return onNextImage(without(state, \"history\"))\r\n      } else if (action.buttonName === \"Prev\" && onPrevImage) {\r\n        return onPrevImage(without(state, \"history\"))\r\n      }\r\n    }\r\n    dispatchToReducer(action)\r\n  })\r\n\r\n  const onRegionClassAdded = useEventCallback((cls) => {\r\n    dispatchToReducer({\r\n      type: \"ON_CLS_ADDED\",\r\n      cls: cls,\r\n    })\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (selectedImage === undefined) return\r\n    dispatchToReducer({\r\n      type: \"SELECT_IMAGE\",\r\n      imageIndex: selectedImage,\r\n      image: state.images[selectedImage],\r\n    })\r\n  }, [selectedImage])\r\n\r\n  if (!images )\r\n    return 'Missing required prop \"images\" '\r\n\r\n  return (\r\n\r\n      <MainLayout\r\n        alwaysShowNextButton={Boolean(onNextImage)}\r\n        alwaysShowPrevButton={Boolean(onPrevImage)}\r\n        state={state}\r\n        dispatchAction={dispatchAction}\r\n        onRegionClassAdded={onRegionClassAdded}\r\n      />\r\n\r\n  )\r\n}\r\nexport default Annotator\r\n"]},"metadata":{},"sourceType":"module"}