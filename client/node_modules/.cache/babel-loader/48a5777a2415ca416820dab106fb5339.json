{"ast":null,"code":"import _objectSpread from \"D:\\\\GitHub\\\\ML4GIS\\\\client\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"D:\\\\GitHub\\\\ML4GIS\\\\client\\\\node_modules\\\\react-scripts\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"D:\\\\GitHub\\\\ML4GIS\\\\client\\\\src\\\\pages\\\\Home\\\\annotateComponents\\\\ImageCanvas\\\\main_ImageCanvas.js\";\nimport React, { useRef, useState, useLayoutEffect, useEffect, useMemo } from \"react\";\nimport { Matrix } from \"transformation-matrix-js\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport styles from \"./styles_ImageCanvas\";\nimport useMouse from \"./useMouse\";\nimport useProjectRegionBox from \"./useProjectBox\";\nimport { useRafState } from \"react-use\";\nimport RegionTags from \"../RegionTags/main_RegionTags\";\nimport RegionSelectAndTransformBoxes from \"../TransformBoxes/main_TransformBoxes\";\nimport ImageCanvasBackground from \"./background\";\nimport useEventCallback from \"use-event-callback\";\nimport RegionShapes from \"../RegionShapes/main_RegionShapes\"; // get style from style.js\n\nconst myStyle = makeStyles(styles);\n\nconst getCanvasDimension = (allowedArea = null, {\n  iw,\n  ih\n} = {}) => {\n  let dimension = Matrix.from(1, 0, 0, 1, -10, -10);\n\n  if (allowedArea && iw) {\n    dimension = dimension.translate(allowedArea.x * iw, allowedArea.y * ih).scaleU(allowedArea.w + 0.05);\n  }\n\n  return dimension;\n};\n\nexport const ImageCanvas = ({\n  regions,\n  imageSrc,\n  onMouseMove = p => null,\n  onMouseDown = p => null,\n  onMouseUp = p => null,\n  dragWithPrimary = false,\n  zoomWithPrimary = false,\n  createWithPrimary = false,\n  regionTagList,\n  allowedArea,\n  onLoaded,\n  onChangeRegion,\n  onBeginRegionEdit,\n  onCloseRegionEdit,\n  onBeginBoxTransform,\n  onBeginMovePolygonPoint,\n  onAddPolygonPoint,\n  onBeginMovePolygon1Point,\n  onAddPolygon1Point,\n  onBeginMoveKeypoint,\n  onSelectRegion,\n  onBeginMovePoint,\n  onDeleteRegion,\n  onRegionClassAdded,\n  zoomOnAllowedArea = true,\n  allowComments,\n  nBeginCircleTransform\n}) => {\n  const classes = myStyle();\n  const canvasEl = useRef(null);\n  const layoutParams = useRef({});\n\n  const _useRafState = useRafState(false),\n        _useRafState2 = _slicedToArray(_useRafState, 2),\n        dragging = _useRafState2[0],\n        changeDragging = _useRafState2[1];\n\n  const _useRafState3 = useRafState(null),\n        _useRafState4 = _slicedToArray(_useRafState3, 2),\n        zoomStart = _useRafState4[0],\n        changeZoomStart = _useRafState4[1];\n\n  const _useRafState5 = useRafState(null),\n        _useRafState6 = _slicedToArray(_useRafState5, 2),\n        zoomEnd = _useRafState6[0],\n        changeZoomEnd = _useRafState6[1];\n\n  const _useRafState7 = useRafState(getCanvasDimension()),\n        _useRafState8 = _slicedToArray(_useRafState7, 2),\n        mat = _useRafState8[0],\n        changeMat = _useRafState8[1];\n\n  const _useMouse = useMouse({\n    canvasEl,\n    dragging,\n    mat,\n    layoutParams,\n    changeMat,\n    zoomStart,\n    zoomEnd,\n    changeZoomStart,\n    changeZoomEnd,\n    changeDragging,\n    zoomWithPrimary,\n    dragWithPrimary,\n    onMouseMove,\n    onMouseDown,\n    onMouseUp\n  }),\n        mouseEvents = _useMouse.mouseEvents,\n        mousePosition = _useMouse.mousePosition;\n\n  const projectRegionBox = useProjectRegionBox({\n    layoutParams,\n    mat\n  });\n\n  const _useState = useState(),\n        _useState2 = _slicedToArray(_useState, 2),\n        imageDimensions = _useState2[0],\n        changeImageDimensions = _useState2[1];\n\n  const imageLoaded = Boolean(imageDimensions && imageDimensions.naturalWidth);\n  const ImageLoaded = useEventCallback(({\n    naturalWidth,\n    naturalHeight\n  }) => {\n    const dims = {\n      naturalWidth,\n      naturalHeight\n    };\n    if (onLoaded) onLoaded(dims);\n    changeImageDimensions(dims);\n  });\n  const canvas = canvasEl.current;\n\n  if (canvas && imageLoaded) {\n    const clientWidth = canvas.clientWidth,\n          clientHeight = canvas.clientHeight;\n    const fitScale = Math.max(imageDimensions.naturalWidth / (clientWidth - 20), imageDimensions.naturalHeight / (clientHeight - 20));\n    const iw = imageDimensions.naturalWidth / fitScale,\n          ih = imageDimensions.naturalHeight / fitScale;\n    layoutParams.current = {\n      iw,\n      ih,\n      fitScale,\n      canvasWidth: clientWidth,\n      canvasHeight: clientHeight\n    };\n  }\n\n  useEffect(() => {\n    if (!imageLoaded) return;\n    changeMat(getCanvasDimension(zoomOnAllowedArea ? allowedArea : null, layoutParams.current));\n  }, [imageLoaded]);\n  useLayoutEffect(() => {\n    if (!imageDimensions) return;\n    const clientWidth = canvas.clientWidth,\n          clientHeight = canvas.clientHeight;\n    canvas.width = clientWidth;\n    canvas.height = clientHeight;\n    const context = canvas.getContext(\"2d\");\n    context.save();\n    context.transform(...mat.clone().inverse().toArray());\n    const _layoutParams$current = layoutParams.current,\n          iw = _layoutParams$current.iw,\n          ih = _layoutParams$current.ih;\n\n    if (allowedArea) {\n      // Pattern to indicate the NOT allowed areas\n      const x = allowedArea.x,\n            y = allowedArea.y,\n            w = allowedArea.w,\n            h = allowedArea.h;\n      context.save();\n      context.globalAlpha = 1;\n      const outer = [[0, 0], [iw, 0], [iw, ih], [0, ih]];\n      const inner = [[x * iw, y * ih], [x * iw + w * iw, y * ih], [x * iw + w * iw, y * ih + h * ih], [x * iw, y * ih + h * ih]];\n      context.moveTo(...outer[0]);\n      outer.forEach(p => context.lineTo(...p));\n      context.lineTo(...outer[0]);\n      context.closePath();\n      inner.reverse();\n      context.moveTo(...inner[0]);\n      inner.forEach(p => context.lineTo(...p));\n      context.lineTo(...inner[0]);\n      context.fill();\n      context.restore();\n    }\n\n    context.restore();\n  });\n  const _layoutParams$current2 = layoutParams.current,\n        iw = _layoutParams$current2.iw,\n        ih = _layoutParams$current2.ih;\n  let zoomBox = !zoomStart || !zoomEnd ? null : _objectSpread(_objectSpread({}, mat.clone().inverse().applyToPoint(zoomStart.x, zoomStart.y)), {}, {\n    w: (zoomEnd.x - zoomStart.x) / mat.a,\n    h: (zoomEnd.y - zoomStart.y) / mat.d\n  });\n\n  if (zoomBox) {\n    if (zoomBox.w < 0) {\n      zoomBox.x += zoomBox.w;\n      zoomBox.w *= -1;\n    }\n\n    if (zoomBox.h < 0) {\n      zoomBox.y += zoomBox.h;\n      zoomBox.h *= -1;\n    }\n  }\n\n  const imagePosition = {\n    topLeft: mat.clone().inverse().applyToPoint(0, 0),\n    bottomRight: mat.clone().inverse().applyToPoint(iw, ih)\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: \"100%\",\n      height: \"100%\",\n      maxHeight: \"calc(100vh - 68px)\",\n      position: \"relative\",\n      overflow: \"hidden\",\n      cursor: createWithPrimary ? \"crosshair\" : dragging ? \"grabbing\" : dragWithPrimary ? \"grab\" : zoomWithPrimary ? mat.a < 1 ? \"zoom-out\" : \"zoom-in\" : undefined\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 5\n    }\n  }, imageLoaded && !dragging && /*#__PURE__*/React.createElement(RegionSelectAndTransformBoxes, {\n    key: \"regionSelectAndTransformBoxes\",\n    regions: !allowedArea ? regions : [{\n      type: \"rectangle\",\n      id: \"$$allowed_area\",\n      cls: \"allowed_area\",\n      highlighted: true,\n      x: allowedArea.x,\n      y: allowedArea.y,\n      w: allowedArea.w,\n      h: allowedArea.h,\n      visible: true,\n      color: \"#ff0\"\n    }],\n    mouseEvents: mouseEvents,\n    projectRegionBox: projectRegionBox,\n    dragWithPrimary: dragWithPrimary,\n    createWithPrimary: createWithPrimary,\n    zoomWithPrimary: zoomWithPrimary,\n    onBeginMovePoint: onBeginMovePoint,\n    onSelectRegion: onSelectRegion,\n    layoutParams: layoutParams,\n    mat: mat,\n    onBeginBoxTransform: onBeginBoxTransform,\n    onBeginMovePolygonPoint: onBeginMovePolygonPoint,\n    onBeginMoveKeypoint: onBeginMoveKeypoint,\n    onAddPolygonPoint: onAddPolygonPoint,\n    onAddPolygon1Point: onAddPolygon1Point,\n    onBeginMovePolygon1Point: onBeginMovePolygon1Point,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 9\n    }\n  }), imageLoaded && !dragging && /*#__PURE__*/React.createElement(\"div\", {\n    key: \"regionTags\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(RegionTags, {\n    regions: regions,\n    projectRegionBox: projectRegionBox,\n    mouseEvents: mouseEvents,\n    regionTagList: regionTagList,\n    onBeginRegionEdit: onBeginRegionEdit,\n    onChangeRegion: onChangeRegion,\n    onCloseRegionEdit: onCloseRegionEdit,\n    onDeleteRegion: onDeleteRegion,\n    layoutParams: layoutParams,\n    imageSrc: imageSrc,\n    onRegionClassAdded: onRegionClassAdded,\n    allowComments: allowComments,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 11\n    }\n  })), zoomWithPrimary && zoomBox !== null && /*#__PURE__*/React.createElement(\"div\", {\n    key: \"zoomBox\",\n    style: {\n      position: \"absolute\",\n      zIndex: 1,\n      border: \"1px solid #fff\",\n      pointerEvents: \"none\",\n      left: zoomBox.x,\n      top: zoomBox.y,\n      width: zoomBox.w,\n      height: zoomBox.h\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", Object.assign({\n    style: {\n      width: \"100%\",\n      height: \"100%\"\n    }\n  }, mouseEvents, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"canvas\", {\n    style: {\n      opacity: 0.25\n    },\n    className: classes.canvas,\n    ref: canvasEl,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(RegionShapes, {\n    imagePosition: imagePosition,\n    regions: regions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(ImageCanvasBackground, {\n    imagePosition: imagePosition,\n    mouseEvents: mouseEvents,\n    onLoad: ImageLoaded,\n    imageSrc: imageSrc,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.zoomIndicator,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 7\n    }\n  }, (1 / mat.a * 100).toFixed(0), \"%\"));\n};\nexport default ImageCanvas;","map":{"version":3,"sources":["D:/GitHub/ML4GIS/client/src/pages/Home/annotateComponents/ImageCanvas/main_ImageCanvas.js"],"names":["React","useRef","useState","useLayoutEffect","useEffect","useMemo","Matrix","makeStyles","styles","useMouse","useProjectRegionBox","useRafState","RegionTags","RegionSelectAndTransformBoxes","ImageCanvasBackground","useEventCallback","RegionShapes","myStyle","getCanvasDimension","allowedArea","iw","ih","dimension","from","translate","x","y","scaleU","w","ImageCanvas","regions","imageSrc","onMouseMove","p","onMouseDown","onMouseUp","dragWithPrimary","zoomWithPrimary","createWithPrimary","regionTagList","onLoaded","onChangeRegion","onBeginRegionEdit","onCloseRegionEdit","onBeginBoxTransform","onBeginMovePolygonPoint","onAddPolygonPoint","onBeginMovePolygon1Point","onAddPolygon1Point","onBeginMoveKeypoint","onSelectRegion","onBeginMovePoint","onDeleteRegion","onRegionClassAdded","zoomOnAllowedArea","allowComments","nBeginCircleTransform","classes","canvasEl","layoutParams","dragging","changeDragging","zoomStart","changeZoomStart","zoomEnd","changeZoomEnd","mat","changeMat","mouseEvents","mousePosition","projectRegionBox","imageDimensions","changeImageDimensions","imageLoaded","Boolean","naturalWidth","ImageLoaded","naturalHeight","dims","canvas","current","clientWidth","clientHeight","fitScale","Math","max","canvasWidth","canvasHeight","width","height","context","getContext","save","transform","clone","inverse","toArray","h","globalAlpha","outer","inner","moveTo","forEach","lineTo","closePath","reverse","fill","restore","zoomBox","applyToPoint","a","d","imagePosition","topLeft","bottomRight","maxHeight","position","overflow","cursor","undefined","type","id","cls","highlighted","visible","color","zIndex","border","pointerEvents","left","top","opacity","zoomIndicator","toFixed"],"mappings":"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","sourcesContent":["import React, {\r\n  useRef,\r\n  useState,\r\n  useLayoutEffect,\r\n  useEffect,\r\n  useMemo,\r\n} from \"react\"\r\nimport { Matrix } from \"transformation-matrix-js\"\r\nimport type {\r\n  Region,\r\n  Point,\r\n  Polygon,\r\n  Polygon1,\r\n  Rectangle,\r\n  Circle\r\n} from \"./regionTools.js\"\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport styles from \"./styles_ImageCanvas\"\r\nimport useMouse from \"./useMouse\"\r\nimport useProjectRegionBox from \"./useProjectBox\"\r\nimport { useRafState } from \"react-use\"\r\nimport RegionTags from \"../RegionTags/main_RegionTags\"\r\nimport RegionSelectAndTransformBoxes from \"../TransformBoxes/main_TransformBoxes\"\r\nimport ImageCanvasBackground from \"./background\"\r\nimport useEventCallback from \"use-event-callback\"\r\nimport RegionShapes from \"../RegionShapes/main_RegionShapes\"\r\n\r\n// get style from style.js\r\nconst myStyle = makeStyles(styles)\r\n\r\ntype Props = {\r\n  regions: Array<Region>,\r\n  imageSrc?: string,\r\n  onMouseMove?: ({ x: number, y: number }) => any,\r\n  onMouseDown?: ({ x: number, y: number }) => any,\r\n  onMouseUp?: ({ x: number, y: number }) => any,\r\n  dragWithPrimary?: boolean,\r\n  zoomWithPrimary?: boolean,\r\n  createWithPrimary?: boolean,\r\n  realSize?: { width: number, height: number, unitName: string },\r\n  regionTagList?: Array<string>,\r\n  allowedArea?: { x: number, y: number, w: number, h: number },\r\n  allowComments?: Boolean,\r\n  onChangeRegion: (Region) => any,\r\n  onBeginRegionEdit: (Region) => any,\r\n  onCloseRegionEdit: (Region) => any,\r\n  onDeleteRegion: (Region) => any,\r\n  onBeginBoxTransform: (Rectangle, [number, number]) => any,\r\n  onBeginMovePolygonPoint: (Polygon, index: number) => any,\r\n  onAddPolygonPoint: (Polygon, point: [number, number], index: number) => any,\r\n  onBeginMovePolygon1Point: (Polygon1, index1: number) => any,\r\n  onAddPolygon1Point: (Polygon1, Polygon1Index:number, point1: [number, number], index1: number) => any,\r\n  onBeginCircleTransform: (Circle, directions: string) => any,\r\n  onSelectRegion: (Region) => any,\r\n  onBeginMovePoint: (Point) => any,\r\n  onLoaded: ({\r\n    naturalWidth: number,\r\n    naturalHeight: number,\r\n  }) => any,\r\n  onRegionClassAdded: () => {},\r\n}\r\nconst getCanvasDimension = (allowedArea = null, { iw, ih } = {}) => {\r\n  let dimension = Matrix.from(1, 0, 0, 1, -10, -10)\r\n  if (allowedArea && iw) {\r\n    dimension = dimension\r\n      .translate(allowedArea.x * iw, allowedArea.y * ih)\r\n      .scaleU(allowedArea.w + 0.05)\r\n  }\r\n  return dimension\r\n}\r\n\r\nexport const ImageCanvas = ({\r\n  regions,\r\n  imageSrc,\r\n  onMouseMove = (p) => null,\r\n  onMouseDown = (p) => null,\r\n  onMouseUp = (p) => null,\r\n  dragWithPrimary = false,\r\n  zoomWithPrimary = false,\r\n  createWithPrimary = false,\r\n  regionTagList,\r\n  allowedArea,\r\n  onLoaded,\r\n  onChangeRegion,\r\n  onBeginRegionEdit,\r\n  onCloseRegionEdit,\r\n  onBeginBoxTransform,\r\n  onBeginMovePolygonPoint,\r\n  onAddPolygonPoint,\r\n  onBeginMovePolygon1Point,\r\n  onAddPolygon1Point,\r\n  onBeginMoveKeypoint,\r\n  onSelectRegion,\r\n  onBeginMovePoint,\r\n  onDeleteRegion,\r\n  onRegionClassAdded,\r\n  zoomOnAllowedArea = true,\r\n  allowComments,\r\nnBeginCircleTransform,\r\n}: Props) => {\r\n  const classes = myStyle()\r\n\r\n  const canvasEl = useRef(null)\r\n  const layoutParams = useRef({})\r\n  const [dragging, changeDragging] = useRafState(false)\r\n  const [zoomStart, changeZoomStart] = useRafState(null)\r\n  const [zoomEnd, changeZoomEnd] = useRafState(null)\r\n  const [mat, changeMat] = useRafState(getCanvasDimension())\r\n\r\n  const { mouseEvents, mousePosition } = useMouse({\r\n    canvasEl,\r\n    dragging,\r\n    mat,\r\n    layoutParams,\r\n    changeMat,\r\n    zoomStart,\r\n    zoomEnd,\r\n    changeZoomStart,\r\n    changeZoomEnd,\r\n    changeDragging,\r\n    zoomWithPrimary,\r\n    dragWithPrimary,\r\n    onMouseMove,\r\n    onMouseDown,\r\n    onMouseUp,\r\n  })\r\n\r\n\r\n\r\n  const projectRegionBox = useProjectRegionBox({ layoutParams, mat })\r\n\r\n  const [imageDimensions, changeImageDimensions] = useState()\r\n  const imageLoaded = Boolean(imageDimensions && imageDimensions.naturalWidth)\r\n\r\n  const ImageLoaded = useEventCallback(\r\n    ({ naturalWidth, naturalHeight}) => {\r\n      const dims = { naturalWidth, naturalHeight}\r\n      if (onLoaded) onLoaded(dims)\r\n      changeImageDimensions(dims)\r\n\r\n    }\r\n  )\r\n  const canvas = canvasEl.current\r\n  if (canvas && imageLoaded) {\r\n    const { clientWidth, clientHeight } = canvas\r\n\r\n    const fitScale = Math.max(\r\n      imageDimensions.naturalWidth / (clientWidth - 20),\r\n      imageDimensions.naturalHeight / (clientHeight - 20)\r\n    )\r\n\r\n    const [iw, ih] = [\r\n      imageDimensions.naturalWidth / fitScale,\r\n      imageDimensions.naturalHeight / fitScale,\r\n    ]\r\n\r\n    layoutParams.current = {\r\n      iw,\r\n      ih,\r\n      fitScale,\r\n      canvasWidth: clientWidth,\r\n      canvasHeight: clientHeight,\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!imageLoaded) return\r\n    changeMat(\r\n        getCanvasDimension(\r\n        zoomOnAllowedArea ? allowedArea : null,\r\n        layoutParams.current\r\n      )\r\n    )\r\n  }, [imageLoaded])\r\n\r\n  useLayoutEffect(() => {\r\n    if (!imageDimensions) return\r\n    const { clientWidth, clientHeight } = canvas\r\n    canvas.width = clientWidth\r\n    canvas.height = clientHeight\r\n    const context = canvas.getContext(\"2d\")\r\n\r\n    context.save()\r\n    context.transform(...mat.clone().inverse().toArray())\r\n\r\n    const { iw, ih } = layoutParams.current\r\n\r\n    if (allowedArea) {\r\n      // Pattern to indicate the NOT allowed areas\r\n      const { x, y, w, h } = allowedArea\r\n      context.save()\r\n      context.globalAlpha = 1\r\n      const outer = [\r\n        [0, 0],\r\n        [iw, 0],\r\n        [iw, ih],\r\n        [0, ih],\r\n      ]\r\n      const inner = [\r\n        [x * iw, y * ih],\r\n        [x * iw + w * iw, y * ih],\r\n        [x * iw + w * iw, y * ih + h * ih],\r\n        [x * iw, y * ih + h * ih],\r\n      ]\r\n      context.moveTo(...outer[0])\r\n      outer.forEach((p) => context.lineTo(...p))\r\n      context.lineTo(...outer[0])\r\n      context.closePath()\r\n\r\n      inner.reverse()\r\n      context.moveTo(...inner[0])\r\n      inner.forEach((p) => context.lineTo(...p))\r\n      context.lineTo(...inner[0])\r\n\r\n      context.fill()\r\n\r\n      context.restore()\r\n    }\r\n\r\n    context.restore()\r\n  })\r\n\r\n  const { iw, ih } = layoutParams.current\r\n\r\n  let zoomBox =\r\n    !zoomStart || !zoomEnd\r\n      ? null\r\n      : {\r\n          ...mat.clone().inverse().applyToPoint(zoomStart.x, zoomStart.y),\r\n          w: (zoomEnd.x - zoomStart.x) / mat.a,\r\n          h: (zoomEnd.y - zoomStart.y) / mat.d,\r\n        }\r\n  if (zoomBox) {\r\n    if (zoomBox.w < 0) {\r\n      zoomBox.x += zoomBox.w\r\n      zoomBox.w *= -1\r\n    }\r\n    if (zoomBox.h < 0) {\r\n      zoomBox.y += zoomBox.h\r\n      zoomBox.h *= -1\r\n    }\r\n  }\r\n\r\n  const imagePosition = {\r\n    topLeft: mat.clone().inverse().applyToPoint(0, 0),\r\n    bottomRight: mat.clone().inverse().applyToPoint(iw, ih),\r\n  }\r\n\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        width: \"100%\",\r\n        height: \"100%\",\r\n        maxHeight: \"calc(100vh - 68px)\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n        cursor: createWithPrimary\r\n          ? \"crosshair\"\r\n          : dragging\r\n          ? \"grabbing\"\r\n          : dragWithPrimary\r\n          ? \"grab\"\r\n          : zoomWithPrimary\r\n          ? mat.a < 1\r\n            ? \"zoom-out\"\r\n            : \"zoom-in\"\r\n          : undefined,\r\n      }}\r\n    >\r\n      {imageLoaded && !dragging && (\r\n        <RegionSelectAndTransformBoxes\r\n          key=\"regionSelectAndTransformBoxes\"\r\n          regions={\r\n             !allowedArea\r\n              ? regions\r\n              : [\r\n                  {\r\n                    type: \"rectangle\",\r\n                    id: \"$$allowed_area\",\r\n                    cls: \"allowed_area\",\r\n                    highlighted: true,\r\n                    x: allowedArea.x,\r\n                    y: allowedArea.y,\r\n                    w: allowedArea.w,\r\n                    h: allowedArea.h,\r\n                    visible: true,\r\n                    color: \"#ff0\",\r\n                  },\r\n                ]\r\n          }\r\n          mouseEvents={mouseEvents}\r\n          projectRegionBox={projectRegionBox}\r\n          dragWithPrimary={dragWithPrimary}\r\n          createWithPrimary={createWithPrimary}\r\n          zoomWithPrimary={zoomWithPrimary}\r\n          onBeginMovePoint={onBeginMovePoint}\r\n          onSelectRegion={onSelectRegion}\r\n          layoutParams={layoutParams}\r\n          mat={mat}\r\n          onBeginBoxTransform={onBeginBoxTransform}\r\n          onBeginMovePolygonPoint={onBeginMovePolygonPoint}\r\n          onBeginMoveKeypoint={onBeginMoveKeypoint}\r\n          onAddPolygonPoint={onAddPolygonPoint}\r\n          onAddPolygon1Point={onAddPolygon1Point}\r\n          onBeginMovePolygon1Point={onBeginMovePolygon1Point}\r\n        />\r\n      )}\r\n      {imageLoaded  && !dragging && (\r\n        <div key=\"regionTags\">\r\n          <RegionTags\r\n            regions={regions}\r\n            projectRegionBox={projectRegionBox}\r\n            mouseEvents={mouseEvents}\r\n            regionTagList={regionTagList}\r\n            onBeginRegionEdit={onBeginRegionEdit}\r\n            onChangeRegion={onChangeRegion}\r\n            onCloseRegionEdit={onCloseRegionEdit}\r\n            onDeleteRegion={onDeleteRegion}\r\n            layoutParams={layoutParams}\r\n            imageSrc={imageSrc}\r\n            onRegionClassAdded={onRegionClassAdded}\r\n            allowComments={allowComments}\r\n          />\r\n       </div>\r\n      )}\r\n\r\n      {zoomWithPrimary && zoomBox !== null && (\r\n        <div\r\n          key=\"zoomBox\"\r\n          style={{\r\n            position: \"absolute\",\r\n            zIndex: 1,\r\n            border: \"1px solid #fff\",\r\n            pointerEvents: \"none\",\r\n            left: zoomBox.x,\r\n            top: zoomBox.y,\r\n            width: zoomBox.w,\r\n            height: zoomBox.h,\r\n          }}\r\n        />\r\n      )}\r\n\r\n      <div\r\n        style={{ width: \"100%\", height: \"100%\" }}\r\n        {...mouseEvents}\r\n      >\r\n\r\n        <>\r\n          <canvas\r\n            style={{ opacity: 0.25 }}\r\n            className={classes.canvas}\r\n            ref={canvasEl}\r\n          />\r\n          <RegionShapes\r\n            imagePosition={imagePosition}\r\n            regions={regions}\r\n          />\r\n          <ImageCanvasBackground\r\n            imagePosition={imagePosition}\r\n            mouseEvents={mouseEvents}\r\n            onLoad={ImageLoaded}\r\n            imageSrc={imageSrc}\r\n          />\r\n        </>\r\n      </div>\r\n      <div className={classes.zoomIndicator}>\r\n        {((1 / mat.a) * 100).toFixed(0)}%\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ImageCanvas\r\n"]},"metadata":{},"sourceType":"module"}