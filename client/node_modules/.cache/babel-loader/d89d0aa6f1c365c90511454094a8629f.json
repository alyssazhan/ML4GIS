{"ast":null,"code":"import { setIn, updateIn, asMutable, without } from \"seamless-immutable\";\nimport moment from \"moment\";\nconst typesToSaveWithHistory = {\n  BEGIN_BOX_TRANSFORM: \"Transform/Move Box\",\n  BEGIN_MOVE_POINT: \"Move Point\",\n  DELETE_REGION: \"Delete Region\"\n};\nexport const saveToHistory = (state, name) => updateIn(state, [\"history\"], h => [{\n  time: moment().toDate(),\n  state: without(state, \"history\"),\n  name\n}].concat((h || []).slice(0, 9)));\nexport default (reducer => {\n  return (state, action) => {\n    const prevState = state;\n    const nextState = reducer(state, action);\n\n    if (action.type === \"RESTORE_HISTORY\") {\n      if (state.history.length > 0) {\n        return setIn(nextState.history[0].state, [\"history\"], nextState.history.slice(1));\n      }\n    } else {\n      if (prevState !== nextState && Object.keys(typesToSaveWithHistory).includes(action.type)) {\n        return setIn(nextState, [\"history\"], [{\n          time: moment().toDate(),\n          state: without(prevState, \"history\"),\n          name: typesToSaveWithHistory[action.type] || action.type\n        }].concat(nextState.history || []).slice(0, 9));\n      }\n    }\n\n    return nextState;\n  };\n});","map":{"version":3,"sources":["/Users/yan/Documents/proj/ML4GIS/client/src/annotateComponents/Annotator/reducers/history-handler.js"],"names":["setIn","updateIn","asMutable","without","moment","typesToSaveWithHistory","BEGIN_BOX_TRANSFORM","BEGIN_MOVE_POINT","DELETE_REGION","saveToHistory","state","name","h","time","toDate","concat","slice","reducer","action","prevState","nextState","type","history","length","Object","keys","includes"],"mappings":"AAGA,SAASA,KAAT,EAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,OAArC,QAAoD,oBAApD;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,MAAMC,sBAAsB,GAAG;AAC7BC,EAAAA,mBAAmB,EAAE,oBADQ;AAE7BC,EAAAA,gBAAgB,EAAE,YAFW;AAG7BC,EAAAA,aAAa,EAAE;AAHc,CAA/B;AAMA,OAAO,MAAMC,aAAa,GAAG,CAACC,KAAD,EAAyBC,IAAzB,KAC3BV,QAAQ,CAACS,KAAD,EAAQ,CAAC,SAAD,CAAR,EAAsBE,CAAD,IAC3B,CACE;AACEC,EAAAA,IAAI,EAAET,MAAM,GAAGU,MAAT,EADR;AAEEJ,EAAAA,KAAK,EAAEP,OAAO,CAACO,KAAD,EAAQ,SAAR,CAFhB;AAGEC,EAAAA;AAHF,CADF,EAMEI,MANF,CAMS,CAACH,CAAC,IAAI,EAAN,EAAUI,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,CANT,CADM,CADH;AAWP,gBAAgBC,OAAD,IAAa;AAC1B,SAAO,CAACP,KAAD,EAAyBQ,MAAzB,KAA4C;AACjD,UAAMC,SAAS,GAAGT,KAAlB;AACA,UAAMU,SAAS,GAAGH,OAAO,CAACP,KAAD,EAAQQ,MAAR,CAAzB;;AAEA,QAAIA,MAAM,CAACG,IAAP,KAAgB,iBAApB,EAAuC;AACrC,UAAIX,KAAK,CAACY,OAAN,CAAcC,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,eAAOvB,KAAK,CACVoB,SAAS,CAACE,OAAV,CAAkB,CAAlB,EAAqBZ,KADX,EAEV,CAAC,SAAD,CAFU,EAGVU,SAAS,CAACE,OAAV,CAAkBN,KAAlB,CAAwB,CAAxB,CAHU,CAAZ;AAKD;AACF,KARD,MAQO;AACL,UACEG,SAAS,KAAKC,SAAd,IACAI,MAAM,CAACC,IAAP,CAAYpB,sBAAZ,EAAoCqB,QAApC,CAA6CR,MAAM,CAACG,IAApD,CAFF,EAGE;AACA,eAAOrB,KAAK,CACVoB,SADU,EAEV,CAAC,SAAD,CAFU,EAGV,CACE;AACEP,UAAAA,IAAI,EAAET,MAAM,GAAGU,MAAT,EADR;AAEEJ,UAAAA,KAAK,EAAEP,OAAO,CAACgB,SAAD,EAAY,SAAZ,CAFhB;AAGER,UAAAA,IAAI,EAAEN,sBAAsB,CAACa,MAAM,CAACG,IAAR,CAAtB,IAAuCH,MAAM,CAACG;AAHtD,SADF,EAOGN,MAPH,CAOUK,SAAS,CAACE,OAAV,IAAqB,EAP/B,EAQGN,KARH,CAQS,CART,EAQY,CARZ,CAHU,CAAZ;AAaD;AACF;;AAED,WAAOI,SAAP;AACD,GAlCD;AAmCD,CApCD","sourcesContent":["// @flow\n\nimport type { MainLayoutState, Action } from \"../../MainLayout/types\"\nimport { setIn, updateIn, asMutable, without } from \"seamless-immutable\"\nimport moment from \"moment\"\n\nconst typesToSaveWithHistory = {\n  BEGIN_BOX_TRANSFORM: \"Transform/Move Box\",\n  BEGIN_MOVE_POINT: \"Move Point\",\n  DELETE_REGION: \"Delete Region\",\n}\n\nexport const saveToHistory = (state: MainLayoutState, name: string) =>\n  updateIn(state, [\"history\"], (h) =>\n    [\n      {\n        time: moment().toDate(),\n        state: without(state, \"history\"),\n        name,\n      },\n    ].concat((h || []).slice(0, 9))\n  )\n\nexport default (reducer) => {\n  return (state: MainLayoutState, action: Action) => {\n    const prevState = state\n    const nextState = reducer(state, action)\n\n    if (action.type === \"RESTORE_HISTORY\") {\n      if (state.history.length > 0) {\n        return setIn(\n          nextState.history[0].state,\n          [\"history\"],\n          nextState.history.slice(1)\n        )\n      }\n    } else {\n      if (\n        prevState !== nextState &&\n        Object.keys(typesToSaveWithHistory).includes(action.type)\n      ) {\n        return setIn(\n          nextState,\n          [\"history\"],\n          [\n            {\n              time: moment().toDate(),\n              state: without(prevState, \"history\"),\n              name: typesToSaveWithHistory[action.type] || action.type,\n            },\n          ]\n            .concat(nextState.history || [])\n            .slice(0, 9)\n        )\n      }\n    }\n\n    return nextState\n  }\n}\n"]},"metadata":{},"sourceType":"module"}