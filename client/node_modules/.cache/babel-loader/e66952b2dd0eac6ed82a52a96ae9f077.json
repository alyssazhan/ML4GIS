{"ast":null,"code":"import _slicedToArray from \"/Users/yan/Documents/GItHub/ML4GIS/client/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/yan/Documents/GItHub/ML4GIS/client/src/pages/Home/SubmitHIT/index.js\";\nimport React, { Component, useState } from \"react\";\nimport axios from \"axios\";\nimport AnnotationTool from \"../annotateComponents\";\nimport Button from 'react-bootstrap/Button';\nvar env = process.env.NODE_ENV;\n\nvar config = require(\"../../../config.json\");\n\nexport default function SubmitHIT(props) {\n  // constructor(props) {\n  //   super(props);\n  //   this.state = {\n  //     error: null,\n  //     isLoaded: false,\n  //     EnabledTools:null,\n  //     AllowComments:null,\n  //     Tags:null,\n  //     imgData: [\n  //       {\n  //         src:\"https://geodata.lib.utexas.edu/assets/blac_featured_image_map-dca4cbca4e07010e5bd201ad8fab1cc0aa9abd24a8842f90e3c1eef1834e8498.jpg\",\n  //         name: \"Image 1\",\n  //         regions: []\n  //       },\n  //       {\n  //         src:\"https://geodata.lib.utexas.edu/assets/utlmaps_featured_image_map-c07ae2551145ff2e5f5fa3c71baa345d9d674a33b08f422449203cf9ed47e0d1.jpg\",\n  //         name: \"Image 2\",\n  //         regions: []\n  //       },\n  //       {\n  //         src:\"https://1igc0ojossa412h1e3ek8d1w-wpengine.netdna-ssl.com/wp-content/uploads/2018/03/TMSELEMWORLD.M.jpg\",\n  //         name: \"Image 3\",\n  //         regions: []\n  //       }\n  //     ],\n  //   }\n  //   this.props = props;\n  //   this.submitTask = this.submitTask.bind(this);\n  //   this.getSubmissionUrl = this.getSubmissionUrl.bind(this);\n  //   this.handleSubmit = this.handleSubmit.bind(this);\n  //   this.componentDidMount=this.componentDidMount(this);\n  // }\n  const _useState = useState(props.hit.imgData),\n        _useState2 = _slicedToArray(_useState, 2),\n        img = _useState2[0],\n        setImg = _useState2[1]; // function getTools(res){\n  //    console.log(\"get tool:\",res.Tools['enenabledTools'])\n  //\n  //  }\n  // get data from api\n  //   componentDidMount() {\n  //     function getEnabledTools(data) {\n  //       const enabledTools =data[\"enabledTools\"]\n  //       var res=[]\n  //       for (var i = 0; i < enabledTools.length; i++) {\n  //         if (enabledTools[i][\"create point\"]==true){\n  //           res.push(\"create-point\")\n  //         }\n  //         else if (enabledTools[i][\"create rectangle\"]==true){\n  //           res.push(\"create-rectangle\")\n  //         }\n  //         else if(enabledTools[i][\"create polygon\"]==true){\n  //           res.push(\"create-polygon\")\n  //         }\n  //       }\n  //       return res\n  //\n  //     }\n  //\n  //     fetch(\"/api\",{ mode: 'cors'})\n  //         .then(res => res.json())\n  //         .then(\n  //             (result) => {\n  //               const enabledTools=getEnabledTools(result[\"setup\"])\n  //               this.setState({\n  //                 isLoaded: true,\n  //                 EnabledTools:enabledTools,\n  //                 AllowComments:result[\"setup\"][\"allow-comments\"],\n  //                 Tags:result[\"setup\"][\"tags\"]\n  //               });\n  //               console.log(\"res is: \", result)\n  //             },\n  //             // Note: it's important to handle errors here\n  //             // instead of a catch() block so that we don't swallow\n  //             // exceptions from actual bugs in components.\n  //             (error) => {\n  //               this.setState({\n  //                 isLoaded: true,\n  //                 error\n  //               });\n  //             }\n  //         )\n  //   }\n\n\n  function parseParameters(url) {\n    var params = {\n      'assignmentId': null,\n      'hitId': null,\n      'workerId': null,\n      'turkSubmitTo': null\n    };\n    var queryString = url.split('?')[1];\n\n    if (queryString) {\n      var queryPieces = queryString.split('&');\n\n      for (var i = 0; i < queryPieces.length; ++i) {\n        var pieces = queryPieces[i].split('=');\n        var paramName = pieces[0];\n        var paramValue = pieces[1];\n\n        if (paramName in params) {\n          params[paramName] = paramValue;\n        }\n      }\n    }\n\n    return params;\n  }\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    const input = document.getElementById('submitButton');\n    input.setAttribute('value', JSON.stringify(this.state.imgData));\n    console.log(input);\n    const form = document.getElementById('submitForm');\n    HTMLFormElement.prototype.submit.call(form);\n  }\n\n  function submitTask(e) {\n    // e.preventDefault();\n    console.log(\"POSTing data\");\n    axios.post(\"\".concat(getSubmissionUrl()), {}).then(function (response) {\n      console.log(response);\n    }).catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  function getSubmissionUrl() {\n    let mturkParams = parseParameters(window.location.href);\n    const assignmentID = mturkParams['assignmentId'];\n    const url = config[\"submit\"][env] + \"/?assignmentId=\" + assignmentID;\n    console.log(url);\n    return url;\n  } // render() {\n  //   const { error, isLoaded, EnabledTools, AllowComments, Tags, imgData} = this.state;\n  //   console.log(\"data is:\", this.state)\n  //   if (error) {\n  //     return <div>Error: {error.message}</div>;\n  //   } else if (!isLoaded) {\n  //     return <div>Loading...</div>;\n  //   } else {\n\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    id: \"Submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    id: \"submitForm\",\n    type: \"submit\",\n    method: \"POST\",\n    action: getSubmissionUrl(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(AnnotationTool, {\n    name: \"AnnotationTool\",\n    type: \"submit\",\n    ref: value => {\n      this.value = value;\n    },\n    images: props.hit.imgData,\n    enabledTools: props.hit.EnabledTools,\n    regionTagList: props.hit.Tags,\n    allowComments: props.hit.AllowComments,\n    onExit: output => {\n      // this.setState({imgData: output.images});\n      setImg(output.images); // this.setState({imgData: output.images});\n\n      console.log(JSON.stringify(output.images));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outline-dark\",\n    size: \"lg\",\n    block: true,\n    name: \"Annotation\",\n    type: \"submit\",\n    id: \"submitButton\",\n    value: JSON.stringify(props.hit.imgData),\n    ref: value => {\n      props.hit.value = value;\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 17\n    }\n  }, \"Complete the HIT\")))); // }\n  // }\n}","map":{"version":3,"sources":["/Users/yan/Documents/GItHub/ML4GIS/client/src/pages/Home/SubmitHIT/index.js"],"names":["React","Component","useState","axios","AnnotationTool","Button","env","process","NODE_ENV","config","require","SubmitHIT","props","hit","imgData","img","setImg","parseParameters","url","params","queryString","split","queryPieces","i","length","pieces","paramName","paramValue","handleSubmit","e","preventDefault","input","document","getElementById","setAttribute","JSON","stringify","state","console","log","form","HTMLFormElement","prototype","submit","call","submitTask","post","getSubmissionUrl","then","response","catch","error","mturkParams","window","location","href","assignmentID","value","EnabledTools","Tags","AllowComments","output","images"],"mappings":"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","sourcesContent":["import React, {Component, useState} from \"react\";\nimport axios from \"axios\";\nimport AnnotationTool from \"../annotateComponents\";\nimport Button from 'react-bootstrap/Button';\n\nvar env = process.env.NODE_ENV;\nvar config = require(\"../../../config.json\");\n\n\nexport default function SubmitHIT(props){\n  // constructor(props) {\n  //   super(props);\n  //   this.state = {\n  //     error: null,\n  //     isLoaded: false,\n  //     EnabledTools:null,\n  //     AllowComments:null,\n  //     Tags:null,\n  //     imgData: [\n  //       {\n  //         src:\"https://geodata.lib.utexas.edu/assets/blac_featured_image_map-dca4cbca4e07010e5bd201ad8fab1cc0aa9abd24a8842f90e3c1eef1834e8498.jpg\",\n  //         name: \"Image 1\",\n  //         regions: []\n  //       },\n  //       {\n  //         src:\"https://geodata.lib.utexas.edu/assets/utlmaps_featured_image_map-c07ae2551145ff2e5f5fa3c71baa345d9d674a33b08f422449203cf9ed47e0d1.jpg\",\n  //         name: \"Image 2\",\n  //         regions: []\n  //       },\n  //       {\n  //         src:\"https://1igc0ojossa412h1e3ek8d1w-wpengine.netdna-ssl.com/wp-content/uploads/2018/03/TMSELEMWORLD.M.jpg\",\n  //         name: \"Image 3\",\n  //         regions: []\n  //       }\n  //     ],\n  //   }\n  //   this.props = props;\n  //   this.submitTask = this.submitTask.bind(this);\n  //   this.getSubmissionUrl = this.getSubmissionUrl.bind(this);\n  //   this.handleSubmit = this.handleSubmit.bind(this);\n  //   this.componentDidMount=this.componentDidMount(this);\n\n  // }\n   const [img,setImg]=useState(props.hit.imgData)\n // function getTools(res){\n //    console.log(\"get tool:\",res.Tools['enenabledTools'])\n //\n //  }\n// get data from api\n//   componentDidMount() {\n//     function getEnabledTools(data) {\n//       const enabledTools =data[\"enabledTools\"]\n//       var res=[]\n//       for (var i = 0; i < enabledTools.length; i++) {\n//         if (enabledTools[i][\"create point\"]==true){\n//           res.push(\"create-point\")\n//         }\n//         else if (enabledTools[i][\"create rectangle\"]==true){\n//           res.push(\"create-rectangle\")\n//         }\n//         else if(enabledTools[i][\"create polygon\"]==true){\n//           res.push(\"create-polygon\")\n//         }\n//       }\n//       return res\n//\n//     }\n//\n//     fetch(\"/api\",{ mode: 'cors'})\n//         .then(res => res.json())\n//         .then(\n//             (result) => {\n//               const enabledTools=getEnabledTools(result[\"setup\"])\n//               this.setState({\n//                 isLoaded: true,\n//                 EnabledTools:enabledTools,\n//                 AllowComments:result[\"setup\"][\"allow-comments\"],\n//                 Tags:result[\"setup\"][\"tags\"]\n//               });\n//               console.log(\"res is: \", result)\n//             },\n//             // Note: it's important to handle errors here\n//             // instead of a catch() block so that we don't swallow\n//             // exceptions from actual bugs in components.\n//             (error) => {\n//               this.setState({\n//                 isLoaded: true,\n//                 error\n//               });\n//             }\n//         )\n//   }\n\n  function parseParameters(url){\n    var params = {\n      'assignmentId' : null,\n      'hitId' : null,\n      'workerId' : null,\n      'turkSubmitTo' : null\n    };\n\n    var queryString = url.split('?')[1];\n\n    if (queryString){\n      var queryPieces = queryString.split('&');\n      for (var i = 0; i < queryPieces.length; ++i){\n        var pieces = queryPieces[i].split('=');\n        var paramName = pieces[0];\n        var paramValue = pieces[1];\n        if(paramName in params){\n          params[paramName] = paramValue;\n        }\n      }\n    }\n\n    return params;\n  }\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    const input = document.getElementById('submitButton');\n    input.setAttribute('value', JSON.stringify(this.state.imgData));\n    console.log(input);\n    const form = document.getElementById('submitForm');\n    HTMLFormElement.prototype.submit.call(form);\n\n  }\n\n  function submitTask(e) {\n    // e.preventDefault();\n    console.log(\"POSTing data\");\n    axios\n      .post(`${getSubmissionUrl()}`, {})\n      .then(function(response) {\n        console.log(response);\n      })\n      .catch(function(error) {\n        console.log(error);\n      });\n  }\n\n  function getSubmissionUrl() {\n    let mturkParams = parseParameters(window.location.href);\n    const assignmentID =  mturkParams['assignmentId'];\n    const url = config[\"submit\"][env] + \"/?assignmentId=\" + assignmentID;\n    console.log(url);\n    return url;\n  }\n\n  // render() {\n  //   const { error, isLoaded, EnabledTools, AllowComments, Tags, imgData} = this.state;\n  //   console.log(\"data is:\", this.state)\n  //   if (error) {\n  //     return <div>Error: {error.message}</div>;\n  //   } else if (!isLoaded) {\n  //     return <div>Loading...</div>;\n  //   } else {\n      return (\n          <div id=\"Submit\">\n\n            <form\n                id=\"submitForm\"\n                type=\"submit\"\n                method=\"POST\"\n                action={getSubmissionUrl()}\n            >\n              <AnnotationTool\n                  name=\"AnnotationTool\"\n                  type=\"submit\"\n                  ref={value => {\n                    this.value = value;\n                  }}\n                  images={props.hit.imgData}\n                  enabledTools={props.hit.EnabledTools}\n                  regionTagList={props.hit.Tags}\n                  allowComments={props.hit.AllowComments}\n                  onExit={output => {\n                      // this.setState({imgData: output.images});\n                      setImg( output.images);\n                      // this.setState({imgData: output.images});\n                      console.log(JSON.stringify(output.images))\n                  }}\n\n              />\n              <div>\n                <Button variant=\"outline-dark\" size=\"lg\" block\n                        name=\"Annotation\"\n                        type=\"submit\"\n                        id=\"submitButton\"\n                        value={JSON.stringify(props.hit.imgData)}\n                        ref={value => {\n                          props.hit.value = value;\n                        }}\n                >Complete the HIT</Button>\n              </div>\n            </form>\n          </div>\n      );\n    // }\n  // }\n}\n"]},"metadata":{},"sourceType":"module"}